import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as e,c as a,a as i}from"./app-BRQZ0-Iq.js";const o={},r=i('<h1 id="linux-无论怎么设置开机启动级别为图形化启动-级别-5-启动后却没有进入图形化界面-一直进入命令行模式-如何解决" tabindex="-1"><a class="header-anchor" href="#linux-无论怎么设置开机启动级别为图形化启动-级别-5-启动后却没有进入图形化界面-一直进入命令行模式-如何解决"><span>Linux 无论怎么设置开机启动级别为图形化启动（级别 5），启动后却没有进入图形化界面，一直进入命令行模式，如何解决？</span></a></h1><p>环境：CentOS 7.3</p><p><strong>现象简单描述</strong>：</p><p>偶然遇到一个系统每次开机启动都默认进入了命令行模式，每次开机都需要输入 startx 或者 init 5 进入图形化界面。启动期间没有报错项，唯一就是启动级别明明是 runlevel5，但是进入的却是 runlevel3。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-8a79263cd27fc8794234052614fad7ed_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-b003e2e88a990f28d34b632cfc633b3e_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>startx 与 init 5 区别</strong></p><ul><li>startx 是单纯的以执行命令者的身份启动 X 图形界面,环境变量是当前身份的。任意用户可以执行。</li><li>init 5 切换到运行级别 5,则是启动 runlevel 5 所对应的服务，并运行图形登录管理器，由用户选择以何种身份登录。该操作是有重新启动系统服务的,需要重新输入用户名和密码登陆。只有 root 有权执行。</li></ul><p><strong>排查过程：</strong></p><p>1、查看启动级别</p><blockquote><p>systemctl get-default</p></blockquote><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-a3040b761b076098bb9b688bfb835f69_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>再查看软链接目录下是否有误：</p><blockquote><p>ls -al /etc/systemd/system/</p></blockquote><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-2e028bdf7ea4e0697861d4f096b272aa_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>2、排查开机启动项</p><blockquote><p>cat /etc/rc.d/rc.local</p></blockquote><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-822cc5cdeec7d67cb8e2d16fb7284cbf_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>并无有关设置启动级别的条目，这里大家也不要试了，这里我试过将 startx 加入到这里开机运行，结果开机直接卡在了桌面，进不去。和这里应该是没有关系的。</p><p>3、排查开机引导配置文件 grub.cfg（7 版本这个，6 版本为 grub.conf）</p><p>根据系统的启动顺序，后面想到了是不是这里设置了启动级别，那无论我们怎么设置启动级别，那肯定是没用的。所以在这里设置了启动级别</p><ol start="3"><li></li></ol><blockquote><p>cat /boot/grub2/grub.cfg</p></blockquote><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-3ffc729159af0dbbfb2d5f9ab59e9996_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>成功实现了不管如何设置启动级别，系统都 默认启动的级别都是这里设置的内容</strong>。这样的话，我们可以联想一下，即使遇到了这样的情况，我们可以直 <strong>接在这里指定启动级别，就可以简单解决眼下的问题</strong>。</p><p>Linux 无论怎么设置开机启动级别为命令行模式（级别 3），启动后却没有进入命令行模式，一直进入图形化启动这个问题也是和此类似。</p><p>4、<strong>可以排查其他开机自启项目</strong>，可能有某个服务包含了设置启动级别的配置文件，这个大家可以继续往下研究是否有这样的服务可做到。</p><p><strong>这里我在虚拟机里有做过测试，已确定是由哪一个服务也可以导致该现象的发生</strong>：该服务名为<strong>gdm</strong>与<strong>display-manager</strong> 。下面简单介绍下：</p><p>关于 gdm 引用一段从别的地方摘抄的话：</p><p>GDM (The GNOME Display Manager)是 GNOME 显示环境的管理器，并被用来替代原来的 X Display Manager。与其竞争者(X3DM,KDM,WDM) 不同，GDM 是完全重写的，并不包含任何 XDM 的代码。GDM 可以运行并管理本地和远程登录的 X 服务器(通过 XDMCP) 。gdm 仅仅是一个脚本，实际上是通过他来运行 GDM 二进制可执行文件。gdm-stop 是用来迅速终止当前正在运行的 gdm 守护进程的一个脚本。gdm-restart 脚本将迅速重启当前守护进程。然而 gdm-safe-restart 会当所有人都注销后再重启。gdmsetup 是一种可以很简单的修改多数常用选项的图形化界面工具。GNOME 的帮助里有更完整的文档，在“应用程序”/“系统工具”这一章节。</p><p>简单的说，就是 gdm 是关于桌面显示的关键部分，可用于管理用户登录这些方面的内容</p><p>下面我们直接测试该服务如果设置开机不自启动，会产生什么样的现象：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-b04965446234d2582cac0f0babb1dbe6_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-a13c66244680f02646ec57bc32d89455_r.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>**重启后进入了命令行模式，也实现了无论如何设置开机启动级别，但是开机依然进入了命令行。这个时候你就要注意看看是不是这个服务被设置成开机不自启动了 **。</p><p>另外，我们如果不小心把 display-manager 设置开机不自启动的话，其实也就是取消了 gdm 的自启。只是现象可能有点差异：下面我只是简单描述下：</p><p>1）重启后会有一个卡住在检测那里，显示 1min30s 的读条，之后进去卡住，然后如果此时按一下 Enter 键，可以直接进入命令行模式；</p><p>2）重启后直接进入了命令行，这两个现象是我在虚拟机里测试的结果，第一条暂时无法重现了，我就这么简单描述了。</p><p>5、此外，当安装 iBus 输入法后，在卸载 iBus 后也会无法进入图形用户界面。这个原因就是 ibus 和 gnome 很多都是绑定在一起的，卸载 ibus 后会导致 gdm 服务的状态被改变，从而导致了故障的发生。解决办法就是把 gdm 设置开机自启重启即可。</p><blockquote><p>systemctl enable gdm</p></blockquote><p><strong>系统启动级别具体说明：</strong></p><p><strong>0：</strong> 系统停机**（关机）**模式，系统默认运行级别不能设置为 0，否则不能正常启动，一开机就自动关机。 **1：**单用户模式，root 权限，用于系统维护，禁止远程登陆，就像 Windows 下的安全模式登录。 **2：**多用户模式，没有 NFS 网络支持。 **3：**完整的多用户文本模式，有 NFS，登陆后进入控制台命令行模式。 **4：**系统未使用，保留一般不用，在一些特殊情况下可以用它来做一些事情。例如在笔记本电脑的电池用尽时，可以切换到这个模式来做一些设置。 **5：**图形化模式，登陆后进入图形 GUI 模式或 GNOME、KDE 图形化界面，如 X Window 系统。 **6：**重启模式，默认运行级别不能设为 6，否则不能正常启动，就会一直开机重启开机重启。</p><p><strong>设置默认运行级别的方式</strong></p><p><strong>设置成多用户命令模式【命令行模式】</strong></p><blockquote><p>systemctl set-default multi-user.target</p></blockquote><p>也可以用下面这个命令：</p><blockquote><p>systemctl set-default runlevel3.target</p></blockquote><p><strong>设置成图形化模式</strong></p><blockquote><p>systemctl set-default graphical.target</p></blockquote><p>也可以用下面这个命令：</p><blockquote><p>systemctl set-default runlevel5.target</p></blockquote><p><strong>获取当前启动级别：</strong></p><blockquote><p>systemctl get-default</p></blockquote><p>谨以此记录</p>',54),g=[r];function c(p,s){return e(),a("div",null,g)}const b=t(o,[["render",c],["__file","Linux设置开机启动级别为5，启动后却没有进入图形化界面，一直进入命令行模式，如何解决.html.vue"]]),m=JSON.parse('{"path":"/linux/Linux%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E7%BA%A7%E5%88%AB%E4%B8%BA5%EF%BC%8C%E5%90%AF%E5%8A%A8%E5%90%8E%E5%8D%B4%E6%B2%A1%E6%9C%89%E8%BF%9B%E5%85%A5%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E8%BF%9B%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3.html","title":"Linux无论怎么设置开机启动级别没有进入图形化界面","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"Linux无论怎么设置开机启动级别没有进入图形化界面","excerpt":null,"description":"Linux 无论怎么设置开机启动级别为图形化启动（级别 5），启动后却没有进入图形化界面，一直进入命令行模式，如何解决？ 环境：CentOS 7.3 现象简单描述： 偶然遇到一个系统每次开机启动都默认进入了命令行模式，每次开机都需要输入 startx 或者 init 5 进入图形化界面。启动期间没有报错项，唯一就是启动级别明明是 runlevel5，但...","date":"2023-04-04T00:00:00.000Z","category":"Linux","tag":"Linux","article":true,"timeline":true,"icon":"linux","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/linux/Linux%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E7%BA%A7%E5%88%AB%E4%B8%BA5%EF%BC%8C%E5%90%AF%E5%8A%A8%E5%90%8E%E5%8D%B4%E6%B2%A1%E6%9C%89%E8%BF%9B%E5%85%A5%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E8%BF%9B%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"Linux无论怎么设置开机启动级别没有进入图形化界面"}],["meta",{"property":"og:description","content":"Linux 无论怎么设置开机启动级别为图形化启动（级别 5），启动后却没有进入图形化界面，一直进入命令行模式，如何解决？ 环境：CentOS 7.3 现象简单描述： 偶然遇到一个系统每次开机启动都默认进入了命令行模式，每次开机都需要输入 startx 或者 init 5 进入图形化界面。启动期间没有报错项，唯一就是启动级别明明是 runlevel5，但..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-8a79263cd27fc8794234052614fad7ed_r.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-27T13:32:36.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2023-04-04T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-27T13:32:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux无论怎么设置开机启动级别没有进入图形化界面\\",\\"image\\":[\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-8a79263cd27fc8794234052614fad7ed_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-b003e2e88a990f28d34b632cfc633b3e_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-a3040b761b076098bb9b688bfb835f69_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-2e028bdf7ea4e0697861d4f096b272aa_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-822cc5cdeec7d67cb8e2d16fb7284cbf_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-3ffc729159af0dbbfb2d5f9ab59e9996_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-b04965446234d2582cac0f0babb1dbe6_r.jpg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/v2-a13c66244680f02646ec57bc32d89455_r.jpg\\"],\\"datePublished\\":\\"2023-04-04T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-27T13:32:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[],"git":{"createdTime":1680872346000,"updatedTime":1714224756000,"contributors":[{"name":"xlc520","email":"2215400217@qq.com","commits":3},{"name":"xlc","email":"2215400217@qq.com","commits":2}]},"readingTime":{"minutes":5.66,"words":1699},"filePathRelative":"linux/Linux设置开机启动级别为5，启动后却没有进入图形化界面，一直进入命令行模式，如何解决.md","localizedDate":"2023年4月4日","autoDesc":true}');export{b as comp,m as data};
