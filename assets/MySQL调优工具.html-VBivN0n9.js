import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as i,o as r,c as l,d as a,e,b as n,a as s}from"./app-CHLzVell.js";const p={},c=s('<h1 id="mysql-调优工具" tabindex="-1"><a class="header-anchor" href="#mysql-调优工具"><span>MySQL 调优工具</span></a></h1><p>俗话说工欲善其事，必先利其器，定期对你的 MYSQL 数据库进行一个体检，是保证数据库安全运行的重要手段，因为，好的工具是使你的工作效率 <strong>倍增！</strong></p><p>今天和大家分享几个 mysql 优化的工具，你可以使用它们对你的 mysql 进行一个体检，生成 awr 报告，让你从<strong>整体上</strong>把握你的数据库的性能情况。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/b51ee07f21ac4e82b23b5b65f86f8d16noop.image_iz=58558&amp;from=article.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="mysqltuner-pl" tabindex="-1"><a class="header-anchor" href="#mysqltuner-pl"><span><strong>mysqltuner.pl</strong></span></a></h1><p>是 mysql 一个常用的数据库性能诊断工具，主要检查参数设置的合理性包括日志文件、存储引擎、安全建议及性能分析。针对潜在的问题，给出改进的建议。是 mysql 优化的好帮手。</p><p>在上一版本中，MySQLTuner 支持 MySQL / MariaDB / Percona Server 的约 300 个指标。</p>',7),d={href:"https://github.com/major/MySQLTuner-perl",target:"_blank",rel:"noopener noreferrer"},g=s(`<p><strong>1.1 下载</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#wget https://raw.githubusercontent.com/major/MySQLTuner-perl/master/mysqltuner.pl</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>1.2 使用</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ./mysqltuner.pl --socket /var/lib/mysql/mysql.sock</span>
 <span class="token operator">&gt;&gt;</span> MySQLTuner <span class="token number">1.7</span>.4 - Major Hayden <span class="token operator">&lt;</span>major@mhtx.net<span class="token operator">&gt;</span>
 <span class="token operator">&gt;&gt;</span> Bug reports, feature requests, and downloads at http://mysqltuner.com/
 <span class="token operator">&gt;&gt;</span> Run with <span class="token string">&#39;--help&#39;</span> <span class="token keyword">for</span> additional options and output filtering
<span class="token punctuation">[</span>--<span class="token punctuation">]</span> Skipped version check <span class="token keyword">for</span> MySQLTuner script
Please enter your MySQL administrative login: root
Please enter your MySQL administrative password: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span> Currently running supported MySQL version <span class="token number">5.7</span>.23
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> Operating on <span class="token number">64</span>-bit architecture 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>1.3、报告分析</strong></p><p>1）<strong>重要关注[!!]（<strong>中括号有叹号的项）例如</strong>[!!]</strong> Maximum possible memory usage: 4.8G (244.13% of installed RAM) ，表示内存已经严重用超了。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/75f9620e0a374aeaac6583769fa907c9noop.image_iz=58558&amp;from=article.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>2）关注最后给的建议“Recommendations ”。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/07c3573d5cda4de3800b282ad88ca7aenoop.image_iz=58558&amp;from=article.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="tuning-primer-sh" tabindex="-1"><a class="header-anchor" href="#tuning-primer-sh"><span><strong>tuning-primer.sh</strong></span></a></h1><p>mysql 的另一个优化工具，针于 mysql 的整体进行一个体检，对潜在的问题，给出优化的建议。</p>`,11),m={href:"https://github.com/BMDan/tuning-primer.sh",target:"_blank",rel:"noopener noreferrer"},u=s(`<p>目前，支持检测和优化建议的内容如下：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/a659e545a6f1484f8312988281333b12noop.image_iz=58558&amp;from=article.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>2.1 下载</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#wget https://launchpad.net/mysql-tuning-primer/trunk/1.6-r1/+download/tuning-primer.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>2.2 使用</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># [root@localhost dba]# ./tuning-primer.sh </span>
 
 -- MYSQL PERFORMANCE TUNING PRIMER --
 - By: Matthew Montgomery -
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.3 报告分析</strong></p><p>重点查看有红色告警的选项，根据建议结合自己系统的实际情况进行修改，例如：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/96253147103948d08497044ddd94ebbfnoop.image_iz=58558&amp;from=article.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="pt-variable-advisor" tabindex="-1"><a class="header-anchor" href="#pt-variable-advisor"><span><strong>pt-variable-advisor</strong></span></a></h1><p><strong>pt-variable-advisor</strong> 可以分析 MySQL 变量并就可能出现的问题提出建议。</p><p><strong>3.1 安装</strong></p>`,12),b={href:"https://www.percona.com/downloads/percona-toolkit/LATEST/",target:"_blank",rel:"noopener noreferrer"},h=s(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#wget https://www.percona.com/downloads/percona-toolkit/3.0.13/binary/redhat/7/x86_64/percona-toolkit-3.0.13-re85ce15-el7-x86_64-bundle.tar</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#yum install percona-toolkit-3.0.13-1.el7.x86_64.rpm </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3.2 使用</strong></p><p>pt-variable-advisor 是 pt 工具集的一个子工具，主要用来诊断你的参数设置是否合理。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># pt-variable-advisor localhost --socket /var/lib/mysql/mysql.sock</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>3.3 报告分析</strong></p><p>重点关注有 WARN 的信息的条目，例如：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/a55ce3055ece478d8f0133c203f7a990noop.image_iz=58558&amp;from=article.jpeg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="pt-qurey-digest" tabindex="-1"><a class="header-anchor" href="#pt-qurey-digest"><span><strong>pt-qurey-digest</strong></span></a></h1><p><strong>pt-query-digest</strong> 主要功能是从日志、进程列表和 tcpdump 分析 MySQL 查询。</p><p><strong>4.1 安装</strong></p><p>具体参考 3.1 节</p><p><strong>4.2 使用</strong></p><p>pt-query-digest 主要用来分析 mysql 的慢日志，与 mysqldumpshow 工具相比，py-query_digest 工具的分析结果更具体，更完善。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># pt-query-digest /var/lib/mysql/slowtest-slow.log </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>4.3 常见用法分析</strong></p><p>1）直接分析慢查询文件:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>pt-query-digest /var/lib/mysql/slowtest-slow.log <span class="token operator">&gt;</span> slow_report.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）分析最近 12 小时内的查询：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>pt-query-digest <span class="token parameter variable">--since</span><span class="token operator">=</span>12h /var/lib/mysql/slowtest-slow.log <span class="token operator">&gt;</span> slow_report2.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）分析指定时间范围内的查询：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>pt-query-digest /var/lib/mysql/slowtest-slow.log <span class="token parameter variable">--since</span> <span class="token string">&#39;2017-01-07 09:30:00&#39;</span> <span class="token parameter variable">--until</span> <span class="token string">&#39;2017-01-07 10:00:00&#39;</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span> slow_report3.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>4）分析指含有 select 语句的慢查询</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>pt-query-digest <span class="token parameter variable">--filter</span> <span class="token string">&#39;$event-&gt;{fingerprint} =~ m/^select/i&#39;</span> /var/lib/mysql/slowtest-slow.log<span class="token operator">&gt;</span> slow_report4.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>5）针对某个用户的慢查询</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>pt-query-digest <span class="token parameter variable">--filter</span> <span class="token string">&#39;($event-&gt;{user} || &quot;&quot;) =~ m/^root/i&#39;</span> /var/lib/mysql/slowtest-slow.log<span class="token operator">&gt;</span> slow_report5.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>6）查询所有所有的全表扫描或 full join 的慢查询</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>pt-query-digest <span class="token parameter variable">--filter</span> <span class="token string">&#39;(($event-&gt;{Full_scan} || &quot;&quot;) eq &quot;yes&quot;) ||(($event-&gt;{Full_join} || &quot;&quot;) eq &quot;yes&quot;)&#39;</span> /var/lib/mysql/slowtest-slow.log<span class="token operator">&gt;</span> slow_report6.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>4.4 报告分析</strong></p><ul><li>第一部分：总体统计结果 Overall：总共有多少条查询 Time range：查询执行的时间范围 unique：唯一查询数量，即对查询条件进行参数化以后，总共有多少个不同的查询 total：总计 min：最小 max：最大 avg：平均 95%：把所有值从小到大排列，位置 位于95%的那个数，这个数一般最具有参考价值 median：中位数，把所有值从小到大排列，位置位于中间那个数</li><li>第二部分：查询分组统计结果 Rank：所有语句的排名，默认按查询时间降序排列，通过--order-by 指定 Query ID：语句的 ID，（去掉多余空格和文本字符，计算 hash 值） Response：总的响应时间 time：该查询在本次分析中总的时间占比 calls：执行次数，即本次分析总共有多少条这种类型的查询语句 R/Call：平均每次执行的响应时间 V/M：响应时间 Variance-to-mean 的比率 Item：查询对象</li><li>第三部分：每一种查询的详细统计结果 ID：查询的 ID 号，和上图的 Query ID 对应 Databases：数据库名 Users：各个用户执行的次数（占比） Query_time distribution ：查询时间分布, 长短体现区间占比。 Tables：查询中涉及到的表 Explain：SQL 语句</li></ul>`,29);function v(y,k){const t=i("ExternalLinkIcon");return r(),l("div",null,[c,a("p",null,[e("项目地址： "),a("a",d,[e("https://github.com/major/MySQLTuner-perl"),n(t)])]),g,a("p",null,[e("项目地址： "),a("a",m,[e("https://github.com/BMDan/tuning-primer.sh"),n(t)])]),u,a("p",null,[a("a",b,[e("https://www.percona.com/downloads/percona-toolkit/LATEST/"),n(t)])]),h])}const w=o(p,[["render",v],["__file","MySQL调优工具.html.vue"]]),q=JSON.parse('{"path":"/dev/MySQL%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7.html","title":"MySQL 调优工具","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"MySQL 调优工具","excerpt":null,"description":"Java","date":"2024-04-10T00:00:00.000Z","category":"Java","tag":"Java","article":true,"timeline":true,"icon":"java","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/dev/MySQL%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"MySQL 调优工具"}],["meta",{"property":"og:description","content":"Java"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bitbucket.org/xlc520/blogasset/raw/main/images3/b51ee07f21ac4e82b23b5b65f86f8d16noop.image_iz=58558&from=article.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-27T13:32:36.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Java"}],["meta",{"property":"article:published_time","content":"2024-04-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-27T13:32:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL 调优工具\\",\\"image\\":[\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/b51ee07f21ac4e82b23b5b65f86f8d16noop.image_iz=58558&from=article.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/75f9620e0a374aeaac6583769fa907c9noop.image_iz=58558&from=article.jpeg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/07c3573d5cda4de3800b282ad88ca7aenoop.image_iz=58558&from=article.jpeg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/a659e545a6f1484f8312988281333b12noop.image_iz=58558&from=article.jpeg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/96253147103948d08497044ddd94ebbfnoop.image_iz=58558&from=article.jpeg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/a55ce3055ece478d8f0133c203f7a990noop.image_iz=58558&from=article.jpeg\\"],\\"datePublished\\":\\"2024-04-10T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-27T13:32:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[],"git":{"createdTime":1714214949000,"updatedTime":1714224756000,"contributors":[{"name":"xlc","email":"2215400217@qq.com","commits":2}]},"readingTime":{"minutes":4.07,"words":1221},"filePathRelative":"dev/MySQL调优工具.md","localizedDate":"2024年4月10日"}');export{w as comp,q as data};
