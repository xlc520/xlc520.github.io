import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,a as e}from"./app-BkZy1zYI.js";const p={},t=e(`<h1 id="运维脚本" tabindex="-1"><a class="header-anchor" href="#运维脚本"><span>运维脚本</span></a></h1><p><strong>一、根据 PID 过滤进程所有信息</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token comment"># Function: 根据用户输入的PID，过滤出该PID所有的信息</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;请输入要查询的PID: &quot;</span> P
<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $11}&#39;</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;该PID不存在！！&quot;</span>
 <span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------------------------&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程PID: <span class="token variable">$P</span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程命令：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $11}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程所属用户: <span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $1}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU占用率：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $3}&#39;</span><span class="token variable">\`</span></span>%&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;内存占用率：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $4}&#39;</span><span class="token variable">\`</span></span>%&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程开始运行的时刻：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $9}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程运行的时间：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $10}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程状态：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $8}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程虚拟内存：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $5}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;进程共享内存：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> -aux<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$2~/^&#39;</span>$P<span class="token string">&#39;$/{print $6}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------------------------&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-4.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p><strong>二、根据进程名过滤进程信息</strong></p><p>会显示出该进程名包含的所有线程</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token comment"># Function: 根据输入的程序的名字过滤出所对应的PID，并显示出详细信息，如果有几个PID，则全部显示</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;请输入要查询的进程名：&quot;</span> NAME
<span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span> <span class="token comment">##统计进程总数</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$N</span> <span class="token parameter variable">-le</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该进程名没有运行！&quot;</span>
<span class="token keyword">fi</span>
<span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$N</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程PID: <span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程命令：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $11}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程所属用户: <span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU占用率：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">\`</span></span>%&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;内存占用率：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $4}&#39;</span><span class="token variable">\`</span></span>%&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程开始运行的时刻：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $9}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程运行的时间：<span class="token variable"><span class="token variable">\`</span> <span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $11}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程状态：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $8}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程虚拟内存：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;进程共享内存：<span class="token variable"><span class="token variable">\`</span><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> $NAME <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print $0}&#39;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $6}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;***************************************************************&quot;</span>
  <span class="token builtin class-name">let</span> N-- i++
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-5.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p><strong>三、根据用户名查询该用户的相关信息</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token comment"># Function：根据用户名查询该用户的所有信息</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;请输入要查询的用户名：&quot;</span> A
<span class="token builtin class-name">echo</span> <span class="token string">&quot;------------------------------&quot;</span>
<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;$1~/^&#39;</span>$A<span class="token string">&#39;$/{print}&#39;</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户不存在&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;------------------------------&quot;</span>
<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户的用户名：<span class="token variable">$A</span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户的UID：<span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;$1~/^&#39;</span>$A<span class="token string">&#39;$/{print}&#39;</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户的组为：<span class="token variable"><span class="token variable">\`</span><span class="token function">id</span> $A <span class="token operator">|</span> <span class="token function">awk</span> <span class="token punctuation">{</span><span class="token string">&#39;print $3&#39;</span><span class="token punctuation">}</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户的GID为：<span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;$1~/^&#39;</span>$A<span class="token string">&#39;$/{print}&#39;</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $4}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户的家目录为：<span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;$1~/^&#39;</span>$A<span class="token string">&#39;$/{print}&#39;</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $6}&#39;</span><span class="token variable">\`</span></span>&quot;</span>
  <span class="token assign-left variable">Login</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;$1~/^&#39;</span>$A<span class="token string">&#39;$/{print}&#39;</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $7}&#39;</span><span class="token variable">\`</span></span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$Login</span> <span class="token operator">==</span> <span class="token string">&quot;/bin/bash&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户有登录系统的权限！！&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;------------------------------&quot;</span>
  <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$Login</span> <span class="token operator">==</span> <span class="token string">&quot;/sbin/nologin&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;该用户没有登录系统的权限！！&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;------------------------------&quot;</span>
  <span class="token keyword">fi</span>
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-6.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p><strong>四、加固系统的一些配置</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>
<span class="token comment"># Function:对账户的密码的一些加固</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;设置密码最多可多少天不修改：&quot;</span> A
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;设置密码修改之间最小的天数：&quot;</span> B
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;设置密码最短的长度：&quot;</span> C
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;设置密码失效前多少天通知用户：&quot;</span> D
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^PASS_MAX_DAYS/c\\PASS_MAX_DAYS &#39;</span><span class="token variable">$A</span><span class="token string">&#39;&#39;</span> /etc/login.defs
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^PASS_MIN_DAYS/c\\PASS_MIN_DAYS &#39;</span><span class="token variable">$B</span><span class="token string">&#39;&#39;</span> /etc/login.defs
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^PASS_MIN_LEN/c\\PASS_MIN_LEN &#39;</span><span class="token variable">$C</span><span class="token string">&#39;&#39;</span> /etc/login.defs
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^PASS_WARN_AGE/c\\PASS_WARN_AGE &#39;</span><span class="token variable">$D</span><span class="token string">&#39;&#39;</span> /etc/login.defs

<span class="token builtin class-name">echo</span> <span class="token string">&quot;已对密码进行加固，新用户不得和旧密码相同，且新密码必须同时包含数字、小写字母，大写字母！！&quot;</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/pam_pwquality.so/c\\password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= difok=1 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1&#39;</span> /etc/pam.d/system-auth

<span class="token builtin class-name">echo</span> <span class="token string">&quot;已对密码进行加固，如果输入错误密码超过3次，则锁定账户！！&quot;</span>
<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/pam.d/sshd <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;auth required pam_tally2.so &quot;</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/%PAM-1.0/a\\auth required pam_tally2.so deny=3 unlock_time=150 even_deny_root root_unlock_time300&#39;</span> /etc/pam.d/sshd
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span>  <span class="token string">&quot;已设置禁止root用户远程登录！！&quot;</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/PermitRootLogin/c\\PermitRootLogin no&#39;</span>  /etc/ssh/sshd_config

<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;设置历史命令保存条数：&quot;</span> E
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;设置账户自动注销时间：&quot;</span> F
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^HISTSIZE/c\\HISTSIZE=&#39;</span><span class="token variable">$E</span><span class="token string">&#39;&#39;</span> /etc/profile
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^HISTSIZE/a\\TMOUT=&#39;</span><span class="token variable">$F</span><span class="token string">&#39;&#39;</span> /etc/profile

<span class="token builtin class-name">echo</span> <span class="token string">&quot;已设置只允许wheel组的用户可以使用su命令切换到root用户！&quot;</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/pam_wheel.so use_uid/c\\auth required pam_wheel.so use_uid &#39;</span> /etc/pam.d/su
<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/login.defs <span class="token operator">|</span> <span class="token function">grep</span> SU_WHEEL_ONLY <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> SU_WHEEL_ONLY <span class="token function">yes</span> <span class="token operator">&gt;&gt;</span> /etc/login.defs
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;即将对系统中的账户进行检查....&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;系统中有登录权限的用户有：&quot;</span>
<span class="token function">awk</span> -F: <span class="token string">&#39;($7==&quot;/bin/bash&quot;){print $1}&#39;</span> /etc/passwd
<span class="token builtin class-name">echo</span> <span class="token string">&quot;********************************************&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;系统中UID=0的用户有：&quot;</span>
<span class="token function">awk</span> -F: <span class="token string">&#39;($3==&quot;0&quot;){print $1}&#39;</span> /etc/passwd
<span class="token builtin class-name">echo</span> <span class="token string">&quot;********************************************&quot;</span>
<span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">awk</span> -F: <span class="token string">&#39;($2==&quot;&quot;){print $1}&#39;</span> /etc/shadow<span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;系统中空密码用户有：<span class="token variable">$N</span>&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$N</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;恭喜你，系统中无空密码用户！！&quot;</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;********************************************&quot;</span>
<span class="token keyword">else</span>
 <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
 <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$N</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span>
 <span class="token keyword">do</span>
    <span class="token assign-left variable">None</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">awk</span> -F: <span class="token string">&#39;($2==&quot;&quot;){print $1}&#39;</span> /etc/shadow<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;NR==&#39;</span>$i<span class="token string">&#39;{print}&#39;</span><span class="token variable">\`</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;------------------------&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$None</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;必须为空用户设置密码！！&quot;</span>
    <span class="token function">passwd</span> <span class="token variable">$None</span>
    <span class="token builtin class-name">let</span> N--
 <span class="token keyword">done</span>
 <span class="token assign-left variable">M</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">awk</span> -F: <span class="token string">&#39;($2==&quot;&quot;){print $1}&#39;</span> /etc/shadow<span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">\`</span></span>
 <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$M</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;恭喜，系统中已经没有空密码用户了！&quot;</span>
 <span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;系统中还存在空密码用户：<span class="token variable">$M</span>&quot;</span>
 <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;即将对系统中重要文件进行锁定，锁定后将无法添加删除用户和组&quot;</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;警告：此脚本运行后将无法添加删除用户和组！！确定输入Y，取消输入N；Y/N：&quot;</span> i
<span class="token keyword">case</span> <span class="token variable">$i</span> <span class="token keyword">in</span>
      <span class="token punctuation">[</span>Y,y<span class="token punctuation">]</span><span class="token punctuation">)</span>
            chattr +i /etc/passwd
            chattr +i /etc/shadow
            chattr +i /etc/group
            chattr +i /etc/gshadow
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;锁定成功！&quot;</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
      <span class="token punctuation">[</span>N,n<span class="token punctuation">]</span><span class="token punctuation">)</span>
            chattr <span class="token parameter variable">-i</span> /etc/passwd
            chattr <span class="token parameter variable">-i</span> /etc/shadow
            chattr <span class="token parameter variable">-i</span> /etc/group
            chattr <span class="token parameter variable">-i</span> /etc/gshadow
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;取消锁定成功！！&quot;</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
       *<span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;请输入Y/y or N/n&quot;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-0.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure>`,14),l=[t];function o(i,c){return n(),a("div",null,l)}const u=s(p,[["render",o],["__file","运维脚本.html.vue"]]),v=JSON.parse('{"path":"/linux/%E8%BF%90%E7%BB%B4%E8%84%9A%E6%9C%AC.html","title":"运维脚本","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"运维脚本","excerpt":null,"description":"运维脚本 一、根据 PID 过滤进程所有信息 图片图片 二、根据进程名过滤进程信息 会显示出该进程名包含的所有线程 图片图片 三、根据用户名查询该用户的相关信息 图片图片 四、加固系统的一些配置 图片图片","date":"2023-11-18T00:00:00.000Z","category":"Linux","tag":"Linux","article":true,"timeline":true,"icon":"linux","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/linux/%E8%BF%90%E7%BB%B4%E8%84%9A%E6%9C%AC.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"运维脚本"}],["meta",{"property":"og:description","content":"运维脚本 一、根据 PID 过滤进程所有信息 图片图片 二、根据进程名过滤进程信息 会显示出该进程名包含的所有线程 图片图片 三、根据用户名查询该用户的相关信息 图片图片 四、加固系统的一些配置 图片图片"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-4.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-27T13:32:36.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2023-11-18T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-27T13:32:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"运维脚本\\",\\"image\\":[\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-4.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-5.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-6.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1700133678077-0.png\\"],\\"datePublished\\":\\"2023-11-18T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-27T13:32:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[],"git":{"createdTime":1701949796000,"updatedTime":1714224756000,"contributors":[{"name":"xlc","email":"2215400217@qq.com","commits":3}]},"readingTime":{"minutes":4.81,"words":1444},"filePathRelative":"linux/运维脚本.md","localizedDate":"2023年11月18日","autoDesc":true}');export{u as comp,v as data};
