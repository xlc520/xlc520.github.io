import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as i,a}from"./app-BxuroukW.js";const t={},l=a(`<h1 id="nginx-安全加固" tabindex="-1"><a class="header-anchor" href="#nginx-安全加固"><span>Nginx-安全加固</span></a></h1><h3 id="_01-使用安全的版本" tabindex="-1"><a class="header-anchor" href="#_01-使用安全的版本"><span>01 使用安全的版本</span></a></h3><p>版本最新：1.25.4 更新日期：2024-03</p><p>建议使用稳定版本 1.24.0，低版本不建议使用</p><p>NginX 下载地址：</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>https://nginx.org/en/download.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_02-使用普通用户启动" tabindex="-1"><a class="header-anchor" href="#_02-使用普通用户启动"><span>02 使用普通用户启动</span></a></h3><p>不使用管理员组的用户启动</p><h3 id="_03-隐藏-nginx-版本号" tabindex="-1"><a class="header-anchor" href="#_03-隐藏-nginx-版本号"><span>03 隐藏 NginX 版本号</span></a></h3><p>在 nginx.conf 配置文件中，http 模块中添加 server_tokens off;</p><p>重启 Nginx</p><h3 id="_04-设置-timeout-根据实际情况" tabindex="-1"><a class="header-anchor" href="#_04-设置-timeout-根据实际情况"><span>04 设置 timeout（根据实际情况）</span></a></h3><p>编辑 nginx 配置文件，在 http 模块中添加以下参数</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>client_body_timeout 10;client_header_timeout 30;keepalive_timeout 30  30;send_timeout 10;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重启 Nginx</p><p>注：此项主要是防御 DOS 攻击。</p><h3 id="_05-禁用-autoindex-避免目录浏览" tabindex="-1"><a class="header-anchor" href="#_05-禁用-autoindex-避免目录浏览"><span>05 禁用 Autoindex，避免目录浏览</span></a></h3><p>编辑 nginx 配置文件，在 http 模块添加 autoindex off;</p><p>重启 Nginx</p><h3 id="_06-设置-nginx-缓冲区" tabindex="-1"><a class="header-anchor" href="#_06-设置-nginx-缓冲区"><span>06 设置 NginX 缓冲区</span></a></h3><p>编辑 nginx 配置文件，在 server 模块中需要限制的 location 中添加以下参数</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>client_body_buffer_size  16K;client_header_buffer_size 1k;client_max_body_size 1m;large_client_header_buffers 4 8k;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重启 Nginx</p><p>注：防止缓冲区溢出攻击</p><h3 id="_07-限制仅允许域名访问" tabindex="-1"><a class="header-anchor" href="#_07-限制仅允许域名访问"><span>07 限制仅允许域名访问</span></a></h3><p>编辑 nging 配置文件,示例如下</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>server {listen ....;server_name _  www.baidu.com;return 403;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>执行 nginx -s reload 动态更新配置文件</p><p>(如果有其他端口，同样加入其他端口的 server)</p><h3 id="_08-限制-nginx-请求方法" tabindex="-1"><a class="header-anchor" href="#_08-限制-nginx-请求方法"><span>08 限制 nginx 请求方法</span></a></h3><p>编辑 nginx 配置文件，在每个 server 模块中添加</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>if ($request_method !~ ^(GET|HEAD|POST)$ ) {return 404;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_09-开启访问日志" tabindex="-1"><a class="header-anchor" href="#_09-开启访问日志"><span>09 开启访问日志</span></a></h3><p>编辑 nging 配置文件：</p><p>access_log logs/access.log main;</p><p>error_log logs/error.log error;</p><p>日志生成的到 Nginx 根目录 logs/access.log 文件，默认使用“main”日志格式，也可以自定义格式，自定义格式后面出文章说，有需要你们先自行百度吧。</p><h3 id="_10-nginx-日志保留半年" tabindex="-1"><a class="header-anchor" href="#_10-nginx-日志保留半年"><span>10 Nginx 日志保留半年</span></a></h3><p>这里使用 linux 自带 logrotate 工具，不想用这个也可以写脚本切割，我嫌麻烦，就用这个，方便省事。</p><p>/etc/logrotate.conf 添加以下配置</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>/var/log/nginx.log {    weekly    rotate 26    copytruncate    compress    notifempty    missingok}logrotate -vf /etc/logrotate.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_11-错误页面重定向" tabindex="-1"><a class="header-anchor" href="#_11-错误页面重定向"><span>11 错误页面重定向</span></a></h3><p>新建错误页面,放到静态目录中,编辑 Nignx 配置文件，</p><p>在 http 模块中添加如下参数:</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>fastcgi_intercept_errors on;errorpage 401 /401.html;errorpage 402 /402.html;errorpage 403 /403.html;errorpage 404 /404.html;errorpage 405 /405.html;errorpage 500 /500.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重启 nginx 服务</p><h3 id="_11-限制-php-执行权限-如有需求" tabindex="-1"><a class="header-anchor" href="#_11-限制-php-执行权限-如有需求"><span>11 限制 php 执行权限(如有需求)</span></a></h3><p>编辑 nignx 配置文件,在需要限制的 server 模块中添加如下代码:</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>location ~ /(attachments|upload)/.*.(php|php5)?$ {deny all;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>以上的配置文件代码需要放到 location ~ .php{...}上面,相关目录需要写相对目录,重启 nginx</p><h3 id="_12-nginx-配置-waf-模块" tabindex="-1"><a class="header-anchor" href="#_12-nginx-配置-waf-模块"><span>12 nginx 配置 waf 模块</span></a></h3>`,51),r=[l];function s(p,d){return n(),i("div",null,r)}const g=e(t,[["render",s],["__file","Nginx-安全加固.html.vue"]]),h=JSON.parse('{"path":"/linux/Nginx-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA.html","title":"Nginx-安全加固","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"Nginx-安全加固","excerpt":null,"description":"Nginx-安全加固 01 使用安全的版本 版本最新：1.25.4 更新日期：2024-03 建议使用稳定版本 1.24.0，低版本不建议使用 NginX 下载地址： 02 使用普通用户启动 不使用管理员组的用户启动 03 隐藏 NginX 版本号 在 nginx.conf 配置文件中，http 模块中添加 server_tokens off; 重启 ...","date":"2024-04-21T00:00:00.000Z","category":"Linux","tag":"Linux","article":true,"timeline":true,"icon":"linux","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/linux/Nginx-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"Nginx-安全加固"}],["meta",{"property":"og:description","content":"Nginx-安全加固 01 使用安全的版本 版本最新：1.25.4 更新日期：2024-03 建议使用稳定版本 1.24.0，低版本不建议使用 NginX 下载地址： 02 使用普通用户启动 不使用管理员组的用户启动 03 隐藏 NginX 版本号 在 nginx.conf 配置文件中，http 模块中添加 server_tokens off; 重启 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-27T13:32:36.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2024-04-21T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-27T13:32:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx-安全加固\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-04-21T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-27T13:32:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[{"level":3,"title":"01 使用安全的版本","slug":"_01-使用安全的版本","link":"#_01-使用安全的版本","children":[]},{"level":3,"title":"02 使用普通用户启动","slug":"_02-使用普通用户启动","link":"#_02-使用普通用户启动","children":[]},{"level":3,"title":"03 隐藏 NginX 版本号","slug":"_03-隐藏-nginx-版本号","link":"#_03-隐藏-nginx-版本号","children":[]},{"level":3,"title":"04 设置 timeout（根据实际情况）","slug":"_04-设置-timeout-根据实际情况","link":"#_04-设置-timeout-根据实际情况","children":[]},{"level":3,"title":"05 禁用 Autoindex，避免目录浏览","slug":"_05-禁用-autoindex-避免目录浏览","link":"#_05-禁用-autoindex-避免目录浏览","children":[]},{"level":3,"title":"06 设置 NginX 缓冲区","slug":"_06-设置-nginx-缓冲区","link":"#_06-设置-nginx-缓冲区","children":[]},{"level":3,"title":"07 限制仅允许域名访问","slug":"_07-限制仅允许域名访问","link":"#_07-限制仅允许域名访问","children":[]},{"level":3,"title":"08 限制 nginx 请求方法","slug":"_08-限制-nginx-请求方法","link":"#_08-限制-nginx-请求方法","children":[]},{"level":3,"title":"09 开启访问日志","slug":"_09-开启访问日志","link":"#_09-开启访问日志","children":[]},{"level":3,"title":"10 Nginx 日志保留半年","slug":"_10-nginx-日志保留半年","link":"#_10-nginx-日志保留半年","children":[]},{"level":3,"title":"11 错误页面重定向","slug":"_11-错误页面重定向","link":"#_11-错误页面重定向","children":[]},{"level":3,"title":"11 限制 php 执行权限(如有需求)","slug":"_11-限制-php-执行权限-如有需求","link":"#_11-限制-php-执行权限-如有需求","children":[]},{"level":3,"title":"12 nginx 配置 waf 模块","slug":"_12-nginx-配置-waf-模块","link":"#_12-nginx-配置-waf-模块","children":[]}],"git":{"createdTime":1714214949000,"updatedTime":1714224756000,"contributors":[{"name":"xlc","email":"2215400217@qq.com","commits":2}]},"readingTime":{"minutes":2.1,"words":630},"filePathRelative":"linux/Nginx-安全加固.md","localizedDate":"2024年4月21日","autoDesc":true}');export{g as comp,h as data};
