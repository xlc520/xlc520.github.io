import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as i,a as l}from"./app-DDjfOKh-.js";const e={};function p(t,s){return a(),i("div",null,s[0]||(s[0]=[l(`<h1 id="springboot-打包不同环境配置与-shell-脚本部署" tabindex="-1"><a class="header-anchor" href="#springboot-打包不同环境配置与-shell-脚本部署"><span>SpringBoot 打包不同环境配置与 shell 脚本部署</span></a></h1><p>本篇和大家分享的是 springboot 打包并结合 shell 脚本命令部署，重点在分享一个 shell 程序启动工具，希望能便利工作；</p><ul><li>profiles 指定不同环境的配置</li><li>maven-assembly-plugin 打发布压缩包</li><li>分享 shenniu_publish.sh 程序启动工具</li><li>linux 上使用 shenniu_publish.sh 启动程序</li></ul><h1 id="profiles-指定不同环境的配置" tabindex="-1"><a class="header-anchor" href="#profiles-指定不同环境的配置"><span>profiles 指定不同环境的配置</span></a></h1><p>通常一套程序分为了很多个部署环境：开发，测试，uat，线上 等，我们要想对这些环境区分配置文件，可以通过两种方式：</p><ul><li>通过 application.yml 中编码指定 profile.active=uat 方式指定</li><li>通过 mvn 中 profiles 来区分不同环境对应的配置文件夹，人工可以手动在 idea 勾选生成不同环境的包(推荐)</li></ul><p>这里我们要讲的是第二种，首先在 mvn 中配置如下内容：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> 1     &lt;profiles&gt;</span></span>
<span class="line"><span> 2         &lt;profile&gt;</span></span>
<span class="line"><span> 3             &lt;id&gt;node&lt;/id&gt;</span></span>
<span class="line"><span> 4             &lt;properties&gt;</span></span>
<span class="line"><span> 5                 &lt;!--传递给脚本的参数值--&gt;</span></span>
<span class="line"><span> 6                 &lt;activeProfile&gt;node&lt;/activeProfile&gt;</span></span>
<span class="line"><span> 7                 &lt;package-name&gt;\${scripts_packageName}&lt;/package-name&gt;</span></span>
<span class="line"><span> 8                 &lt;boot-main&gt;\${scripts_bootMain}&lt;/boot-main&gt;</span></span>
<span class="line"><span> 9             &lt;/properties&gt;</span></span>
<span class="line"><span>10             &lt;activation&gt;</span></span>
<span class="line"><span>11                 &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</span></span>
<span class="line"><span>12             &lt;/activation&gt;</span></span>
<span class="line"><span>13         &lt;/profile&gt;</span></span>
<span class="line"><span>14         &lt;profile&gt;</span></span>
<span class="line"><span>15             &lt;id&gt;node1&lt;/id&gt;</span></span>
<span class="line"><span>16             &lt;properties&gt;</span></span>
<span class="line"><span>17                 &lt;activeProfile&gt;node1&lt;/activeProfile&gt;</span></span>
<span class="line"><span>18                 &lt;package-name&gt;\${scripts_packageName}&lt;/package-name&gt;</span></span>
<span class="line"><span>19                 &lt;boot-main&gt;\${scripts_bootMain}&lt;/boot-main&gt;</span></span>
<span class="line"><span>20             &lt;/properties&gt;</span></span>
<span class="line"><span>21         &lt;/profile&gt;</span></span>
<span class="line"><span>22         &lt;profile&gt;</span></span>
<span class="line"><span>23             &lt;id&gt;node2&lt;/id&gt;</span></span>
<span class="line"><span>24             &lt;properties&gt;</span></span>
<span class="line"><span>25                 &lt;activeProfile&gt;node2&lt;/activeProfile&gt;</span></span>
<span class="line"><span>26                 &lt;package-name&gt;\${scripts_packageName}&lt;/package-name&gt;</span></span>
<span class="line"><span>27                 &lt;boot-main&gt;\${scripts_bootMain}&lt;/boot-main&gt;</span></span>
<span class="line"><span>28             &lt;/properties&gt;</span></span>
<span class="line"><span>29         &lt;/profile&gt;</span></span>
<span class="line"><span>30     &lt;/profiles&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>节点粗解：</p><ul><li>id：用来指定不同环境配置文件所在的目录，如下我这里： <img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/fe69f622e6fd659b563e79a848403dcac97db44d.png" alt="image" loading="lazy"></li><li>properties：该节点中的节点是可作为参数传递给其他配置文件，如我这里的 package-name 节点值就可以在另外的 assembly.xml 或者 shell 脚本文件中通过\${package-name}获取到，如下： <img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/fd2638a541ecddb2844197770587337bfa4bcc29.png" alt="image" loading="lazy"></li><li>activeByDefault：指定默认环境配置文件夹</li></ul><h1 id="maven-assembly-plugin-打发布压缩包" tabindex="-1"><a class="header-anchor" href="#maven-assembly-plugin-打发布压缩包"><span>maven-assembly-plugin 打发布压缩包</span></a></h1><p>对于 springboot 程序打包，可以分为 jar 和 war，这里是 jar 包；有场景是咋们配置文件或者第三方等依赖包不想放到工程 jar 中，并且把这些文件压缩成一个 zip 包，方便上传到 linux；此时通过 maven-assembly-plugin 和 maven-jar-plugin 就可以做到，mvn 的配置如：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> 1            &lt;plugin&gt;</span></span>
<span class="line"><span> 2                 &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span>
<span class="line"><span> 3                 &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span></span>
<span class="line"><span> 4                 &lt;version&gt;2.6&lt;/version&gt;</span></span>
<span class="line"><span> 5                 &lt;configuration&gt;</span></span>
<span class="line"><span> 6                     &lt;archive&gt;</span></span>
<span class="line"><span> 7                         &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;</span></span>
<span class="line"><span> 8                         &lt;manifest&gt;</span></span>
<span class="line"><span> 9                             &lt;addClasspath&gt;true&lt;/addClasspath&gt;</span></span>
<span class="line"><span>10                             &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;</span></span>
<span class="line"><span>11                             &lt;mainClass&gt;\${scripts_bootMain}&lt;/mainClass&gt;</span></span>
<span class="line"><span>12                         &lt;/manifest&gt;</span></span>
<span class="line"><span>13                     &lt;/archive&gt;</span></span>
<span class="line"><span>14                     &lt;!--打包排除项--&gt;</span></span>
<span class="line"><span>15                     &lt;excludes&gt;</span></span>
<span class="line"><span>16                         &lt;exclude&gt;**/*.yml&lt;/exclude&gt;</span></span>
<span class="line"><span>17                         &lt;exclude&gt;**/*.properties&lt;/exclude&gt;</span></span>
<span class="line"><span>18                         &lt;exclude&gt;**/*.xml&lt;/exclude&gt;</span></span>
<span class="line"><span>19                         &lt;exclude&gt;**/*.sh&lt;/exclude&gt;</span></span>
<span class="line"><span>20                     &lt;/excludes&gt;</span></span>
<span class="line"><span>21                 &lt;/configuration&gt;</span></span>
<span class="line"><span>22                 &lt;executions&gt;</span></span>
<span class="line"><span>23                     &lt;execution&gt;</span></span>
<span class="line"><span>24                         &lt;id&gt;make-a-jar&lt;/id&gt;</span></span>
<span class="line"><span>25                         &lt;phase&gt;compile&lt;/phase&gt;</span></span>
<span class="line"><span>26                         &lt;goals&gt;</span></span>
<span class="line"><span>27                             &lt;goal&gt;jar&lt;/goal&gt;</span></span>
<span class="line"><span>28                         &lt;/goals&gt;</span></span>
<span class="line"><span>29                     &lt;/execution&gt;</span></span>
<span class="line"><span>30                 &lt;/executions&gt;</span></span>
<span class="line"><span>31             &lt;/plugin&gt;</span></span>
<span class="line"><span>32 </span></span>
<span class="line"><span>33             &lt;plugin&gt;</span></span>
<span class="line"><span>34                 &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span>
<span class="line"><span>35                 &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span></span>
<span class="line"><span>36                 &lt;version&gt;2.4&lt;/version&gt;</span></span>
<span class="line"><span>37                 &lt;!-- The configuration of the plugin --&gt;</span></span>
<span class="line"><span>38                 &lt;configuration&gt;</span></span>
<span class="line"><span>39                     &lt;!-- Specifies the configuration file of the assembly plugin --&gt;</span></span>
<span class="line"><span>40                     &lt;descriptors&gt;</span></span>
<span class="line"><span>41                         &lt;descriptor&gt;\${project.basedir}/src/main/assembly/assembly.xml&lt;/descriptor&gt;</span></span>
<span class="line"><span>42                     &lt;/descriptors&gt;</span></span>
<span class="line"><span>43                 &lt;/configuration&gt;</span></span>
<span class="line"><span>44                 &lt;executions&gt;</span></span>
<span class="line"><span>45                     &lt;execution&gt;</span></span>
<span class="line"><span>46                         &lt;id&gt;make-assembly&lt;/id&gt;</span></span>
<span class="line"><span>47                         &lt;phase&gt;package&lt;/phase&gt;</span></span>
<span class="line"><span>48                         &lt;goals&gt;</span></span>
<span class="line"><span>49                             &lt;goal&gt;single&lt;/goal&gt;</span></span>
<span class="line"><span>50                         &lt;/goals&gt;</span></span>
<span class="line"><span>51                     &lt;/execution&gt;</span></span>
<span class="line"><span>52                 &lt;/executions&gt;</span></span>
<span class="line"><span>53             &lt;/plugin&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>值得注意的地方如下几点：</p><ul><li>mainClass 节点：用来指定启动 main 函数入口类路径，如这里的：com.sm.EurekaServerApplication</li><li>excludes 节点：排除主 jar 包中配置等一些列后缀文件，因为我们要包这些配置文件放到主包外面</li><li>descriptor 节点：用来指定 assembly 插件对应的 assembly.xml 配置文件</li></ul><p>有了上面 mvn 配置，我们还需要 assembly.xml 的配置，这里提取了结合 shell 脚本发布程序的配置：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span> 1 &lt;assembly xmlns=&quot;http://maven.apache.org/ASSEMBLY/2.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span> 2           xsi:schemaLocation=&quot;http://maven.apache.org/ASSEMBLY/2.0.0 http://maven.apache.org/xsd/assembly-2.0.0.xsd</span></span>
<span class="line"><span> 3 http://maven.apache.org/ASSEMBLY/2.0.0 &quot;&gt;</span></span>
<span class="line"><span> 4     &lt;id&gt;\${activeProfile}&lt;/id&gt;</span></span>
<span class="line"><span> 5     &lt;!--打包成一个用于发布的zip文件--&gt;</span></span>
<span class="line"><span> 6     &lt;formats&gt;</span></span>
<span class="line"><span> 7         &lt;format&gt;zip&lt;/format&gt;</span></span>
<span class="line"><span> 8     &lt;/formats&gt;</span></span>
<span class="line"><span> 9     &lt;!--true：zip中生成一级目录(此处屏蔽，配合脚本需要profiles后缀)--&gt;</span></span>
<span class="line"><span>10     &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;</span></span>
<span class="line"><span>11     &lt;dependencySets&gt;</span></span>
<span class="line"><span>12         &lt;dependencySet&gt;</span></span>
<span class="line"><span>13             &lt;!--打包进zip文件的lib目录--&gt;</span></span>
<span class="line"><span>14             &lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;</span></span>
<span class="line"><span>15             &lt;outputDirectory&gt;\${package-name}-\${activeProfile}/lib&lt;/outputDirectory&gt;</span></span>
<span class="line"><span>16             &lt;unpack&gt;false&lt;/unpack&gt;</span></span>
<span class="line"><span>17         &lt;/dependencySet&gt;</span></span>
<span class="line"><span>18     &lt;/dependencySets&gt;</span></span>
<span class="line"><span>19 </span></span>
<span class="line"><span>20     &lt;fileSets&gt;</span></span>
<span class="line"><span>21         &lt;!-- 配置文件打包进zip文件的conf目录 --&gt;</span></span>
<span class="line"><span>22         &lt;fileSet&gt;</span></span>
<span class="line"><span>23             &lt;directory&gt;\${project.basedir}/src/main/profiles/\${activeProfile}&lt;/directory&gt;</span></span>
<span class="line"><span>24             &lt;outputDirectory&gt;\${package-name}-\${activeProfile}/conf&lt;/outputDirectory&gt;</span></span>
<span class="line"><span>25             &lt;includes&gt;</span></span>
<span class="line"><span>26                 &lt;include&gt;**/*&lt;/include&gt;</span></span>
<span class="line"><span>27                 &lt;!--&lt;include&gt;*.xml&lt;/include&gt;--&gt;</span></span>
<span class="line"><span>28                 &lt;!--&lt;include&gt;*.properties&lt;/include&gt;--&gt;</span></span>
<span class="line"><span>29                 &lt;!--&lt;include&gt;*.yml&lt;/include&gt;--&gt;</span></span>
<span class="line"><span>30             &lt;/includes&gt;</span></span>
<span class="line"><span>31         &lt;/fileSet&gt;</span></span>
<span class="line"><span>32 </span></span>
<span class="line"><span>33         &lt;!--启动脚本打包进zip文件--&gt;</span></span>
<span class="line"><span>34         &lt;fileSet&gt;</span></span>
<span class="line"><span>35             &lt;directory&gt;\${project.basedir}/src/main/scripts&lt;/directory&gt;</span></span>
<span class="line"><span>36             &lt;outputDirectory&gt;&lt;/outputDirectory&gt;</span></span>
<span class="line"><span>37             &lt;includes&gt;</span></span>
<span class="line"><span>38                 &lt;include&gt;**/*&lt;/include&gt;</span></span>
<span class="line"><span>39             &lt;/includes&gt;</span></span>
<span class="line"><span>40             &lt;!-- 文件文件权限为777 --&gt;</span></span>
<span class="line"><span>41             &lt;fileMode&gt;777&lt;/fileMode&gt;</span></span>
<span class="line"><span>42             &lt;!-- 目录权限为777  --&gt;</span></span>
<span class="line"><span>43             &lt;directoryMode&gt;777&lt;/directoryMode&gt;</span></span>
<span class="line"><span>44             &lt;!--脚本中参数变量为pom中的值 关键--&gt;</span></span>
<span class="line"><span>45             &lt;filtered&gt;true&lt;/filtered&gt;</span></span>
<span class="line"><span>46         &lt;/fileSet&gt;</span></span>
<span class="line"><span>47 </span></span>
<span class="line"><span>48         &lt;!-- 项目编译出来的jar打包进zip文件 --&gt;</span></span>
<span class="line"><span>49         &lt;fileSet&gt;</span></span>
<span class="line"><span>50             &lt;directory&gt;\${project.build.directory}&lt;/directory&gt;</span></span>
<span class="line"><span>51             &lt;outputDirectory&gt;\${package-name}-\${activeProfile}/&lt;/outputDirectory&gt;</span></span>
<span class="line"><span>52             &lt;includes&gt;</span></span>
<span class="line"><span>53                 &lt;include&gt;*.jar&lt;/include&gt;</span></span>
<span class="line"><span>54             &lt;/includes&gt;</span></span>
<span class="line"><span>55         &lt;/fileSet&gt;</span></span>
<span class="line"><span>56     &lt;/fileSets&gt;</span></span>
<span class="line"><span>57 &lt;/assembly&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重点节点介绍：</p><ul><li>formats 节点：把配置文件和 jar 包等压缩成什么文件格式，这里可以有：zip，tar 等</li><li>fileMode 节点：指定 scripts 目录下脚本文件(这里是：shenniu_publish.sh)在 linux 上文件权限为 777</li><li>filtered 节点：脚本中参数变量为 pom 的 profiles 中 properties 的值( 该配置，是把 mvn 中属性值映射生成到 sh 文件中，如：\${package-name})</li></ul><p>完成上面配置后，此时我们可以通过 idea 上勾选切换不同环境来打 zip 包，如图：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170559272-1005982868.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="分享-shenniu-publish-sh-程序启动工具" tabindex="-1"><a class="header-anchor" href="#分享-shenniu-publish-sh-程序启动工具"><span>分享 shenniu_publish.sh 程序启动工具</span></a></h1><p>上面步骤完成了 zip 格式的发布包，我们再分享下启动程序的 shell 脚本，该脚本具有的功能如：</p><ul><li>解压 zip+启动 jar 包</li><li>启动 jar 包</li><li>停止对应 jar 运行</li><li>重启 jar 程序</li></ul><p>目前该 shell 中封装了两种启动 jar 命令的方式：</p><ul><li>java -cp</li><li>java -jar</li></ul><p>如图命令格式：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170514140-1638598831.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>来看全部的 shell 代码：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  1 #!/usr/bin/env bash</span></span>
<span class="line"><span>  2 #可变参数变量</span></span>
<span class="line"><span>  3 languageType=&quot;javac&quot; #支持 java,javac,netcore 发布</span></span>
<span class="line"><span>  4 #参数值由pom文件传递</span></span>
<span class="line"><span>  5 baseZipName=&quot;\${package-name}-\${activeProfile}&quot; #压缩包名称  publish-test.zip的publish</span></span>
<span class="line"><span>  6 packageName=&quot;\${package-name}&quot; #命令启动包名 xx.jar的xx</span></span>
<span class="line"><span>  7 mainclass=&quot;\${boot-main}&quot; #java -cp启动时，指定main入口类;命令：java -cp conf;lib\\*.jar;\${packageName}.jar \${mainclass}</span></span>
<span class="line"><span>  8 </span></span>
<span class="line"><span>  9 #例子</span></span>
<span class="line"><span> 10 # baseZipName=&quot;publish-test&quot; #压缩包名称  publish-test.zip的publish</span></span>
<span class="line"><span> 11 # packageName=&quot;publish&quot; #命令启动包名 publish.jar的xx</span></span>
<span class="line"><span> 12 </span></span>
<span class="line"><span> 13 #固定变量</span></span>
<span class="line"><span> 14 basePath=$(cd \`dirname $0\`/; pwd)</span></span>
<span class="line"><span> 15 baseZipPath=&quot;\${basePath}/\${baseZipName}.zip&quot;  #压缩包路径</span></span>
<span class="line"><span> 16 baseDirPath=&quot;\${basePath}&quot; #解压部署磁盘路径</span></span>
<span class="line"><span> 17 pid= #进程pid</span></span>
<span class="line"><span> 18 </span></span>
<span class="line"><span> 19 #解压</span></span>
<span class="line"><span> 20 function shenniu_unzip()</span></span>
<span class="line"><span> 21 {</span></span>
<span class="line"><span> 22     echo &quot;解压---------------------------------------------&quot;</span></span>
<span class="line"><span> 23     echo &quot;压缩包路径：\${baseZipPath}&quot;</span></span>
<span class="line"><span> 24     if [ ! \`find \${baseZipPath}\` ]</span></span>
<span class="line"><span> 25     then</span></span>
<span class="line"><span> 26         echo &quot;不存在压缩包：\${baseZipPath}&quot;</span></span>
<span class="line"><span> 27     else</span></span>
<span class="line"><span> 28         echo &quot;解压磁盘路径：\${baseDirPath}/\${baseZipName}&quot;</span></span>
<span class="line"><span> 29         echo &quot;开始解压...&quot;</span></span>
<span class="line"><span> 30 </span></span>
<span class="line"><span> 31         #解压命令</span></span>
<span class="line"><span> 32         unzip -od \${baseDirPath}/\${baseZipName} \${baseZipPath}</span></span>
<span class="line"><span> 33 </span></span>
<span class="line"><span> 34         #设置执行权限</span></span>
<span class="line"><span> 35         chmod +x \${baseDirPath}/\${baseZipName}/\${packageName}</span></span>
<span class="line"><span> 36 </span></span>
<span class="line"><span> 37         echo &quot;解压完成。&quot;  </span></span>
<span class="line"><span> 38     fi</span></span>
<span class="line"><span> 39 }</span></span>
<span class="line"><span> 40 </span></span>
<span class="line"><span> 41 #检测pid</span></span>
<span class="line"><span> 42 function getPid()</span></span>
<span class="line"><span> 43 {</span></span>
<span class="line"><span> 44     echo &quot;检测状态---------------------------------------------&quot;</span></span>
<span class="line"><span> 45     pid=\`ps -ef | grep -n \${packageName} | grep -v grep | awk &#39;{print $2}&#39;\`</span></span>
<span class="line"><span> 46     if [ \${pid} ] </span></span>
<span class="line"><span> 47     then</span></span>
<span class="line"><span> 48         echo &quot;运行pid：\${pid}&quot;</span></span>
<span class="line"><span> 49     else</span></span>
<span class="line"><span> 50         echo &quot;未运行&quot;</span></span>
<span class="line"><span> 51     fi</span></span>
<span class="line"><span> 52 }</span></span>
<span class="line"><span> 53 </span></span>
<span class="line"><span> 54 #启动程序</span></span>
<span class="line"><span> 55 function start()</span></span>
<span class="line"><span> 56 {</span></span>
<span class="line"><span> 57     #启动前，先停止之前的</span></span>
<span class="line"><span> 58     stop</span></span>
<span class="line"><span> 59     if [ \${pid} ]</span></span>
<span class="line"><span> 60     then</span></span>
<span class="line"><span> 61         echo &quot;停止程序失败，无法启动&quot;</span></span>
<span class="line"><span> 62     else</span></span>
<span class="line"><span> 63         echo &quot;启动程序---------------------------------------------&quot;</span></span>
<span class="line"><span> 64         </span></span>
<span class="line"><span> 65         #选择语言类型</span></span>
<span class="line"><span> 66         read -p &quot;输入程序类型(java,javac,netcore)，下一步按回车键(默认：\${languageType})：&quot; read_languageType</span></span>
<span class="line"><span> 67         if [ \${read_languageType} ]</span></span>
<span class="line"><span> 68         then</span></span>
<span class="line"><span> 69             languageType=\${read_languageType}</span></span>
<span class="line"><span> 70         fi</span></span>
<span class="line"><span> 71         echo &quot;选择程序类型：\${languageType}&quot;</span></span>
<span class="line"><span> 72 </span></span>
<span class="line"><span> 73         #进入运行包目录</span></span>
<span class="line"><span> 74         cd \${baseDirPath}/\${baseZipName}</span></span>
<span class="line"><span> 75 </span></span>
<span class="line"><span> 76         #分类启动</span></span>
<span class="line"><span> 77         if [ &quot;\${languageType}&quot; == &quot;javac&quot; ] </span></span>
<span class="line"><span> 78         then</span></span>
<span class="line"><span> 79             if [ \${mainclass} ] </span></span>
<span class="line"><span> 80             then</span></span>
<span class="line"><span> 81                 nohup java -cp conf:lib\\*.jar:\${packageName}.jar \${mainclass} &gt;\${baseDirPath}/\${packageName}.out 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span> 82                #nohup java -cp conf:lib\\*.jar:\${packageName}.jar \${mainclass} &gt;/dev/null 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span> 83             fi</span></span>
<span class="line"><span> 84         elif [ &quot;\${languageType}&quot; == &quot;java&quot; ] </span></span>
<span class="line"><span> 85         then</span></span>
<span class="line"><span> 86             nohup java -jar \${baseDirPath}/\${baseZipName}/\${packageName}.jar &gt;/dev/null 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span> 87             # java -jar \${baseDirPath}/\${baseZipName}/\${packageName}.jar</span></span>
<span class="line"><span> 88         elif [ &quot;\${languageType}&quot; == &quot;netcore&quot; ] </span></span>
<span class="line"><span> 89         then</span></span>
<span class="line"><span> 90             #nohup dotnet run \${baseDirPath}/\${baseZipName}/\${packageName} &gt;/dev/null 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span> 91             nohup \${baseDirPath}/\${baseZipName}/\${packageName} &gt;/dev/null 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span> 92         fi</span></span>
<span class="line"><span> 93 </span></span>
<span class="line"><span> 94         #查询是否有启动进程</span></span>
<span class="line"><span> 95         getPid</span></span>
<span class="line"><span> 96         if [ \${pid} ]</span></span>
<span class="line"><span> 97         then</span></span>
<span class="line"><span> 98             echo &quot;已启动&quot;</span></span>
<span class="line"><span> 99             #nohup日志</span></span>
<span class="line"><span>100             tail -n 50 -f \${baseDirPath}/\${packageName}.out</span></span>
<span class="line"><span>101         else</span></span>
<span class="line"><span>102             echo &quot;启动失败&quot;</span></span>
<span class="line"><span>103         fi</span></span>
<span class="line"><span>104     fi</span></span>
<span class="line"><span>105 }</span></span>
<span class="line"><span>106 </span></span>
<span class="line"><span>107 #停止程序</span></span>
<span class="line"><span>108 function stop()</span></span>
<span class="line"><span>109 {</span></span>
<span class="line"><span>110     getPid</span></span>
<span class="line"><span>111     if [ \${pid} ] </span></span>
<span class="line"><span>112     then</span></span>
<span class="line"><span>113         echo &quot;停止程序---------------------------------------------&quot;</span></span>
<span class="line"><span>114         kill -9 \${pid}</span></span>
<span class="line"><span>115         </span></span>
<span class="line"><span>116         getPid</span></span>
<span class="line"><span>117         if [ \${pid} ] </span></span>
<span class="line"><span>118         then</span></span>
<span class="line"><span>119             #stop</span></span>
<span class="line"><span>120             echo &quot;停止失败&quot;</span></span>
<span class="line"><span>121         else</span></span>
<span class="line"><span>122             echo &quot;停止成功&quot;</span></span>
<span class="line"><span>123         fi</span></span>
<span class="line"><span>124     fi</span></span>
<span class="line"><span>125 }</span></span>
<span class="line"><span>126 </span></span>
<span class="line"><span>127 #启动时带参数，根据参数执行</span></span>
<span class="line"><span>128 if [ \${#} -ge 1 ] </span></span>
<span class="line"><span>129 then</span></span>
<span class="line"><span>130     case \${1} in</span></span>
<span class="line"><span>131         &quot;start&quot;) </span></span>
<span class="line"><span>132             start</span></span>
<span class="line"><span>133         ;;</span></span>
<span class="line"><span>134         &quot;restart&quot;) </span></span>
<span class="line"><span>135             start</span></span>
<span class="line"><span>136         ;;</span></span>
<span class="line"><span>137         &quot;stop&quot;) </span></span>
<span class="line"><span>138             stop</span></span>
<span class="line"><span>139         ;;</span></span>
<span class="line"><span>140         &quot;unzip&quot;) </span></span>
<span class="line"><span>141             #执行解压</span></span>
<span class="line"><span>142             shenniu_unzip</span></span>
<span class="line"><span>143             #执行启动</span></span>
<span class="line"><span>144             start</span></span>
<span class="line"><span>145         ;;</span></span>
<span class="line"><span>146         *) </span></span>
<span class="line"><span>147             echo &quot;\${1}无任何操作&quot;</span></span>
<span class="line"><span>148         ;;</span></span>
<span class="line"><span>149     esac</span></span>
<span class="line"><span>150 else</span></span>
<span class="line"><span>151     echo &quot;</span></span>
<span class="line"><span>152     command如下命令：</span></span>
<span class="line"><span>153     unzip：解压并启动</span></span>
<span class="line"><span>154     start：启动</span></span>
<span class="line"><span>155     stop：停止进程</span></span>
<span class="line"><span>156     restart：重启</span></span>
<span class="line"><span>157 </span></span>
<span class="line"><span>158     示例命令如：./shenniu_publish start</span></span>
<span class="line"><span>159     &quot;</span></span>
<span class="line"><span>160 fi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正如上面小节说的，shell 中的参数 package-name，activeProfile，boot-main 都是由 mvn 中 profiles 的 properties 中提供，是可变的参数，脚本代码本身不需要人工去修改，只需要变的是 mvn 的参数即可；其实在我们生成 zip 包的时候，shell 中的参数就被替换了，可以看 zip 中 shell 文件内容如：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170701655-1208411312.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="linux-上使用-shenniu-publish-sh-启动程序" tabindex="-1"><a class="header-anchor" href="#linux-上使用-shenniu-publish-sh-启动程序"><span>linux 上使用 shenniu_publish.sh 启动程序</span></a></h1><p>把生成的 zip 上传到 linux 上，通过命令解压：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1 unzip -od eureka-server-0.0.1-node eureka-server-0.0.1-node.zip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>其实 shell 脚本中包含有解压命令，但是我在打包时放在了 zip 中，所以只能通过手动解压了，当然可以调整；此时进入加压目录如此：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170918126-491643739.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>注：这里第一次执行./shenniu_publish.sh 脚本时候，提示了错误信息；是由于我是在 windows 上编辑的这个脚本，其空格等和 linux 上不一样，所以运行会有问题，要解决可以使用 vim 命令在 linux 把该文件转成 linux 格式，如下命令：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1 vim shenniu_publish.sh</span></span>
<span class="line"><span>2 set ff=unix</span></span>
<span class="line"><span>3 :wq</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行完后，再来运行脚本./shenniu_publish.sh，此时有如下提示:</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309171107977-1319405631.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>此刻我们文件是解压状态，因此只需要 start 命令启动程序即可：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309171127604-1971799892.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>到这里 shenniu_publish.sh 脚本使用就完成了，只要脚本没有提示错误，基本都能启动 jar 服务；其他 restart 和 stop 命令也如此执行就行：</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309171150215-294116419.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>可以去研究下 shell 代码，希望该脚本能给你带来效率和好的学习思路，下面是测试用例 git 地址，脚本在 eureka-server 项目中：<a href="https://github.com/shenniubuxing3/springcloud-Finchley.SR2" target="_blank" rel="noopener noreferrer">https://github.com/shenniubuxing3/springcloud-Finchley.SR2</a></p>`,46)]))}const r=n(e,[["render",p],["__file","springboot打包不同环境配置与shell脚本部署.html.vue"]]),v=JSON.parse('{"path":"/dev/springboot%E6%89%93%E5%8C%85%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E9%83%A8%E7%BD%B2.html","title":"SpringBoot打包不同环境配置与shell脚本部署","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"SpringBoot打包不同环境配置与shell脚本部署","excerpt":null,"description":"SpringBoot打包不同环境配置与shell脚本部署","date":"2022-01-15T00:00:00.000Z","category":"other","tag":"other","article":true,"timeline":true,"icon":"type","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/dev/springboot%E6%89%93%E5%8C%85%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E9%83%A8%E7%BD%B2.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"SpringBoot打包不同环境配置与shell脚本部署"}],["meta",{"property":"og:description","content":"SpringBoot打包不同环境配置与shell脚本部署"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bitbucket.org/xlc520/blogasset/raw/main/images2/fe69f622e6fd659b563e79a848403dcac97db44d.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-27T13:32:36.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"other"}],["meta",{"property":"article:published_time","content":"2022-01-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-27T13:32:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SpringBoot打包不同环境配置与shell脚本部署\\",\\"image\\":[\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/fe69f622e6fd659b563e79a848403dcac97db44d.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/fd2638a541ecddb2844197770587337bfa4bcc29.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170559272-1005982868.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170514140-1638598831.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170701655-1208411312.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309170918126-491643739.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309171107977-1319405631.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309171127604-1971799892.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images2/348819-20190309171150215-294116419.png\\"],\\"datePublished\\":\\"2022-01-15T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-27T13:32:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[],"git":{"createdTime":1647698494000,"updatedTime":1714224756000,"contributors":[{"name":"xlc","email":"2215400217@qq.com","commits":2},{"name":"xlc520","email":"2215400217@qq.com","commits":2}]},"readingTime":{"minutes":8.56,"words":2569},"filePathRelative":"dev/springboot打包不同环境配置与shell脚本部署.md","localizedDate":"2022年1月15日","excerpt":"\\n<p>本篇和大家分享的是 springboot 打包并结合 shell 脚本命令部署，重点在分享一个 shell 程序启动工具，希望能便利工作；</p>\\n<ul>\\n<li>profiles 指定不同环境的配置</li>\\n<li>maven-assembly-plugin 打发布压缩包</li>\\n<li>分享 shenniu_publish.sh 程序启动工具</li>\\n<li>linux 上使用 shenniu_publish.sh 启动程序</li>\\n</ul>"}');export{r as comp,v as data};
