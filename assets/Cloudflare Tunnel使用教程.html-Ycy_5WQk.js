import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as l,c as r,b as a,n as c,g as d,r as i,a as o}from"./app-DDjfOKh-.js";const p={};function g(h,e){const s=i("VPBanner"),t=i("Share");return l(),r("div",null,[a(s,c(d({title:"Cloudflare Tunnel使用教程",content:"Cloudflare Tunnel使用教程",logo:null,color:"var(--banner-text)",background:"rgba(217, 244, 208, 0.5)",actions:[{text:"Cloudflare Tunnel使用教程",link:"/linux/Cloudflare Tunnel使用教程"}]})),null,16),e[0]||(e[0]=o(`<h1 id="cloudflare-tunnel使用教程" tabindex="-1"><a class="header-anchor" href="#cloudflare-tunnel使用教程"><span>Cloudflare Tunnel使用教程</span></a></h1><h3 id="cf-tunnel-是什么" tabindex="-1"><a class="header-anchor" href="#cf-tunnel-是什么"><span>cf tunnel 是什么？</span></a></h3><blockquote><p>Cloudflare</p></blockquote><p>Tunnel为您提供了一种安全的方式，将您的资源连接到Cloudflare，而无需公共可路由的IP地址。使用Tunnel，您不会将流量发送到外部IP地址，而是在您的基础设施中创建一个轻量级的守护程序，仅向Cloudflare的全球网络创建出站连接。Cloudflare</p><blockquote><p>Tunnel可以安全地将HTTP Web服务器、SSH服务器、远程桌面和其他协议连接到Cloudflare。这样，您的源站可以通过Cloudflare提供流量，而不会容易受到绕过Cloudflare的攻击。</p></blockquote><p><em>（摘自官方文档）</em></p><h3 id="有什么用" tabindex="-1"><a class="header-anchor" href="#有什么用"><span>有什么用？</span></a></h3><p><code>tunnel</code>字面意思一根加密隧道直接从Cloudflare网络插到你的服务器，提供webui页面方便管理域名与服务器上部署的项目之间的绑定。</p><ul><li>项目部署上线更简单，只需建立好隧道，然后设置域名指向项目暴露的本地地址和端口即可。</li><li>无需编写任何 Nginx 配置，非常适合像我这样的懒人或小白用户。</li><li>无需配置证书，使用加密隧道，项目不会直接暴露到公网上，从而增强了安全性。<em>（ps: 需开启防火墙）</em></li></ul><h3 id="如何工作的" tabindex="-1"><a class="header-anchor" href="#如何工作的"><span>如何工作的？</span></a></h3><p>大致流程为：</p><p>用户 —&gt; cf服务器 —&gt; cf侧tunnel设置入口 --(加密)–&gt; 服务器侧的tunnel出口 → 本机项目</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/434450a3b007e4730f6bddc45c9c8300d59d7cd6.jpeg" alt="流程" tabindex="0" loading="lazy"><figcaption>流程</figcaption></figure><h3 id="开始搭建" tabindex="-1"><a class="header-anchor" href="#开始搭建"><span>开始搭建</span></a></h3><ol><li>在Cloudflare的侧边栏中，找到并点击<code>Zero Trust</code> 菜单。如果是首次使用，需要进行订阅，选择免费套餐进行开通。</li></ol><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/1686c86ae9810ed5471ce436746fe84047e26949_2_269x500.png" alt="1" tabindex="0" loading="lazy"><figcaption>1</figcaption></figure><h4 id="_2-在进入zero-trust面板后-从侧边栏中找到并点击tunnel-菜单。" tabindex="-1"><a class="header-anchor" href="#_2-在进入zero-trust面板后-从侧边栏中找到并点击tunnel-菜单。"><span>2. 在进入Zero Trust面板后，从侧边栏中找到并点击<code>Tunnel</code> 菜单。</span></a></h4><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/5c827c3bad07a645e7e07c2de17e81d59f89e15d.png" alt="2" tabindex="0" loading="lazy"><figcaption>2</figcaption></figure><h4 id="_3-创建一条隧道-cf侧" tabindex="-1"><a class="header-anchor" href="#_3-创建一条隧道-cf侧"><span>3. 创建一条隧道（cf侧）</span></a></h4><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/02cb3149d94ba32fc195572fd389656e1bdb5685_2_690x357.png" alt="3" tabindex="0" loading="lazy"><figcaption>3</figcaption></figure><p>3.1 隧道类型选<code>Cloudflared</code></p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/864a1395ed78cd3c4d70754631497db7df3f3059_2_593x500.png" alt="4" tabindex="0" loading="lazy"><figcaption>4</figcaption></figure><p>3.2 设置隧道名，名字随便取，我个人习惯于取能够辨识服务器的名称。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/cbe68a5e604f599e7999bd73014339a480936704_2_690x476.png" alt="5" tabindex="0" loading="lazy"><figcaption>5</figcaption></figure><p>3.3 安装环境选<code>Docker</code>，记得复制docker的安装命令以备后用。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/4d511ac73106944616e94027000100be04229862_2_412x500.png" alt="6" tabindex="0" loading="lazy"><figcaption>6</figcaption></figure><p>3.4 不用点下一步，直接在左上角点击返回，即可确认隧道已成功创建。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/caa0578923ff704b38f6b459dfbe542b15716379_2_527x500.png" alt="7" tabindex="0" loading="lazy"><figcaption>7</figcaption></figure><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/a0f3fc6a86582798683703cebbca069dabf3078b_2_690x387.png" alt="8" tabindex="0" loading="lazy"><figcaption>8</figcaption></figure><h4 id="_4-服务器侧隧道设置" tabindex="-1"><a class="header-anchor" href="#_4-服务器侧隧道设置"><span>4. 服务器侧隧道设置</span></a></h4><p>在第<code>3.3</code>节中，我们获得了一个类似于以下的docker命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudflare/cloudflared:latest</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tunnel</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-autoupdate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eyJhIjoiMjQ4MmIzM2Y3Njc3YWE5OWE5NThiZjcxNTdkMzU1ZmYiLCJ0IjoiOTFmYzdhOWQtYThiZC00MmY2LThlOTEtMDMwYWZjNDA3MjRmIiwicyI6IlkyRm1OamM0TXpZdE1qVTBaaTAwTTJZNUxUZ3hOV1V0TXpOaE9XVmpNV1F4Wm1ZeCJ9</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>先别着急用，需要添加几个docker参数，<strong>注意network需要设置为host</strong> 。讲一下我之前遇到的坑，docker启动容器默认会使用桥接模式（bridge），在后面域名绑定时，<code>127.0.0.1:port</code> 是cloudflared这个容器内部的地址，如果你的项目也是使用docker的桥接模式启动的，那么就无法找到对应的服务。当然也可以用<code>172.17.0.1:port</code> 这个地址进行绑定，但还是建议让cloudflared容器以host模式启动。</p><p>docker启动命令</p><div class="language-css line-numbers-mode" data-highlighter="shiki" data-ext="css" data-title="css" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">docker run -d --restart always --network host --name cloudflared cloudflare</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">cloudflared tunnel --no-autoupdate run --token eyJhIjoiMjQ4MmIzM2Y3Njc3YWE5OWE5NThiZjcxNTdkMzU1ZmYiLCJ0IjoiOTFmYzdhOWQtYThiZC00MmY2LThlOTEtMDMwYWZjNDA3MjRmIiwicyI6IlkyRm1OamM0TXpZdE1qVTBaaTAwTTJZNUxUZ3hOV1V0TXpOaE9XVmpNV1F4Wm1ZeCJ9</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>or</p><p>docker-compose配置</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloudflared</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cloudflare/cloudflared</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cloudflared</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    network_mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">host</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    command</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">tunnel --no-autoupdate run --token eyJhIjoiMjQ4MmIzM2Y3Njc3YWE5OWE5NThiZjcxNTdkMzU1ZmYiLCJ0IjoiOTFmYzdhOWQtYThiZC00MmY2LThlOTEtMDMwYWZjNDA3MjRmIiwicyI6IlkyRm1OamM0TXpZdE1qVTBaaTAwTTJZNUxUZ3hOV1V0TXpOaE9XVmpNV1F4Wm1ZeCJ9</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-配置域名和部署项目的绑定" tabindex="-1"><a class="header-anchor" href="#_5-配置域名和部署项目的绑定"><span>5. 配置域名和部署项目的绑定</span></a></h4><p>5.1 点击前面创建的隧道<code>Configure</code></p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/5c2314c9ffef2d038efb2893347cd21cf49a551f_2_690x479.png" alt="9" tabindex="0" loading="lazy"><figcaption>9</figcaption></figure><p>5.2 添加<code>Public Hostname</code></p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/8283349ea1a8c64fc4a881a0473c2b832e0792a1_2_648x500.png" alt="10" tabindex="0" loading="lazy"><figcaption>10</figcaption></figure><p>5.3 配置域名与服务器上的项目端口，类型有很多可选的，选http即可。</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/9c762d00a84e6eb13431e8d9c6aae83764b2f419_2_689x417.png" alt="11" tabindex="0" loading="lazy"><figcaption>11</figcaption></figure><p>5.4 配置完成后，尝试访问你的域名以确认是否设置成功。</p>`,46)),a(t,{colorful:"",service:"email,qq,qzone,qrcode,weibo,telegram,twitter"})])}const k=n(p,[["render",g],["__file","Cloudflare Tunnel使用教程.html.vue"]]),m=JSON.parse('{"path":"/linux/Cloudflare%20Tunnel%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html","title":"Cloudflare Tunnel使用教程","lang":"zh-CN","frontmatter":{"title":"Cloudflare Tunnel使用教程","excerpt":"Cloudflare Tunnel使用教程","description":"Cloudflare Tunnel使用教程","date":"2024-05-20T00:00:00.000Z","category":"Linux","tag":"Linux","author":"xlc520","article":true,"timeline":true,"icon":"linux","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/linux/Cloudflare%20Tunnel%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"Cloudflare Tunnel使用教程"}],["meta",{"property":"og:description","content":"Cloudflare Tunnel使用教程"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/434450a3b007e4730f6bddc45c9c8300d59d7cd6.jpeg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-04T13:58:25.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2024-05-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-04T13:58:25.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Cloudflare Tunnel使用教程\\",\\"image\\":[\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/434450a3b007e4730f6bddc45c9c8300d59d7cd6.jpeg\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/1686c86ae9810ed5471ce436746fe84047e26949_2_269x500.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/5c827c3bad07a645e7e07c2de17e81d59f89e15d.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/02cb3149d94ba32fc195572fd389656e1bdb5685_2_690x357.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/864a1395ed78cd3c4d70754631497db7df3f3059_2_593x500.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/cbe68a5e604f599e7999bd73014339a480936704_2_690x476.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/4d511ac73106944616e94027000100be04229862_2_412x500.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/caa0578923ff704b38f6b459dfbe542b15716379_2_527x500.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/a0f3fc6a86582798683703cebbca069dabf3078b_2_690x387.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/5c2314c9ffef2d038efb2893347cd21cf49a551f_2_690x479.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/8283349ea1a8c64fc4a881a0473c2b832e0792a1_2_648x500.png\\",\\"https://bitbucket.org/xlc520/blogasset/raw/main/images/2024/9c762d00a84e6eb13431e8d9c6aae83764b2f419_2_689x417.png\\"],\\"datePublished\\":\\"2024-05-20T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-04T13:58:25.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[{"level":3,"title":"cf tunnel 是什么？","slug":"cf-tunnel-是什么","link":"#cf-tunnel-是什么","children":[]},{"level":3,"title":"有什么用？","slug":"有什么用","link":"#有什么用","children":[]},{"level":3,"title":"如何工作的？","slug":"如何工作的","link":"#如何工作的","children":[]},{"level":3,"title":"开始搭建","slug":"开始搭建","link":"#开始搭建","children":[]}],"git":{"createdTime":1722778427000,"updatedTime":1722779905000,"contributors":[{"name":"xlc","email":"2215400217@qq.com","commits":3}]},"readingTime":{"minutes":3.14,"words":942},"filePathRelative":"linux/Cloudflare Tunnel使用教程.md","localizedDate":"2024年5月20日"}');export{k as comp,m as data};
