import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as t,c as p,a as o}from"./app-CHLzVell.js";const n={},r=o('<h1 id="mysql-调优总结" tabindex="-1"><a class="header-anchor" href="#mysql-调优总结"><span>MySQL 调优总结</span></a></h1><p>一. 表设计与数据类型</p><p>尽量遵循数据库设计三大范式，一些场景可适当建立冗余字段，减少连接查询，但这样这样会破坏第三范式，视情况而定。</p><p>尽量不要设置 null 类型字段，null 类型需要额外的字段来存储，count 不会统计，一些场景也会使索引失效。</p><p>使用 UNSIGNED 无符号类型，可提高正数的数量上限，在一些不需要存储负数的情况下，将类型设置无符号数。</p><p>没有太大的必要使用 BigDecimal 类型，可用 bigint，将小数方法 10^n 存入，这样可以避免浮点数计算不准确和 DECIMAL 精确计算代价高的问题。</p><p>表中的列不要太多，如果列太多而实际使用的列又很少的话，有可能会导致 CPU 占用过高。</p><p>把 IP 地址存成 UNSIGNEDINT，IP 地址转换成 int 类型正好是 int 的有符号取整范围</p><p>设置固定长度的字段会提高性能，因为 MySQL 搜寻得会更快一些，因为这些固定的长度是很容易计算下一个数据的偏移量的，所以读取的自然也会很快。而如果字段不是定长的，那么，每一次要找下一条的话，需要程序找到主键。但是固定长度的字段会浪费一些空间</p><p>url 可以将数据倒序存入数据库,或者字符串进行 crc32 哈希处理</p><p>分库分表</p><p>二. 索引</p><p>创建适当数量的索引，在创建表的时候就创建好索引，尽量避免在表中有大量数据的时候创建索引。</p><p>合适的场景创建覆盖索引</p><p>在区分度高的字段上建立索引</p><p>控制单个索引的长度，如 key(name(8))</p><p>尽量使用自增 id</p><p>在数据不会重复的列上建立唯一索引</p><p>三. SQL</p><p>每一条 sql 都尽量使用 explain 查看执行计划，防止慢 sql 出现</p><p>遵循符合索引最左匹配原则</p><p>尽量不要在索引列上做表达式运算，或使用函数，会使索引失效</p><p>尽量不要使用多个范围查询，会使索引失效</p><p>查看执行计划，如果索引的使用优化器优化有问题，可以强制使用想要适应的索引 force index</p><p>or 查询用 union 优化代替，如果是相同字段的 or，优化为 in 查询</p><p>数据类型出现隐式转换的时候不会命中索引，特别是当列类型是字符串，一定要将字符常量值用引号引起来。</p><p>like 查询尽量使用左匹配</p><p>join 查询，on 连接的字段上一定要建立索引</p><p>避免 select *，避免返回无用字段</p><p>insert 批量插入，不要单条插入</p><p>当仅需要获取一条数据时，使用 limit 1</p><p>四. 程序层面</p><p>使用数据库连接池连接数据库</p><p>使用缓存对查询数据做缓存，如 MyBatis 的一二级缓存、redis 缓存</p><p>五. innodb 参数</p><p>max_connections：允许客户端并发连接的最大数量，默认值是 151，一般将该参数设置为 300-1000</p><p>max_connect_errors：如果客户端尝试连接的错误数量超过这个参数设置的值，则服务器不再接受新的客户端连接。可以通过清空主机的缓存来解除服务器的这种阻止新连接的状态，通过 FLUSH HOSTS 或 mysqladmin flush-hosts 命令来清空缓存。这个参数的默认值是 100，一般将该参数设置为 100000。</p><p>innodb_buffer_pool_size 缓存索引和行数据，在专属 mysql 服务器上，可设置为内存的 80%左右，可减少索引存储在磁盘上，减少 IO</p><p>innodb_thread_concurrency（5.7 版本中已废除） InnoDB 内核中允许的线程数，这个值取决于，硬件，应用，OS scheduler properties，设置的太高会线程上下文切换频繁，降低效率，所以不要设置的太高。推荐 4 核 4 线程（4C4T）值设置为 4-8 即可，最大不建议超过线程数*2</p><p>innodb_write_io_threads： 限制写相关的线程，缺省值为 4</p><p>innodb_read_io_threads： 限制写相关的线程，缺省值为 4</p><p>还有很多其他相关参数，可视情况设置。</p><p>六. 架构</p><p>主从架构，读写分离。</p>',44),a=[r];function i(c,l){return t(),p("div",null,a)}const m=e(n,[["render",i],["__file","MySQL调优总结.html.vue"]]),_=JSON.parse('{"path":"/dev/MySQL%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93.html","title":"MySQL调优总结","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"MySQL调优总结","excerpt":null,"description":"MySQL 调优总结 一. 表设计与数据类型 尽量遵循数据库设计三大范式，一些场景可适当建立冗余字段，减少连接查询，但这样这样会破坏第三范式，视情况而定。 尽量不要设置 null 类型字段，null 类型需要额外的字段来存储，count 不会统计，一些场景也会使索引失效。 使用 UNSIGNED 无符号类型，可提高正数的数量上限，在一些不需要存储负数的...","date":"2023-12-27T00:00:00.000Z","category":"Java","tag":"Java","article":true,"timeline":true,"icon":"java","head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/dev/MySQL%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93.html"}],["meta",{"property":"og:site_name","content":"StudyNote - 丰富的知识笔记库"}],["meta",{"property":"og:title","content":"MySQL调优总结"}],["meta",{"property":"og:description","content":"MySQL 调优总结 一. 表设计与数据类型 尽量遵循数据库设计三大范式，一些场景可适当建立冗余字段，减少连接查询，但这样这样会破坏第三范式，视情况而定。 尽量不要设置 null 类型字段，null 类型需要额外的字段来存储，count 不会统计，一些场景也会使索引失效。 使用 UNSIGNED 无符号类型，可提高正数的数量上限，在一些不需要存储负数的..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-27T13:32:36.000Z"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Java"}],["meta",{"property":"article:published_time","content":"2023-12-27T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-27T13:32:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL调优总结\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-12-27T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-27T13:32:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xlc520\\"}]}"]]},"headers":[],"git":{"createdTime":1706885633000,"updatedTime":1714224756000,"contributors":[{"name":"xlc","email":"2215400217@qq.com","commits":2}]},"readingTime":{"minutes":3.79,"words":1138},"filePathRelative":"dev/MySQL调优总结.md","localizedDate":"2023年12月27日","autoDesc":true}');export{m as comp,_ as data};
