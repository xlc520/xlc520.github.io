<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.37" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://blog.ciberviler.top/linux/Nginx%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD.html"><meta property="og:site_name" content="StudyNote"><meta property="og:title" content="Nginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–"><meta property="og:description" content="Nginx ä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ– å¼•è¨€ ä¸€ã€æ€§èƒ½æ€ªå…½-Nginx æ¦‚å¿µæ·±å…¥æµ…å‡º äºŒã€Nginx ç¯å¢ƒæ­å»º ä¸‰ã€Nginx åå‘ä»£ç†-è´Ÿè½½å‡è¡¡ å››ã€Nginx åŠ¨é™åˆ†ç¦» äº”ã€Nginx èµ„æºå‹ç¼© å…­ã€Nginx ç¼“å†²åŒº ä¸ƒã€Nginx ç¼“å­˜æœºåˆ¶ å…«ã€Nginx å®ç° IP é»‘ç™½åå• ä¹ã€Nginx è·¨åŸŸé…ç½® å..."><meta property="og:type" content="article"><meta property="og:image" content="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-0.jpeg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-27T13:32:36.000Z"><meta property="article:author" content="xlc520"><meta property="article:tag" content="Linux"><meta property="article:published_time" content="2023-01-20T00:00:00.000Z"><meta property="article:modified_time" content="2024-04-27T13:32:36.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Nginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–","image":["https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-0.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929661-1.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929661-2.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929661-3.gif","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-4.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-5.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-6.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-7.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-8.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-9.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-10.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-11.jpeg","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-12.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-13.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-14.png","https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-15.png"],"datePublished":"2023-01-20T00:00:00.000Z","dateModified":"2024-04-27T13:32:36.000Z","author":[{"@type":"Person","name":"xlc520"}]}</script><meta name="robots" content="all"><meta name="author" content="xlc520"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="Java,MySQL,Spring,Redis,MyBatis,SpringBoot,IDEA,JVM,JavaåŸºç¡€,å¹¶å‘ç¼–ç¨‹,è™šæ‹Ÿæœº,æ•°æ®åº“,ç¬”è®°,æ•™ç¨‹,linux,Windows,shell"><meta name="description" content="ä¸ªäººå­¦ä¹ çš„ç¬”è®°ï¼Œè®°å½•å­¦ä¹ è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜ï¼Œå­¦åˆ°çš„çŸ¥è¯†ï¼Œæ”¶é›†å„ç§å­¦ä¹ å·¥å…·ï¼Œå„ç§æŠ€å·§ï¼Œå„ç§ä½¿ç”¨æ•™ç¨‹ã€‚"><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?94d325c8ef98034a16f401082b6295a0";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script><title>Nginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ– | StudyNote</title>
    <link rel="preload" href="/assets/style-BOhTza5Z.css" as="style"><link rel="stylesheet" href="/assets/style-BOhTza5Z.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">StudyNote</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="Home"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="flat-color-icons:home" width="1em" height="1em"></iconify-icon>Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/dev/" aria-label="å¼€å‘"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon>å¼€å‘<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link active" href="/linux/" aria-label="Linux"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:linux-tux" width="1em" height="1em"></iconify-icon>Linux<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å­¦ä¹ "><span class="title"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="arcticons:studyplus" width="1em" height="1em"></iconify-icon>å­¦ä¹ </span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/study/" aria-label="å­¦ä¹ "><iconify-icon class="font-icon icon" style="" mode="style" inline icon="marketeq:note-alt" width="1em" height="1em"></iconify-icon>å­¦ä¹ <!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/study/vue3_quick_study/" aria-label="Vue3+TS å¿«é€Ÿä¸Šæ‰‹"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:vue" width="1em" height="1em"></iconify-icon>Vue3+TS å¿«é€Ÿä¸Šæ‰‹<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/ai/" aria-label="AI"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="token-branded:cgpt" width="1em" height="1em"></iconify-icon>AI<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/algorithm/" aria-label="ç®—æ³•"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park:database-power" width="1em" height="1em"></iconify-icon>ç®—æ³•<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/script/" aria-label="è„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="vscode-icons:file-type-script" width="1em" height="1em"></iconify-icon>è„šæœ¬<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/tools/" aria-label="å·¥å…·"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park:toolkit" width="1em" height="1em"></iconify-icon>å·¥å…·<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/source_code/" aria-label="æºç "><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ph:code-fill" width="1em" height="1em"></iconify-icon>æºç <!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/git/" aria-label="Git"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="skill-icons:git" width="1em" height="1em"></iconify-icon>Git<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/daily/" aria-label="æ—¥å¸¸"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="arcticons:dailyhunt" width="1em" height="1em"></iconify-icon>æ—¥å¸¸<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/pc/" aria-label="ç”µè„‘"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="fluent-emoji-flat:desktop-computer" width="1em" height="1em"></iconify-icon>ç”µè„‘<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/essay/" aria-label="æ–‡ç« "><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ph:article" width="1em" height="1em"></iconify-icon>æ–‡ç« <!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/other/" aria-label="å…¶ä»–"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="basil:other-1-outline" width="1em" height="1em"></iconify-icon>å…¶ä»–<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/xlc520/xlc520.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/" aria-label="Linux"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linux<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/10%E4%B8%AA%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%84Python%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC.html" aria-label="10ä¸ªæœ€å¸¸ç”¨çš„Pythonè¿ç»´è‡ªåŠ¨åŒ–è„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>10ä¸ªæœ€å¸¸ç”¨çš„Pythonè¿ç»´è‡ªåŠ¨åŒ–è„šæœ¬<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/CentOS%E3%80%81Ubuntu%E3%80%81Debian%E3%80%81Alpine%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85%E6%BA%90.html" aria-label="CentOSã€Ubuntuã€Debianã€Alpineæ›´æ¢å›½å†…æº"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>CentOSã€Ubuntuã€Debianã€Alpineæ›´æ¢å›½å†…æº<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Centos7Minimal.html" aria-label="Centos7 Minimal å®‰è£…ååˆå§‹åŒ–é…ç½®"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Centos7 Minimal å®‰è£…ååˆå§‹åŒ–é…ç½®<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Cloudfalre%20Tunnels%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html" aria-label="Cloudfalre Tunnelså®ç°å†…ç½‘ç©¿é€"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Cloudfalre Tunnelså®ç°å†…ç½‘ç©¿é€<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/CNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B.html" aria-label="CNSæœåŠ¡å™¨æ­å»ºæ•™ç¨‹"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>CNSæœåŠ¡å™¨æ­å»ºæ•™ç¨‹<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Debian.html" aria-label="Debian"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Debian<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Docker%E5%AE%89%E8%A3%85Oracle.html" aria-label="Dockerå®‰è£…Oracle"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Dockerå®‰è£…Oracle<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Docker%E6%90%AD%E5%BB%BAOnlyOffice.html" aria-label="Dockeræ­å»ºOnlyOffice"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Dockeræ­å»ºOnlyOffice<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Docker%E6%97%B6%E5%8C%BA.html" aria-label="Dockeræ—¶åŒº"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Dockeræ—¶åŒº<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/ESXI-iKuai-OpenWrt.html" aria-label="ESXI-iKuai-OpenWrt"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>ESXI-iKuai-OpenWrt<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Euserv.html" aria-label="Euserv"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="page" width="1em" height="1em"></iconify-icon>Euserv<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/exsi-%E9%BB%91%E7%BE%A4%E6%99%96-%E7%88%B1%E5%BF%AB-openwrt.html" aria-label="exsi-é»‘ç¾¤æ™–-çˆ±å¿«-openwrt"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>exsi-é»‘ç¾¤æ™–-çˆ±å¿«-openwrt<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/kubeadm%20%E5%AE%89%E8%A3%85%20Kubernetes-1.26.1%E9%9B%86%E7%BE%A4.html" aria-label="kubeadm å®‰è£… Kubernetes-1.26.1é›†ç¾¤"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>kubeadm å®‰è£… Kubernetes-1.26.1é›†ç¾¤<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/kubernetes%E7%AC%94%E8%AE%B0.html" aria-label="kubernetesç¬”è®°"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>kubernetesç¬”è®°<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%20%E5%AE%89%E5%85%A8.html" aria-label="Linux å®‰å…¨"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linux å®‰å…¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%20%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC.html" aria-label="Linux ç³»ç»Ÿæ—¥å¸¸è¿ç»´å·¡æ£€è„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linux ç³»ç»Ÿæ—¥å¸¸è¿ç»´å·¡æ£€è„šæœ¬<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E4%BD%BF%E7%94%A8safe-rm%E9%98%B2%E6%AD%A2%E8%AF%AF%E5%88%A0%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6.html" aria-label="Linuxä½¿ç”¨safe-rmé˜²æ­¢è¯¯åˆ ç³»ç»Ÿæ–‡ä»¶"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linuxä½¿ç”¨safe-rmé˜²æ­¢è¯¯åˆ ç³»ç»Ÿæ–‡ä»¶<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E5%8F%91%E9%80%81tcp%E5%8C%85%E6%9C%80%E7%AE%80%E5%8D%95%E6%96%B9%E6%B3%95-netcat.html" aria-label="Linuxå‘é€udptcpåŒ…æœ€ç®€å•æ–¹æ³•-netcat"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linuxå‘é€udptcpåŒ…æœ€ç®€å•æ–¹æ³•-netcat<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%A5%9E%E5%99%A8Cockpit.html" aria-label="Linuxå›¾å½¢åŒ–ç®¡ç†æœåŠ¡å™¨çš„ç¥å™¨ï¼šCockpit"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linuxå›¾å½¢åŒ–ç®¡ç†æœåŠ¡å™¨çš„ç¥å™¨ï¼šCockpit<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E5%BC%80%E6%9C%BA%E5%8D%A1%E5%9C%A8%20A%20start%20job%20is%20runing%E8%A7%A3%E5%86%B3.html" aria-label="Linuxå¼€æœºå¡åœ¨ A start job is runingè§£å†³"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linuxå¼€æœºå¡åœ¨ A start job is runingè§£å†³<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E6%96%B0%E5%BC%80%E6%9C%BA%E5%99%A8%E9%85%8D%E7%BD%AE.html" aria-label="Linuxæ–°å¼€æœºå™¨é…ç½®"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linuxæ–°å¼€æœºå™¨é…ç½®<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E7%BA%A7%E5%88%AB%E4%B8%BA5%EF%BC%8C%E5%90%AF%E5%8A%A8%E5%90%8E%E5%8D%B4%E6%B2%A1%E6%9C%89%E8%BF%9B%E5%85%A5%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E8%BF%9B%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3.html" aria-label="Linuxæ— è®ºæ€ä¹ˆè®¾ç½®å¼€æœºå¯åŠ¨çº§åˆ«æ²¡æœ‰è¿›å…¥å›¾å½¢åŒ–ç•Œé¢"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Linuxæ— è®ºæ€ä¹ˆè®¾ç½®å¼€æœºå¯åŠ¨çº§åˆ«æ²¡æœ‰è¿›å…¥å›¾å½¢åŒ–ç•Œé¢<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E6%80%BB%E7%BB%93.html" aria-label="Linuxç³»ç»Ÿæ€»ç»“"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Linuxç³»ç»Ÿæ€»ç»“<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Linux%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7.html" aria-label="Linuxè„šæœ¬å·¥å…·"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Linuxè„šæœ¬å·¥å…·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/MySQL.html" aria-label="MySQL 8"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>MySQL 8<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/MySQL%E5%8E%8B%E7%BC%A9%E7%89%88%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html" aria-label="MySQLå‹ç¼©ç‰ˆå®‰è£…é…ç½®"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>MySQLå‹ç¼©ç‰ˆå®‰è£…é…ç½®<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/NFS%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85%E5%92%8C%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85.html" aria-label="NFSåœ¨çº¿å®‰è£…å’Œç¦»çº¿å®‰è£…"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>NFSåœ¨çº¿å®‰è£…å’Œç¦»çº¿å®‰è£…<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Nginx-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA.html" aria-label="Nginx-å®‰å…¨åŠ å›º"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Nginx-å®‰å…¨åŠ å›º<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/linux/Nginx%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD.html" aria-label="Nginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Nginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Nginx%E4%B8%87%E5%AD%97%E6%80%BB%E7%BB%93.html" aria-label="Nginxä¸‡å­—æ€»ç»“"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Nginxä¸‡å­—æ€»ç»“<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Nginx%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E9%AB%98%E5%8F%AF%E7%94%A8.html" aria-label="Nginxä»å®‰è£…åˆ°é«˜å¯ç”¨"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Nginxä»å®‰è£…åˆ°é«˜å¯ç”¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Nginx%E5%AE%89%E8%A3%85Web%E5%BA%94%E7%94%A8%E9%98%B2%E7%81%AB%E5%A2%99.html" aria-label="Nginxå®‰è£…Webåº”ç”¨é˜²ç«å¢™"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Nginxå®‰è£…Webåº”ç”¨é˜²ç«å¢™<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Nginx%E6%90%AD%E5%BB%BAhttp%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8.html" aria-label="Nginxæ­å»ºhttpä»£ç†æœåŠ¡å™¨"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Nginxæ­å»ºhttpä»£ç†æœåŠ¡å™¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/openresty%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html" aria-label="openrestyä¸€é”®å®‰è£…éƒ¨ç½²è„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>openrestyä¸€é”®å®‰è£…éƒ¨ç½²è„šæœ¬<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/openssl%E4%B8%80%E9%94%AE%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.html" aria-label="Opensslä¸€é”®è‡ªç­¾è¯ä¹¦"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="page" width="1em" height="1em"></iconify-icon>Opensslä¸€é”®è‡ªç­¾è¯ä¹¦<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/OpenSSL%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6.html" aria-label="OpenSSLç”Ÿæˆè‡ªç­¾åè¯ä¹¦"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>OpenSSLç”Ÿæˆè‡ªç­¾åè¯ä¹¦<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80.html" aria-label="Oracleæ•°æ®åº“åŸºç¡€"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Oracleæ•°æ®åº“åŸºç¡€<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Oracle%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA-%E6%95%B0%E6%8D%AE%E5%BA%93.html" aria-label="Oracleçš„æ•°æ® å¯¼å…¥ä¸å¯¼å‡º-æ•°æ®åº“"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Oracleçš„æ•°æ® å¯¼å…¥ä¸å¯¼å‡º-æ•°æ®åº“<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/pnpm%E3%80%81yarn%E5%92%8Cnpm%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8%E6%B7%98%E5%AE%9D%E9%95%9C%E5%83%8F%E5%92%8C%E5%AF%B9%E6%AF%94.html" aria-label="pnpmã€yarnå’ŒnpmåŒ…ç®¡ç†å™¨æ·˜å®é•œåƒå’Œå¯¹æ¯”"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>pnpmã€yarnå’ŒnpmåŒ…ç®¡ç†å™¨æ·˜å®é•œåƒå’Œå¯¹æ¯”<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Podman%E5%BC%80%E6%BA%90%E7%9A%84%E5%AE%B9%E5%99%A8.html" aria-label="Podmanå¼€æºçš„å®¹å™¨"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>Podmanå¼€æºçš„å®¹å™¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/python%E5%AE%89%E8%A3%85%E6%BA%90.html" aria-label="pythonå®‰è£…æº"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>pythonå®‰è£…æº<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/serv00%E6%90%AD%E5%BB%BA%E5%90%84%E7%A7%8D%E6%9C%8D%E5%8A%A1.html" aria-label="serv00æ­å»ºå„ç§æœåŠ¡"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>serv00æ­å»ºå„ç§æœåŠ¡<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/SSH%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6.html" aria-label="SSHå®¢æˆ·ç«¯è½¯ä»¶"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>SSHå®¢æˆ·ç«¯è½¯ä»¶<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/tmpfiles.d%E4%B8%AD%E6%96%87%E6%89%8B%E5%86%8C.html" aria-label="tmpfiles.d ä¸­æ–‡æ‰‹å†Œ"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>tmpfiles.d ä¸­æ–‡æ‰‹å†Œ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Ubuntu%20%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%20Wine%20-%E8%BF%90%E8%A1%8C%20Windows%20%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.html" aria-label="Ubuntu å®‰è£…å’Œä½¿ç”¨ Wine -è¿è¡Œ Windows åº”ç”¨ç¨‹åº"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Ubuntu å®‰è£…å’Œä½¿ç”¨ Wine -è¿è¡Œ Windows åº”ç”¨ç¨‹åº<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Ubuntu%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87.html" aria-label="Ubuntué…ç½®ä¸­æ–‡"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Ubuntué…ç½®ä¸­æ–‡<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/vim%E6%93%8D%E4%BD%9C.html" aria-label="vimæ“ä½œ"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>vimæ“ä½œ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/VMware-Esxi.html" aria-label="VMware-Esxi å„ä¸ªç‰ˆæœ¬é•œåƒæ–‡ä»¶isoä¸‹è½½é“¾æ¥"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>VMware-Esxi å„ä¸ªç‰ˆæœ¬é•œåƒæ–‡ä»¶isoä¸‹è½½é“¾æ¥<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Windows10%E5%AE%89%E8%A3%85WSA.html" aria-label="Windows 10 å®‰è£… WSA"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Windows 10 å®‰è£… WSA<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/Windows%E5%AD%90%E7%B3%BB%E7%BB%9FWSL.html" aria-label="Windows å­ç³»ç»Ÿ WSL"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Windows å­ç³»ç»Ÿ WSL<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/WSL1%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98.html" aria-label="WSL é—®é¢˜"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>WSL é—®é¢˜<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E4%B8%8D%E6%94%AF%E6%8C%81%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84AMD-V.html" aria-label="ä¸»æœºæ”¯æŒAMD-Vä½†å¤„äºç¦ç”¨?ä¸æ”¯æŒè™šæ‹ŸåŒ–çš„AMD-Vï¼Ÿæ— æ³•æ‰“å¼€BIOS"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>ä¸»æœºæ”¯æŒAMD-Vä½†å¤„äºç¦ç”¨?ä¸æ”¯æŒè™šæ‹ŸåŒ–çš„AMD-Vï¼Ÿæ— æ³•æ‰“å¼€BIOS<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/NodeJS-Maven-Mysql.html" aria-label="å®‰è£…NodeJS-Maven-Mysql"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="page" width="1em" height="1em"></iconify-icon>å®‰è£…NodeJS-Maven-Mysql<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/bt.html" aria-label="å®å¡”é¢æ¿ç»•è¿‡ç»‘å®šè´¦å·"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>å®å¡”é¢æ¿ç»•è¿‡ç»‘å®šè´¦å·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E5%AE%9E%E7%94%A8%20shell%20%E8%84%9A%E6%9C%AC.html" aria-label="å®ç”¨ shell è„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon>å®ç”¨ shell è„šæœ¬<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E6%80%9D%E7%A7%91%E3%80%81%E5%8D%8E%E4%B8%BA%E3%80%81H3C%E5%91%BD%E4%BB%A4%E5%AF%B9%E7%85%A7%E8%A1%A8.html" aria-label="æ€ç§‘ã€åä¸ºã€H3Cå‘½ä»¤å¯¹ç…§è¡¨"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>æ€ç§‘ã€åä¸ºã€H3Cå‘½ä»¤å¯¹ç…§è¡¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8EDockerDesktop-WSL2.html" aria-label="æ­å»ºåŸºäºDocker Desktop - WSL2"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>æ­å»ºåŸºäºDocker Desktop - WSL2<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5.html" aria-label="æœåŠ¡å™¨å…¥ä¾µæ’æŸ¥"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>æœåŠ¡å™¨å…¥ä¾µæ’æŸ¥<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7.html" aria-label="æœåŠ¡å™¨è¿è¡Œæ•°æ®æŸ¥çœ‹å·¥å…·"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>æœåŠ¡å™¨è¿è¡Œæ•°æ®æŸ¥çœ‹å·¥å…·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E8%87%AA%E5%8A%A8%E5%B0%81%E7%A6%81IP%E8%84%9A%E6%9C%AC.html" aria-label="è‡ªåŠ¨å°ç¦IPè„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>è‡ªåŠ¨å°ç¦IPè„šæœ¬<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E8%AF%A6%E8%A7%A3K8S%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2.html" aria-label="è¯¦è§£ K8S é«˜å¯ç”¨éƒ¨ç½²"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>è¯¦è§£ K8S é«˜å¯ç”¨éƒ¨ç½²<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/linux/%E8%BF%90%E7%BB%B4%E8%84%9A%E6%9C%AC.html" aria-label="è¿ç»´è„šæœ¬"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>è¿ç»´è„šæœ¬<!----></a></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Nginxä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">xlc520</span></span><span property="author" content="xlc520"></span></span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-20T00:00:00.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category2 clickable" role="navigation">Linux</span><!--]--><meta property="articleSection" content="Linux"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag2 clickable" role="navigation">Linux</span><!--]--><meta property="keywords" content="Linux"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 44 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT44M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 13089 å­—</span><meta property="wordCount" content="13089"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¼•è¨€">å¼•è¨€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€æ€§èƒ½æ€ªå…½-nginx-æ¦‚å¿µæ·±å…¥æµ…å‡º">ä¸€ã€æ€§èƒ½æ€ªå…½-Nginx æ¦‚å¿µæ·±å…¥æµ…å‡º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€nginx-ç¯å¢ƒæ­å»º">äºŒã€Nginx ç¯å¢ƒæ­å»º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸‰ã€nginx-åå‘ä»£ç†-è´Ÿè½½å‡è¡¡">ä¸‰ã€Nginx åå‘ä»£ç†-è´Ÿè½½å‡è¡¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å››ã€nginx-åŠ¨é™åˆ†ç¦»">å››ã€Nginx åŠ¨é™åˆ†ç¦»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº”ã€nginx-èµ„æºå‹ç¼©">äº”ã€Nginx èµ„æºå‹ç¼©</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…­ã€nginx-ç¼“å†²åŒº">å…­ã€Nginx ç¼“å†²åŒº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸ƒã€nginx-ç¼“å­˜æœºåˆ¶">ä¸ƒã€Nginx ç¼“å­˜æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…«ã€nginx-å®ç°-ip-é»‘ç™½åå•">å…«ã€Nginx å®ç° IP é»‘ç™½åå•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¹ã€nginx-è·¨åŸŸé…ç½®">ä¹ã€Nginx è·¨åŸŸé…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åã€nginx-é˜²ç›—é“¾è®¾è®¡">åã€Nginx é˜²ç›—é“¾è®¾è®¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åä¸€ã€nginx-å¤§æ–‡ä»¶ä¼ è¾“é…ç½®">åä¸€ã€Nginx å¤§æ–‡ä»¶ä¼ è¾“é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åäºŒã€nginx-é…ç½®-sll-è¯ä¹¦">åäºŒã€Nginx é…ç½® SLL è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åä¸‰ã€nginx-çš„é«˜å¯ç”¨">åä¸‰ã€Nginx çš„é«˜å¯ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åå››ã€nginx-æ€§èƒ½ä¼˜åŒ–">åå››ã€Nginx æ€§èƒ½ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åäº”ã€æ”¾åœ¨æœ€åçš„ç»“å°¾">åäº”ã€æ”¾åœ¨æœ€åçš„ç»“å°¾</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="nginx-ä¸€ç½‘æ‰“å°½-åŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#nginx-ä¸€ç½‘æ‰“å°½-åŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–"><span>Nginx ä¸€ç½‘æ‰“å°½ï¼šåŠ¨é™åˆ†ç¦»ã€å‹ç¼©ã€ç¼“å­˜ã€é»‘ç™½åå•ã€è·¨åŸŸã€é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–</span></a></h1><ul><li>å¼•è¨€</li><li>ä¸€ã€æ€§èƒ½æ€ªå…½-Nginx æ¦‚å¿µæ·±å…¥æµ…å‡º</li><li>äºŒã€Nginx ç¯å¢ƒæ­å»º</li><li>ä¸‰ã€Nginx åå‘ä»£ç†-è´Ÿè½½å‡è¡¡</li><li>å››ã€Nginx åŠ¨é™åˆ†ç¦»</li><li>äº”ã€Nginx èµ„æºå‹ç¼©</li><li>å…­ã€Nginx ç¼“å†²åŒº</li><li>ä¸ƒã€Nginx ç¼“å­˜æœºåˆ¶</li><li>å…«ã€Nginx å®ç° IP é»‘ç™½åå•</li><li>ä¹ã€Nginx è·¨åŸŸé…ç½®</li><li>åã€Nginx é˜²ç›—é“¾è®¾è®¡</li><li>åä¸€ã€Nginx å¤§æ–‡ä»¶ä¼ è¾“é…ç½®</li><li>åäºŒã€Nginx é…ç½® SLL è¯ä¹¦</li><li>åä¸‰ã€Nginx çš„é«˜å¯ç”¨</li><li>åå››ã€Nginx æ€§èƒ½ä¼˜åŒ–</li><li>åäº”ã€æ”¾åœ¨æœ€åçš„ç»“å°¾</li></ul><h2 id="å¼•è¨€" tabindex="-1"><a class="header-anchor" href="#å¼•è¨€"><span>å¼•è¨€</span></a></h2><p>æ—©æœŸçš„ä¸šåŠ¡éƒ½æ˜¯åŸºäºå•ä½“èŠ‚ç‚¹éƒ¨ç½²ï¼Œç”±äºå‰æœŸè®¿é—®æµé‡ä¸å¤§ï¼Œå› æ­¤å•ä½“ç»“æ„ä¹Ÿå¯æ»¡è¶³éœ€æ±‚ï¼Œä½†éšç€ä¸šåŠ¡å¢é•¿ï¼Œæµé‡ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œé‚£ä¹ˆæœ€ç»ˆå•å°æœåŠ¡å™¨å—åˆ°çš„è®¿é—®å‹åŠ›ä¹Ÿä¼šé€æ­¥å¢é«˜ã€‚æ—¶é—´ä¸€é•¿ï¼Œå•å°æœåŠ¡å™¨æ€§èƒ½æ— æ³•è·Ÿä¸Šä¸šåŠ¡å¢é•¿ï¼Œå°±ä¼šé€ æˆçº¿ä¸Šé¢‘ç¹å®•æœºçš„ç°è±¡å‘ç”Ÿï¼Œæœ€ç»ˆå¯¼è‡´ç³»ç»Ÿç˜«ç—ªæ— æ³•ç»§ç»­å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚</p><blockquote><p>â</p><p>ä»ä¸Šé¢çš„æè¿°ä¸­ï¼Œä¸»è¦å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼šâ‘ å•ä½“ç»“æ„çš„éƒ¨ç½²æ–¹å¼æ— æ³•æ‰¿è½½æ—¥ç›Šå¢é•¿çš„ä¸šåŠ¡æµé‡ã€‚â‘¡å½“åç«¯èŠ‚ç‚¹å®•æœºåï¼Œæ•´ä¸ªç³»ç»Ÿä¼šé™·å…¥ç˜«ç—ªï¼Œå¯¼è‡´æ•´ä¸ªé¡¹ç›®ä¸å¯ç”¨ã€‚</p><p>â</p></blockquote><p>å› æ­¤åœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼Œå¼•å…¥è´Ÿè½½å‡è¡¡æŠ€æœ¯å¯å¸¦æ¥çš„æ”¶ç›Šï¼š</p><ul><li><strong>ã€Œç³»ç»Ÿçš„é«˜å¯ç”¨ï¼šã€</strong> å½“æŸä¸ªèŠ‚ç‚¹å®•æœºåå¯ä»¥è¿…é€Ÿå°†æµé‡è½¬ç§»è‡³å…¶ä»–èŠ‚ç‚¹ã€‚</li><li><strong>ã€Œç³»ç»Ÿçš„é«˜æ€§èƒ½ï¼šã€</strong> å¤šå°æœåŠ¡å™¨å…±åŒå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›äº†æ›´é«˜è§„æ¨¡çš„ååã€‚</li><li><strong>ã€Œç³»ç»Ÿçš„æ‹“å±•æ€§ï¼šã€</strong> å½“ä¸šåŠ¡å†æ¬¡å‡ºç°å¢é•¿æˆ–èé¡æ—¶ï¼Œå¯å†åŠ å…¥/å‡å°‘èŠ‚ç‚¹ï¼Œçµæ´»ä¼¸ç¼©ã€‚</li></ul><p>OK~ï¼Œæ—¢ç„¶å¼•å…¥è´Ÿè½½å‡è¡¡æŠ€æœ¯å¯ç»™æˆ‘ä»¬å¸¦æ¥å¦‚æ­¤å·¨å¤§çš„å¥½å¤„ï¼Œé‚£ä¹ˆåˆæœ‰é‚£äº›æ–¹æ¡ˆå¯ä¾›é€‰æ‹©å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ç§è´Ÿè½½æ–¹æ¡ˆï¼Œ<strong>ã€Œã€Œç¡¬ä»¶å±‚é¢ä¸è½¯ä»¶å±‚é¢ã€ã€ ** ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç¡¬ä»¶è´Ÿè½½å™¨æœ‰<code>A10ã€F5</code> ç­‰ï¼Œä½†è¿™äº›æœºå™¨åŠ¨è¾„å¤§å‡ ä¸‡ä¹ƒè‡³å‡ åä¸‡çš„æˆæœ¬ï¼Œå› æ­¤ä¸€èˆ¬å¤§å‹ä¼ä¸šä¼šé‡‡ç”¨è¯¥æ–¹æ¡ˆï¼Œå¦‚é“¶è¡Œã€å›½ä¼ã€å¤®ä¼ç­‰ã€‚è€Œæˆæœ¬æœ‰é™ï¼Œä½†ä¾æ—§æƒ³åšè´Ÿè½½å‡è¡¡çš„é¡¹ç›®ï¼Œé‚£ä¹ˆå¯åœ¨è½¯ä»¶å±‚é¢å®ç°ï¼Œå¦‚å…¸å‹çš„<code>Nginx</code> ç­‰ï¼Œè½¯ä»¶å±‚çš„è´Ÿè½½ä¹Ÿæ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæ¯•ç«Ÿ<code>Boss</code>ä»¬çš„å‡†åˆ™ä¹‹ä¸€å°±æ˜¯ï¼š</strong>ã€Œã€Œèƒ½é æŠ€æœ¯å®ç°çš„å°±å°½é‡ä¸èŠ±é’±ã€‚ã€ã€**</p><blockquote><p>â</p><p>å½“ç„¶ï¼Œå¦‚æœä½ è®¤ä¸ºæœ¬æ–‡å¯¹ä½ è€Œè¨€æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµã€æ”¶è—ã€å…³æ³¨ä¸‰è¿å™¢ï¼</p><p>â</p></blockquote><h2 id="ä¸€ã€æ€§èƒ½æ€ªå…½-nginx-æ¦‚å¿µæ·±å…¥æµ…å‡º" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ€§èƒ½æ€ªå…½-nginx-æ¦‚å¿µæ·±å…¥æµ…å‡º"><span>ä¸€ã€æ€§èƒ½æ€ªå…½-Nginx æ¦‚å¿µæ·±å…¥æµ…å‡º</span></a></h2><p><code>Nginx</code>æ˜¯ç›®å‰è´Ÿè½½å‡è¡¡æŠ€æœ¯ä¸­çš„ä¸»æµæ–¹æ¡ˆï¼Œå‡ ä¹ç»å¤§éƒ¨åˆ†é¡¹ç›®éƒ½ä¼šä½¿ç”¨å®ƒï¼Œ<code>Nginx</code>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§èƒ½<code>HTTP</code> åå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€šç”¨ç±»å‹çš„ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒç»å¤§éƒ¨åˆ†åè®®ï¼Œå¦‚<code>TCPã€UDPã€SMTPã€HTTPS</code>ç­‰ã€‚</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-0.jpeg" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p><code>Nginx</code>ä¸ Redis ç›¸åŒï¼Œéƒ½æ˜¯åŸºäºå¤šè·¯å¤ç”¨æ¨¡å‹æ„å»ºå‡ºçš„äº§ç‰©ï¼Œå› æ­¤å®ƒä¸<code>Redis</code>åŒæ ·å…·å¤‡ <strong>ã€Œã€Œèµ„æºå ç”¨å°‘ã€å¹¶å‘æ”¯æŒé«˜ã€ã€</strong> çš„ç‰¹ç‚¹ï¼Œåœ¨ç†è®ºä¸Šå•èŠ‚ç‚¹çš„<code>Nginx</code>åŒæ—¶æ”¯æŒ<code>5W</code>å¹¶å‘è¿æ¥ï¼Œè€Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç¡¬ä»¶åŸºç¡€åˆ°ä½å†ç»“åˆç®€å•è°ƒä¼˜åç¡®å®èƒ½è¾¾åˆ°è¯¥æ•°å€¼ã€‚</p><p>å…ˆæ¥çœ‹çœ‹<code>Nginx</code>å¼•å…¥å‰åï¼Œå®¢æˆ·ç«¯è¯·æ±‚å¤„ç†æµç¨‹çš„å¯¹æ¯”ï¼š</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929661-1.jpeg" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>åŸæœ¬å®¢æˆ·ç«¯æ˜¯ç›´æ¥è¯·æ±‚ç›®æ ‡æœåŠ¡å™¨ï¼Œç”±ç›®æ ‡æœåŠ¡å™¨ç›´æ¥å®Œæˆè¯·æ±‚å¤„ç†å·¥ä½œï¼Œä½†åŠ å…¥<code>Nginx</code>åï¼Œæ‰€æœ‰çš„è¯·æ±‚ä¼šå…ˆç»è¿‡<code>Nginx</code> ï¼Œå†ç”±å…¶è¿›è¡Œåˆ†å‘åˆ°å…·ä½“çš„æœåŠ¡å™¨å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†è¿”å›<code>Nginx</code>ï¼Œæœ€åç”±<code>Nginx</code>å°†æœ€ç»ˆçš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>äº†è§£äº†<code>Nginx</code>çš„åŸºæœ¬æ¦‚å¿µåï¼Œå†æ¥å¿«é€Ÿæ­å»ºä¸€ä¸‹ç¯å¢ƒï¼Œä»¥åŠäº†è§£ä¸€äº›<code>Nginx</code>çš„é«˜çº§ç‰¹æ€§ï¼Œå¦‚åŠ¨é™åˆ†ç¦»ã€èµ„æºå‹ç¼©ã€ç¼“å­˜é…ç½®ã€<code>IP</code> é»‘åå•ã€é«˜å¯ç”¨ä¿éšœç­‰ã€‚</p><h2 id="äºŒã€nginx-ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#äºŒã€nginx-ç¯å¢ƒæ­å»º"><span>äºŒã€Nginx ç¯å¢ƒæ­å»º</span></a></h2><p>â¶é¦–å…ˆåˆ›å»º<code>Nginx</code>çš„ç›®å½•å¹¶è¿›å…¥ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# mkdir /soft &amp;&amp; mkdir /soft/nginx/  
[root@localhost]# cd /soft/nginx/  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â·ä¸‹è½½<code>Nginx</code>çš„å®‰è£…åŒ…ï¼Œå¯ä»¥é€šè¿‡<code>FTP</code>å·¥å…·ä¸Šä¼ ç¦»çº¿ç¯å¢ƒåŒ…ï¼Œä¹Ÿå¯é€šè¿‡<code>wget</code>å‘½ä»¤åœ¨çº¿è·å–å®‰è£…åŒ…ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# wget https://nginx.org/download/nginx-1.21.6.tar.gz  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ²¡æœ‰<code>wget</code>å‘½ä»¤çš„å¯é€šè¿‡<code>yum</code>å‘½ä»¤å®‰è£…ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# yum -y install wget  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â¸è§£å‹<code>Nginx</code>çš„å‹ç¼©åŒ…ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# tar -xvzf nginx-1.21.6.tar.gz  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â¹ä¸‹è½½å¹¶å®‰è£…<code>Nginx</code>æ‰€éœ€çš„ä¾èµ–åº“å’ŒåŒ…ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# yum install --downloadonly --downloaddir=/soft/nginx/ gcc-c++  
[root@localhost]# yum install --downloadonly --downloaddir=/soft/nginx/ pcre pcre-devel4  
[root@localhost]# yum install --downloadonly --downloaddir=/soft/nginx/ zlib zlib-devel  
[root@localhost]# yum install --downloadonly --downloaddir=/soft/nginx/ openssl openssl-devel 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>yum</code>å‘½ä»¤ä¸€é”®ä¸‹è½½ï¼ˆæ¨èä¸Šé¢å“ªç§æ–¹å¼ï¼‰ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œæˆåï¼Œç„¶å<code>ls</code>æŸ¥çœ‹ç›®å½•æ–‡ä»¶ï¼Œä¼šçœ‹ä¸€å¤§å †ä¾èµ–ï¼š</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929661-2.jpeg" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>ç´§æ¥ç€é€šè¿‡<code>rpm</code>å‘½ä»¤ä¾æ¬¡å°†ä¾èµ–åŒ…ä¸€ä¸ªä¸ªæ„å»ºï¼Œæˆ–è€…é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# rpm -ivh --nodeps *.rpm  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>âºè¿›å…¥è§£å‹åçš„<code>nginx</code>ç›®å½•ï¼Œç„¶åæ‰§è¡Œ<code>Nginx</code>çš„é…ç½®è„šæœ¬ï¼Œä¸ºåç»­çš„å®‰è£…æå‰é…ç½®å¥½ç¯å¢ƒï¼Œé»˜è®¤ä½äº<code>/usr/local/nginx/</code>ç›®å½•ä¸‹ï¼ˆå¯è‡ªå®šä¹‰ç›®å½•ï¼‰ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# cd nginx-1.21.6  
[root@localhost]# ./configure --prefix=/soft/nginx/  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â»ç¼–è¯‘å¹¶å®‰è£…<code>Nginx</code>ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# make &amp;&amp; make install  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â¼æœ€åå›åˆ°å‰é¢çš„<code>/soft/nginx/</code>ç›®å½•ï¼Œè¾“å…¥<code>ls</code>å³å¯çœ‹è§å®‰è£…<code>nginx</code>å®Œæˆåç”Ÿæˆçš„æ–‡ä»¶ã€‚</p><p>â½ä¿®æ”¹å®‰è£…åç”Ÿæˆçš„<code>conf</code>ç›®å½•ä¸‹çš„<code>nginx.conf</code>é…ç½®æ–‡ä»¶ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# vi conf/nginx.conf  
    ä¿®æ”¹ç«¯å£å·ï¼šlisten    80;  
 ä¿®æ”¹IPåœ°å€ï¼šserver_name  ä½ å½“å‰æœºå™¨çš„æœ¬åœ°IP(çº¿ä¸Šé…ç½®åŸŸå);  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â¾åˆ¶å®šé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨<code>Nginx</code>ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# sbin/nginx -c conf/nginx.conf  
[root@localhost]# ps aux | grep nginx  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Nginx</code>å…¶ä»–æ“ä½œå‘½ä»¤ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>sbin/nginx -t -c conf/nginx.conf # æ£€æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æ­£å¸¸  
sbin/nginx -s reload -c conf/nginx.conf # ä¿®æ”¹é…ç½®åå¹³æ»‘é‡å¯  
sbin/nginx -s quit # ä¼˜é›…å…³é—­Nginxï¼Œä¼šåœ¨æ‰§è¡Œå®Œå½“å‰çš„ä»»åŠ¡åå†é€€å‡º  
sbin/nginx -s stop # å¼ºåˆ¶ç»ˆæ­¢Nginxï¼Œä¸ç®¡å½“å‰æ˜¯å¦æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œ  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â¿å¼€æ”¾<code>80</code>ç«¯å£ï¼Œå¹¶æ›´æ–°é˜²ç«å¢™ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# firewall-cmd --zone=public --add-port=80/tcp --permanent  
[root@localhost]# firewall-cmd --reload  
[root@localhost]# firewall-cmd --zone=public --list-ports  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â“«åœ¨<code>Windows/Mac</code>çš„æµè§ˆå™¨ä¸­ï¼Œç›´æ¥è¾“å…¥åˆšåˆšé…ç½®çš„<code>IP</code>åœ°å€è®¿é—®<code>Nginx</code>ï¼š</p><p>æœ€ç»ˆçœ‹åˆ°å¦‚ä¸Šçš„<code>Nginx</code>æ¬¢è¿ç•Œé¢ï¼Œä»£è¡¨<code>Nginx</code>å®‰è£…å®Œæˆã€‚</p><h2 id="ä¸‰ã€nginx-åå‘ä»£ç†-è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€nginx-åå‘ä»£ç†-è´Ÿè½½å‡è¡¡"><span>ä¸‰ã€Nginx åå‘ä»£ç†-è´Ÿè½½å‡è¡¡</span></a></h2><p>é¦–å…ˆé€šè¿‡<code>SpringBoot+Freemarker</code>å¿«é€Ÿæ­å»ºä¸€ä¸ª<code>WEB</code> é¡¹ç›®ï¼šspringboot-web-nginxï¼Œç„¶ååœ¨è¯¥é¡¹ç›®ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª<code>IndexNginxController.java</code>æ–‡ä»¶ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>@Controller  
public class IndexNginxController {  
    @Value(&quot;${server.port}&quot;)  
    private String port;  
  
    @RequestMapping(&quot;/&quot;)  
    public ModelAndView index(){  
        ModelAndView model = new ModelAndView();  
        model.addObject(&quot;port&quot;, port);  
        model.setViewName(&quot;index&quot;);  
        return model;  
    }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¯¥<code>Controller</code>ç±»ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæˆå‘˜å˜é‡ï¼š<code>port</code>ï¼Œå®ƒçš„å€¼å³æ˜¯ä»<code>application.properties</code>é…ç½®æ–‡ä»¶ä¸­è·å–<code>server.port</code> å€¼ã€‚å½“å‡ºç°è®¿é—®<code>/</code>èµ„æºçš„è¯·æ±‚æ—¶ï¼Œè·³è½¬å‰ç«¯<code>index</code>é¡µé¢ï¼Œå¹¶å°†è¯¥å€¼æºå¸¦è¿”å›ã€‚</p><p>å‰ç«¯çš„<code>index.ftl</code>æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>&lt;html&gt;  
    &lt;head&gt;  
        &lt;title&gt;Nginxæ¼”ç¤ºé¡µé¢&lt;/title&gt;  
        &lt;link href=&quot;nginx_style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;  
    &lt;/head&gt;  
    &lt;body&gt;  
        &lt;div style=&quot;border: 2px solid red;margin: auto;width: 800px;text-align: center&quot;&gt;  
            &lt;div  id=&quot;nginx_title&quot;&gt;  
                &lt;h1&gt;æ¬¢è¿æ¥åˆ°ç†ŠçŒ«é«˜çº§ä¼šæ‰€ï¼Œæˆ‘æ˜¯ç«¹å­${port}å·ï¼&lt;/h1&gt;  
            &lt;/div&gt;  
        &lt;/div&gt;  
    &lt;/body&gt;  
&lt;/html&gt;  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šå¯ä»¥çœ‹å‡ºå…¶é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œä»…æ˜¯ä»å“åº”ä¸­è·å–äº†<code>port</code>è¾“å‡ºã€‚</p><p>OK~ï¼Œå‰æå·¥ä½œå‡†å¤‡å°±ç»ªåï¼Œå†ç®€å•ä¿®æ”¹ä¸€ä¸‹<code>nginx.conf</code>çš„é…ç½®å³å¯ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>upstream nginx_boot{  
   # 30så†…æ£€æŸ¥å¿ƒè·³å‘é€ä¸¤æ¬¡åŒ…ï¼Œæœªå›å¤å°±ä»£è¡¨è¯¥æœºå™¨å®•æœºï¼Œè¯·æ±‚åˆ†å‘æƒé‡æ¯”ä¸º1:2  
   server 192.168.0.000:8080 weight=100 max_fails=2 fail_timeout=30s;   
   server 192.168.0.000:8090 weight=200 max_fails=2 fail_timeout=30s;  
   # è¿™é‡Œçš„IPè¯·é…ç½®æˆä½ WEBæœåŠ¡æ‰€åœ¨çš„æœºå™¨IP  
}  
  
server {  
    location / {  
        root   html;  
        # é…ç½®ä¸€ä¸‹indexçš„åœ°å€ï¼Œæœ€ååŠ ä¸Šindex.ftlã€‚  
        index  index.html index.htm index.jsp index.ftl;  
        proxy_set_header Host $host;  
        proxy_set_header X-Real-IP $remote_addr;  
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  
        # è¯·æ±‚äº¤ç»™åä¸ºnginx_bootçš„upstreamä¸Š  
        proxy_pass http://nginx_boot;  
    }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>â</p><p>è‡³æ­¤ï¼Œæ‰€æœ‰çš„å‰æå·¥ä½œå‡†å¤‡å°±ç»ªï¼Œç´§æ¥ç€å†å¯åŠ¨<code>Nginx</code>ï¼Œç„¶åå†å¯åŠ¨ä¸¤ä¸ª<code>web</code>æœåŠ¡ï¼Œç¬¬ä¸€ä¸ª<code>WEB</code> æœåŠ¡å¯åŠ¨æ—¶ï¼Œåœ¨<code>application.properties</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†ç«¯å£å·æ”¹ä¸º<code>8080</code>ï¼Œç¬¬äºŒä¸ª<code>WEB</code>æœåŠ¡å¯åŠ¨æ—¶ï¼Œå°†å…¶ç«¯å£å·æ”¹ä¸º<code>8090</code>ã€‚</p><p>â</p></blockquote><p>æœ€ç»ˆæ¥çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929661-3.gif" alt="Nginx" loading="lazy">è´Ÿè½½å‡è¡¡æ•ˆæœ-åŠ¨å›¾æ¼”ç¤º</p><p>å› ä¸ºé…ç½®äº†è¯·æ±‚åˆ†å‘çš„æƒé‡ï¼Œ<code>8080ã€8090</code>çš„æƒé‡æ¯”ä¸º<code>2:1</code>ï¼Œå› æ­¤è¯·æ±‚ä¼šæ ¹æ®æƒé‡æ¯”å‡æ‘Šåˆ°æ¯å°æœºå™¨ï¼Œä¹Ÿå°±æ˜¯<code>8080</code>ä¸€æ¬¡ã€<code>8090</code> ä¸¤æ¬¡ã€<code>8080</code>ä¸€æ¬¡â€¦â€¦</p><h4 id="nginx-è¯·æ±‚åˆ†å‘åŸç†" tabindex="-1"><a class="header-anchor" href="#nginx-è¯·æ±‚åˆ†å‘åŸç†"><span>Nginx è¯·æ±‚åˆ†å‘åŸç†</span></a></h4><p>å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚<code>192.168.12.129</code>æœ€ç»ˆä¼šè½¬å˜ä¸ºï¼š<code>http://192.168.12.129:80/</code>ï¼Œç„¶åå†å‘ç›®æ ‡<code>IP</code>å‘èµ·è¯·æ±‚ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-4.jpeg" alt="Nginx" loading="lazy">è¯·æ±‚åˆ†å‘åŸç†</p><ul><li>ç”±äº<code>Nginx</code>ç›‘å¬äº†<code>192.168.12.129</code>çš„<code>80</code>ç«¯å£ï¼Œæ‰€ä»¥æœ€ç»ˆè¯¥è¯·æ±‚ä¼šæ‰¾åˆ°<code>Nginx</code>è¿›ç¨‹ï¼›</li><li><code>Nginx</code>é¦–å…ˆä¼šæ ¹æ®é…ç½®çš„<code>location</code>è§„åˆ™è¿›è¡ŒåŒ¹é…ï¼Œæ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚è·¯å¾„<code>/</code>ï¼Œä¼šå®šä½åˆ°<code>location /{}</code>è§„åˆ™ï¼›</li><li>ç„¶åæ ¹æ®è¯¥<code>location</code>ä¸­é…ç½®çš„<code>proxy_pass</code>ä¼šå†æ‰¾åˆ°åä¸º<code>nginx_boot</code>çš„<code>upstream</code>ï¼›</li><li>æœ€åæ ¹æ®<code>upstream</code>ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°è¿è¡Œ<code>WEB</code>æœåŠ¡çš„æœºå™¨å¤„ç†ï¼Œç”±äºé…ç½®äº†å¤šä¸ª<code>WEB</code>æœåŠ¡ï¼Œä¸”é…ç½®äº†æƒé‡å€¼ï¼Œå› æ­¤<code>Nginx</code> ä¼šä¾æ¬¡æ ¹æ®æƒé‡æ¯”åˆ†å‘è¯·æ±‚ã€‚</li></ul><h2 id="å››ã€nginx-åŠ¨é™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#å››ã€nginx-åŠ¨é™åˆ†ç¦»"><span>å››ã€Nginx åŠ¨é™åˆ†ç¦»</span></a></h2><p>åŠ¨é™åˆ†ç¦»åº”è¯¥æ˜¯å¬çš„æ¬¡æ•°è¾ƒå¤šçš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œé‚£å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š<strong>ã€Œã€Œä¸ºä»€ä¹ˆéœ€è¦åšåŠ¨é™åˆ†ç¦»å‘¢ï¼Ÿå®ƒå¸¦æ¥çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿã€ã€</strong> å…¶å®è¿™ä¸ªé—®é¢˜ä¹Ÿå¹¶ä¸éš¾å›ç­”ï¼Œå½“ä½ ææ‡‚äº†ç½‘ç«™çš„æœ¬è´¨åï¼Œè‡ªç„¶å°±ç†è§£äº†åŠ¨é™åˆ†ç¦»çš„é‡è¦æ€§ã€‚å…ˆæ¥ä»¥æ·˜å®ä¸ºä¾‹åˆ†æçœ‹çœ‹ï¼š</p><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-5.jpeg" alt="Nginx" loading="lazy">æ·˜å®é¦–é¡µ</p><p>å½“æµè§ˆå™¨è¾“å…¥<code>www.taobao.com</code>è®¿é—®æ·˜å®é¦–é¡µæ—¶ï¼Œæ‰“å¼€å¼€å‘è€…è°ƒè¯•å·¥å…·å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œé¦–é¡µåŠ è½½ä¼šå‡ºç°<code>100+</code> çš„è¯·æ±‚æ•°ï¼Œè€Œæ­£å¸¸é¡¹ç›®å¼€å‘æ—¶ï¼Œé™æ€èµ„æºä¸€èˆ¬ä¼šæ”¾å…¥åˆ°<code>resources/static/</code>ç›®å½•ä¸‹ï¼š</p><p>![Nginx](data:image/svg+xml,%3C%3Fxml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;%3F%3E%3Csvg width=&#39;1px&#39; height=&#39;1px&#39; viewBox=&#39;0 0 1 1&#39; version=&#39;1.1&#39; xmlns=&#39;<a href="http://www.w3.org/2000/svg" target="_blank" rel="noopener noreferrer">http://www.w3.org/2000/svg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>&#39; xmlns: xlink=&#39;<a href="http://www.w3.org/1999/xlink&#39;%3E%3Ctitle%3E%3C/title%3E%3Cg" target="_blank" rel="noopener noreferrer">http://www.w3.org/1999/xlink&#39;&gt;&lt;title&gt;&lt;/title&gt;&lt;g<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> stroke=&#39;none&#39; stroke-width=&#39;1&#39; fill=&#39;none&#39; fill-rule=&#39;evenodd&#39; fill-opacity=&#39;0&#39;%3E%3Cg transform=&#39;translate(-249.000000, -126.000000)&#39; fill=&#39;%23FFFFFF&#39;%3E%3Crect x=&#39;249&#39; y=&#39;126&#39; width=&#39;1&#39; height=&#39;1&#39;%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)IDEA å·¥ç¨‹ç»“æ„</p><p>åœ¨é¡¹ç›®ä¸Šçº¿éƒ¨ç½²æ—¶ï¼Œè¿™äº›é™æ€èµ„æºä¼šä¸€èµ·æ‰“æˆåŒ…ï¼Œé‚£æ­¤æ—¶æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š**ã€Œã€Œå‡è®¾æ·˜å®ä¹Ÿæ˜¯è¿™æ ·å¹²çš„ï¼Œé‚£ä¹ˆé¦–é¡µåŠ è½½æ—¶çš„è¯·æ±‚æœ€ç»ˆä¼šå»åˆ°å“ªå„¿è¢«å¤„ç†ï¼Ÿã€ã€ ** ç­”æ¡ˆæ¯‹åº¸ç½®ç–‘ï¼Œé¦–é¡µ<code>100+</code>çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæ¥åˆ°éƒ¨ç½²<code>WEB</code> æœåŠ¡çš„æœºå™¨å¤„ç†ï¼Œé‚£åˆ™ä»£è¡¨ç€ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ·˜å®é¦–é¡µï¼Œå°±ä¼šå¯¹åç«¯æœåŠ¡å™¨é€ æˆ<code>100+</code>çš„å¹¶å‘è¯·æ±‚ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™å¯¹äºåç«¯æœåŠ¡å™¨çš„å‹åŠ›æ˜¯å°¤ä¸ºå·¨å¤§çš„ã€‚</p><blockquote><p>â</p><p>ä½†æ­¤æ—¶ä¸å¦¨åˆ†æçœ‹çœ‹ï¼Œé¦–é¡µ<code>100+</code>çš„è¯·æ±‚ä¸­ï¼Œæ˜¯ä¸æ˜¯è‡³å°‘æœ‰<code>60+</code>æ˜¯å±äº<code>*.jsã€*.cssã€*.htmlã€*.jpg.....</code> è¿™ç±»é™æ€èµ„æºçš„è¯·æ±‚å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<code>Yes</code>ã€‚</p><p>â</p></blockquote><p>æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šè¯·æ±‚å±äºé™æ€çš„ï¼Œè¿™äº›èµ„æºå¤§æ¦‚ç‡æƒ…å†µä¸‹ï¼Œé•¿æ—¶é—´ä¹Ÿä¸ä¼šå‡ºç°å˜åŠ¨ï¼Œé‚£ä¸ºä½•è¿˜è¦è®©è¿™äº›è¯·æ±‚åˆ°åç«¯å†å¤„ç†å‘¢ï¼Ÿèƒ½ä¸èƒ½åœ¨æ­¤ä¹‹å‰å°±æå‰å¤„ç†æ‰ï¼Ÿå½“ç„¶<code>OK</code> ï¼Œå› æ­¤ç»è¿‡åˆ†æä¹‹åèƒ½å¤Ÿæ˜ç¡®ä¸€ç‚¹ï¼š<strong>ã€Œã€Œåšäº†åŠ¨é™åˆ†ç¦»ä¹‹åï¼Œè‡³å°‘èƒ½å¤Ÿè®©åç«¯æœåŠ¡å‡å°‘ä¸€åŠä»¥ä¸Šçš„å¹¶å‘é‡ã€‚ã€ã€</strong> åˆ°æ­¤æ—¶å¤§å®¶åº”è¯¥æ˜ç™½äº†åŠ¨é™åˆ†ç¦»èƒ½å¤Ÿå¸¦æ¥çš„æ€§èƒ½æ”¶ç›Šç©¶ç«Ÿæœ‰å¤šå¤§ã€‚</p><hr><p>OK~ï¼Œææ¸…æ¥šåŠ¨é™åˆ†ç¦»çš„å¿…è¦æ€§ä¹‹åï¼Œå¦‚ä½•å®ç°åŠ¨é™åˆ†ç¦»å‘¢ï¼Ÿå…¶å®éå¸¸ç®€å•ï¼Œå®æˆ˜çœ‹çœ‹ã€‚</p><p>â‘ å…ˆåœ¨éƒ¨ç½²<code>Nginx</code>çš„æœºå™¨ï¼Œ<code>Nginx</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•<code>static_resources</code>ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>mkdir static_resources  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â‘¡å°†é¡¹ç›®ä¸­æ‰€æœ‰çš„é™æ€èµ„æºå…¨éƒ¨æ‹·è´åˆ°è¯¥ç›®å½•ä¸‹ï¼Œè€Œåå°†é¡¹ç›®ä¸­çš„é™æ€èµ„æºç§»é™¤é‡æ–°æ‰“åŒ…ã€‚</p><p>â‘¢ç¨å¾®ä¿®æ”¹ä¸€ä¸‹<code>nginx.conf</code>çš„é…ç½®ï¼Œå¢åŠ ä¸€æ¡<code>location</code>åŒ¹é…è§„åˆ™ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css){  
    root   /soft/nginx/static_resources;  
    expires 7d;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åç…§å¸¸å¯åŠ¨<code>nginx</code>å’Œç§»é™¤äº†é™æ€èµ„æºçš„<code>WEB</code>æœåŠ¡ï¼Œä½ ä¼šå‘ç°åŸæœ¬çš„æ ·å¼ã€<code>js</code>æ•ˆæœã€å›¾ç‰‡ç­‰ä¾æ—§æœ‰æ•ˆï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-6.jpeg" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>å…¶ä¸­<code>static</code>ç›®å½•ä¸‹çš„<code>nginx_style.css</code>æ–‡ä»¶å·²è¢«ç§»é™¤ï¼Œä½†æ•ˆæœä¾æ—§å­˜åœ¨ï¼ˆç»¿è‰²å­—ä½“+è“è‰²å¤§è¾¹æ¡†)ï¼š</p><p>![Nginx](data:image/svg+xml,%3C%3Fxml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;%3F%3E%3Csvg width=&#39;1px&#39; height=&#39;1px&#39; viewBox=&#39;0 0 1 1&#39; version=&#39;1.1&#39; xmlns=&#39;<a href="http://www.w3.org/2000/svg" target="_blank" rel="noopener noreferrer">http://www.w3.org/2000/svg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>&#39; xmlns: xlink=&#39;<a href="http://www.w3.org/1999/xlink&#39;%3E%3Ctitle%3E%3C/title%3E%3Cg" target="_blank" rel="noopener noreferrer">http://www.w3.org/1999/xlink&#39;&gt;&lt;title&gt;&lt;/title&gt;&lt;g<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> stroke=&#39;none&#39; stroke-width=&#39;1&#39; fill=&#39;none&#39; fill-rule=&#39;evenodd&#39; fill-opacity=&#39;0&#39;%3E%3Cg transform=&#39;translate(-249.000000, -126.000000)&#39; fill=&#39;%23FFFFFF&#39;%3E%3Crect x=&#39;249&#39; y=&#39;126&#39; width=&#39;1&#39; height=&#39;1&#39;%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E)ç§»é™¤åæ•ˆæœåŠ¨å›¾</p><p>æœ€åè§£è¯»ä¸€ä¸‹é‚£æ¡ location è§„åˆ™ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>~</code>ä»£è¡¨åŒ¹é…æ—¶åŒºåˆ†å¤§å°å†™</li><li><code>.*</code>ä»£è¡¨ä»»æ„å­—ç¬¦éƒ½å¯ä»¥å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œå³èµ„æºåä¸é™åˆ¶</li><li><code>\.</code>ä»£è¡¨åŒ¹é…åç¼€åˆ†éš”ç¬¦.</li><li><code>(html|...|css)</code>ä»£è¡¨åŒ¹é…æ‹¬å·é‡Œæ‰€æœ‰é™æ€èµ„æºç±»å‹</li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œç®€å•ä¸€å¥è¯æ¦‚è¿°ï¼šè¯¥é…ç½®è¡¨ç¤ºåŒ¹é…ä»¥<code>.html~.css</code>ä¸ºåç¼€çš„æ‰€æœ‰èµ„æºè¯·æ±‚ã€‚</p><p><strong>ã€Œæœ€åæä¸€å˜´ï¼Œä¹Ÿå¯ä»¥å°†é™æ€èµ„æºä¸Šä¼ åˆ°æ–‡ä»¶æœåŠ¡å™¨ä¸­ï¼Œç„¶å<code>location</code>ä¸­é…ç½®ä¸€ä¸ªæ–°çš„<code>upstream</code>æŒ‡å‘ã€‚ã€</strong></p><h2 id="äº”ã€nginx-èµ„æºå‹ç¼©" tabindex="-1"><a class="header-anchor" href="#äº”ã€nginx-èµ„æºå‹ç¼©"><span>äº”ã€Nginx èµ„æºå‹ç¼©</span></a></h2><p>å»ºç«‹åœ¨åŠ¨é™åˆ†ç¦»çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¦‚æœä¸€ä¸ªé™æ€èµ„æºçš„<code>Size</code> è¶Šå°ï¼Œé‚£ä¹ˆè‡ªç„¶ä¼ è¾“é€Ÿåº¦ä¼šæ›´å¿«ï¼ŒåŒæ—¶ä¹Ÿä¼šæ›´èŠ‚çœå¸¦å®½ï¼Œå› æ­¤æˆ‘ä»¬åœ¨éƒ¨ç½²é¡¹ç›®æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>Nginx</code> å¯¹äºé™æ€èµ„æºå®ç°å‹ç¼©ä¼ è¾“ï¼Œä¸€æ–¹é¢å¯ä»¥èŠ‚çœå¸¦å®½èµ„æºï¼Œç¬¬äºŒæ–¹é¢ä¹Ÿå¯ä»¥åŠ å¿«å“åº”é€Ÿåº¦å¹¶æå‡ç³»ç»Ÿæ•´ä½“ååã€‚</p><p>åœ¨<code>Nginx</code>ä¹Ÿæä¾›äº†ä¸‰ä¸ªæ”¯æŒèµ„æºå‹ç¼©çš„æ¨¡å—<code>ngx_http_gzip_moduleã€ngx_http_gzip_static_moduleã€ngx_http_gunzip_module</code> ï¼Œå…¶ä¸­<code>ngx_http_gzip_module</code>å±äºå†…ç½®æ¨¡å—ï¼Œä»£è¡¨ç€å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ¨¡å—ä¸‹çš„ä¸€äº›å‹ç¼©æŒ‡ä»¤ï¼Œåç»­çš„èµ„æºå‹ç¼©æ“ä½œéƒ½åŸºäºè¯¥æ¨¡å—ï¼Œå…ˆæ¥çœ‹çœ‹å‹ç¼©é…ç½®çš„ä¸€äº›å‚æ•°/æŒ‡ä»¤ï¼š</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-7.png" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>äº†è§£äº†<code>Nginx</code>ä¸­çš„åŸºæœ¬å‹ç¼©é…ç½®åï¼Œæ¥ä¸‹æ¥å¯ä»¥åœ¨<code>Nginx</code>ä¸­ç®€å•é…ç½®ä¸€ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>http{
    # å¼€å¯å‹ç¼©æœºåˆ¶
    gzip on;
    # æŒ‡å®šä¼šè¢«å‹ç¼©çš„æ–‡ä»¶ç±»å‹(ä¹Ÿå¯è‡ªå·±é…ç½®å…¶ä»–ç±»å‹)
    gzip_types text/plain application/javascript text/css application/xml text/javascript image/jpeg image/gif image/png;
    # è®¾ç½®å‹ç¼©çº§åˆ«ï¼Œè¶Šé«˜èµ„æºæ¶ˆè€—è¶Šå¤§ï¼Œä½†å‹ç¼©æ•ˆæœè¶Šå¥½
    gzip_comp_level 5;
    # åœ¨å¤´éƒ¨ä¸­æ·»åŠ Vary: Accept-Encodingï¼ˆå»ºè®®å¼€å¯ï¼‰
    gzip_vary on;
    # å¤„ç†å‹ç¼©è¯·æ±‚çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°
    gzip_buffers 16 8k;
    # å¯¹äºä¸æ”¯æŒå‹ç¼©åŠŸèƒ½çš„å®¢æˆ·ç«¯è¯·æ±‚ä¸å¼€å¯å‹ç¼©æœºåˆ¶
    gzip_disable &quot;MSIE [1-6]\.&quot;; # ä½ç‰ˆæœ¬çš„IEæµè§ˆå™¨ä¸æ”¯æŒå‹ç¼©
    # è®¾ç½®å‹ç¼©å“åº”æ‰€æ”¯æŒçš„HTTPæœ€ä½ç‰ˆæœ¬
    gzip_http_version 1.1;
    # è®¾ç½®è§¦å‘å‹ç¼©çš„æœ€å°é˜ˆå€¼
    gzip_min_length 2k;
    # å…³é—­å¯¹åç«¯æœåŠ¡å™¨çš„å“åº”ç»“æœè¿›è¡Œå‹ç¼©
    gzip_proxied off;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°çš„å‹ç¼©é…ç½®ä¸­ï¼Œæœ€åä¸€ä¸ª<code>gzip_proxied</code>é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®ç³»ç»Ÿçš„å®é™…æƒ…å†µå†³å®šï¼Œæ€»å…±å­˜åœ¨å¤šç§é€‰é¡¹ï¼š</p><ul><li><code>off</code>ï¼šå…³é—­<code>Nginx</code>å¯¹åå°æœåŠ¡å™¨çš„å“åº”ç»“æœè¿›è¡Œå‹ç¼©ã€‚</li><li><code>expired</code>ï¼šå¦‚æœå“åº”å¤´ä¸­åŒ…å«<code>Expires</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>no-cache</code>ï¼šå¦‚æœå“åº”å¤´ä¸­åŒ…å«<code>Cache-Control:no-cache</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>no-store</code>ï¼šå¦‚æœå“åº”å¤´ä¸­åŒ…å«<code>Cache-Control:no-store</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>private</code>ï¼šå¦‚æœå“åº”å¤´ä¸­åŒ…å«<code>Cache-Control:private</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>no_last_modified</code>ï¼šå¦‚æœå“åº”å¤´ä¸­ä¸åŒ…å«<code>Last-Modified</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>no_etag</code>ï¼šå¦‚æœå“åº”å¤´ä¸­ä¸åŒ…å«<code>ETag</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>auth</code>ï¼šå¦‚æœå“åº”å¤´ä¸­åŒ…å«<code>Authorization</code>ä¿¡æ¯ï¼Œåˆ™å¼€å¯å‹ç¼©ã€‚</li><li><code>any</code>ï¼šæ— æ¡ä»¶å¯¹åç«¯çš„å“åº”ç»“æœå¼€å¯å‹ç¼©æœºåˆ¶ã€‚</li></ul><p>OK~ï¼Œç®€å•ä¿®æ”¹å¥½äº†<code>Nginx</code>çš„å‹ç¼©é…ç½®åï¼Œå¯ä»¥åœ¨åŸæœ¬çš„<code>index</code>é¡µé¢ä¸­å¼•å…¥ä¸€ä¸ª<code>jquery-3.6.0.js</code>æ–‡ä»¶ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>&lt;script type=&quot;text/javascript&quot; src=&quot;jquery-3.6.0.js&quot;&gt;&lt;/script&gt;  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ†åˆ«æ¥å¯¹æ¯”ä¸‹å‹ç¼©å‰åçš„åŒºåˆ«ï¼š</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-8.png" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>ä»å›¾ä¸­å¯ä»¥å¾ˆæ˜æ˜¾çœ‹å‡ºï¼Œæœªå¼€å¯å‹ç¼©æœºåˆ¶å‰è®¿é—®æ—¶ï¼Œ<code>js</code>æ–‡ä»¶çš„åŸå§‹å¤§å°ä¸º<code>230K</code>ï¼Œå½“é…ç½®å¥½å‹ç¼©åå†é‡å¯<code>Nginx</code> ï¼Œä¼šå‘ç°æ–‡ä»¶å¤§å°ä»<code>230KBâ†’69KB</code>ï¼Œæ•ˆæœç«‹ç«¿è§å½±ï¼</p><blockquote><p>â</p><p>æ³¨æ„ç‚¹ï¼šâ‘ å¯¹äºå›¾ç‰‡ã€è§†é¢‘ç±»å‹çš„æ•°æ®ï¼Œä¼šé»˜è®¤å¼€å¯å‹ç¼©æœºåˆ¶ï¼Œå› æ­¤ä¸€èˆ¬æ— éœ€å†æ¬¡å¼€å¯å‹ç¼©ã€‚â‘¡å¯¹äº<code>.js</code> æ–‡ä»¶è€Œè¨€ï¼Œéœ€è¦æŒ‡å®šå‹ç¼©ç±»å‹ä¸º<code>application/javascript</code>ï¼Œè€Œå¹¶é<code>text/javascriptã€application/x-javascript</code>ã€‚</p><p>â</p></blockquote><h2 id="å…­ã€nginx-ç¼“å†²åŒº" tabindex="-1"><a class="header-anchor" href="#å…­ã€nginx-ç¼“å†²åŒº"><span>å…­ã€Nginx ç¼“å†²åŒº</span></a></h2><p>å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ¥å…¥<code>Nginx</code>çš„é¡¹ç›®ä¸€èˆ¬è¯·æ±‚æµç¨‹ä¸ºï¼šâ€œå®¢æˆ·ç«¯â†’<code>Nginx</code> â†’æœåŠ¡ç«¯â€ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨ä¸¤ä¸ªè¿æ¥ï¼šâ€œå®¢æˆ·ç«¯â†’<code>Nginx</code>ã€<code>Nginx</code>â†’æœåŠ¡ç«¯â€ï¼Œé‚£ä¹ˆä¸¤ä¸ªä¸åŒçš„è¿æ¥é€Ÿåº¦ä¸ä¸€è‡´ï¼Œå°±ä¼šå½±å“ç”¨æˆ·çš„ä½“éªŒï¼ˆæ¯”å¦‚æµè§ˆå™¨çš„åŠ è½½é€Ÿåº¦è·Ÿä¸ä¸ŠæœåŠ¡ç«¯çš„å“åº”é€Ÿåº¦ï¼‰ã€‚</p><p>å…¶å®ä¹Ÿå°±ç±»ä¼¼ç”µè„‘çš„å†…å­˜è·Ÿä¸ä¸Š<code>CPU</code>é€Ÿåº¦ï¼Œæ‰€ä»¥å¯¹äºç”¨æˆ·é€ æˆçš„ä½“éªŒæ„Ÿæå·®ï¼Œå› æ­¤åœ¨<code>CPU</code>è®¾è®¡æ—¶éƒ½ä¼šåŠ å…¥ä¸‰çº§é«˜é€Ÿç¼“å†²åŒºï¼Œç”¨äºç¼“è§£<code>CPU</code> å’Œå†…å­˜é€Ÿç‡ä¸ä¸€è‡´çš„çŸ›ç›¾ã€‚åœ¨<code>Nginx</code>ä¹ŸåŒæ ·å­˜åœ¨ç¼“å†²åŒºçš„æœºåˆ¶ï¼Œä¸»è¦ç›®çš„å°±åœ¨äºï¼š<strong>ã€Œã€Œç”¨æ¥è§£å†³ä¸¤ä¸ªè¿æ¥ä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…é€ æˆçš„é—®é¢˜ã€ã€</strong> ï¼Œæœ‰äº†ç¼“å†²åï¼Œ<code>Nginx</code>ä»£ç†å¯æš‚å­˜åç«¯çš„å“åº”ï¼Œç„¶åæŒ‰éœ€ä¾›ç»™æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚å…ˆæ¥çœ‹çœ‹ä¸€äº›å…³äºç¼“å†²åŒºçš„é…ç½®é¡¹ï¼š</p><ul><li><p><code>proxy_buffering</code>ï¼šæ˜¯å¦å¯ç”¨ç¼“å†²æœºåˆ¶ï¼Œé»˜è®¤ä¸º<code>on</code>å…³é—­çŠ¶æ€ã€‚</p></li><li><p><code>client_body_buffer_size</code>ï¼šè®¾ç½®ç¼“å†²å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®çš„å†…å­˜å¤§å°ã€‚</p></li><li><p><code>proxy_buffers</code>ï¼šä¸ºæ¯ä¸ªè¯·æ±‚/è¿æ¥è®¾ç½®ç¼“å†²åŒºçš„æ•°é‡å’Œå¤§å°ï¼Œé»˜è®¤<code>4 4k/8k</code>ã€‚</p></li><li><p><code>proxy_buffer_size</code>ï¼šè®¾ç½®ç”¨äºå­˜å‚¨å“åº”å¤´çš„ç¼“å†²åŒºå¤§å°ã€‚</p></li><li><p><code>proxy_busy_buffers_size</code>ï¼šåœ¨åç«¯æ•°æ®æ²¡æœ‰å®Œå…¨æ¥æ”¶å®Œæˆæ—¶ï¼Œ<code>Nginx</code>å¯ä»¥å°†<code>busy</code>çŠ¶æ€çš„ç¼“å†²è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¯¥å‚æ•°ç”¨æ¥è®¾ç½®<code>busy</code> çŠ¶æ€çš„<code>buffer</code>å…·ä½“æœ‰å¤šå¤§ï¼Œé»˜è®¤ä¸º<code>proxy_buffer_size*2</code>ã€‚</p></li><li><p><code>proxy_temp_path</code>ï¼šå½“å†…å­˜ç¼“å†²åŒºå­˜æ»¡æ—¶ï¼Œå¯ä»¥å°†æ•°æ®ä¸´æ—¶å­˜æ”¾åˆ°ç£ç›˜ï¼Œè¯¥å‚æ•°æ˜¯è®¾ç½®å­˜å‚¨ç¼“å†²æ•°æ®çš„ç›®å½•ã€‚</p></li><li><p><code>path</code>æ˜¯ä¸´æ—¶ç›®å½•çš„è·¯å¾„ã€‚</p></li><li><ul><li>è¯­æ³•ï¼š<code>proxy_temp_path path;</code> path æ˜¯ä¸´æ—¶ç›®å½•çš„è·¯å¾„</li></ul></li><li><p><code>proxy_temp_file_write_size</code>ï¼šè®¾ç½®æ¯æ¬¡å†™æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶çš„å¤§å°é™åˆ¶ã€‚</p></li><li><p><code>proxy_max_temp_file_size</code>ï¼šè®¾ç½®ä¸´æ—¶çš„ç¼“å†²ç›®å½•ä¸­å…è®¸å­˜å‚¨çš„æœ€å¤§å®¹é‡ã€‚</p></li><li><p>éç¼“å†²å‚æ•°é¡¹ï¼š</p></li><li><ul><li><code>proxy_connect_timeout</code>ï¼šè®¾ç½®ä¸åç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶çš„è¶…æ—¶æ—¶é—´ã€‚</li><li><code>proxy_read_timeout</code>ï¼šè®¾ç½®ä»åç«¯æœåŠ¡å™¨è¯»å–å“åº”æ•°æ®çš„è¶…æ—¶æ—¶é—´ã€‚</li><li><code>proxy_send_timeout</code>ï¼šè®¾ç½®å‘åç«¯æœåŠ¡å™¨ä¼ è¾“è¯·æ±‚æ•°æ®çš„è¶…æ—¶æ—¶é—´ã€‚</li></ul></li></ul><p>å…·ä½“çš„<code>nginx.conf</code>é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>http{  
    proxy_connect_timeout 10;  
    proxy_read_timeout 120;  
    proxy_send_timeout 10;  
    proxy_buffering on;  
    client_body_buffer_size 512k;  
    proxy_buffers 4 64k;  
    proxy_buffer_size 16k;  
    proxy_busy_buffers_size 128k;  
    proxy_temp_file_write_size 128k;  
    proxy_temp_path /soft/nginx/temp_buffer;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°çš„ç¼“å†²åŒºå‚æ•°ï¼Œæ˜¯åŸºäºæ¯ä¸ªè¯·æ±‚åˆ†é…çš„ç©ºé—´ï¼Œè€Œå¹¶ä¸æ˜¯æ‰€æœ‰è¯·æ±‚çš„å…±äº«ç©ºé—´ã€‚å½“ç„¶ï¼Œå…·ä½“çš„å‚æ•°å€¼è¿˜éœ€è¦æ ¹æ®ä¸šåŠ¡å»å†³å®šï¼Œè¦ç»¼åˆè€ƒè™‘æœºå™¨çš„å†…å­˜ä»¥åŠæ¯ä¸ªè¯·æ±‚çš„å¹³å‡æ•°æ®å¤§å°ã€‚</p><blockquote><p>â</p><p>æœ€åæä¸€å˜´ï¼šä½¿ç”¨ç¼“å†²ä¹Ÿå¯ä»¥å‡å°‘å³æ—¶ä¼ è¾“å¸¦æ¥çš„å¸¦å®½æ¶ˆè€—ã€‚</p><p>â</p></blockquote><h2 id="ä¸ƒã€nginx-ç¼“å­˜æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€nginx-ç¼“å­˜æœºåˆ¶"><span>ä¸ƒã€Nginx ç¼“å­˜æœºåˆ¶</span></a></h2><p>å¯¹äºæ€§èƒ½ä¼˜åŒ–è€Œè¨€ï¼Œç¼“å­˜æ˜¯ä¸€ç§èƒ½å¤Ÿå¤§å¹…åº¦æå‡æ€§èƒ½çš„æ–¹æ¡ˆï¼Œå› æ­¤å‡ ä¹å¯ä»¥åœ¨å„å¤„éƒ½èƒ½çœ‹è§ç¼“å­˜ï¼Œå¦‚å®¢æˆ·ç«¯ç¼“å­˜ã€ä»£ç†ç¼“å­˜ã€æœåŠ¡å™¨ç¼“å­˜ç­‰ç­‰ï¼Œ<code>Nginx</code> çš„ç¼“å­˜åˆ™å±äºä»£ç†ç¼“å­˜çš„ä¸€ç§ã€‚å¯¹äºæ•´ä¸ªç³»ç»Ÿè€Œè¨€ï¼ŒåŠ å…¥ç¼“å­˜å¸¦æ¥çš„ä¼˜åŠ¿é¢å¤–æ˜æ˜¾ï¼š</p><ul><li>å‡å°‘äº†å†æ¬¡å‘åç«¯æˆ–æ–‡ä»¶æœåŠ¡å™¨è¯·æ±‚èµ„æºçš„å¸¦å®½æ¶ˆè€—ã€‚</li><li>é™ä½äº†ä¸‹æ¸¸æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ï¼Œæå‡ç³»ç»Ÿæ•´ä½“ååã€‚</li><li>ç¼©çŸ­äº†å“åº”æ—¶é—´ï¼Œæå‡äº†åŠ è½½é€Ÿåº¦ï¼Œæ‰“å¼€é¡µé¢çš„é€Ÿåº¦æ›´å¿«ã€‚</li></ul><p>é‚£ä¹ˆåœ¨<code>Nginx</code>ä¸­ï¼Œåˆè¯¥å¦‚ä½•é…ç½®ä»£ç†ç¼“å­˜å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹ç¼“å­˜ç›¸å…³çš„é…ç½®é¡¹ï¼š</p><p><strong>ã€Œproxy_cache_pathã€</strong>ï¼šä»£ç†ç¼“å­˜çš„è·¯å¾„ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œå°±æ˜¯è¿™ä¹ˆé•¿â€¦â€¦ï¼Œè§£é‡Šä¸€ä¸‹æ¯ä¸ªå‚æ•°é¡¹çš„å«ä¹‰ï¼š</p><ul><li><code>path</code>ï¼šç¼“å­˜çš„è·¯å¾„åœ°å€ã€‚</li><li><code>levels</code>ï¼šç¼“å­˜å­˜å‚¨çš„å±‚æ¬¡ç»“æ„ï¼Œæœ€å¤šå…è®¸ä¸‰å±‚ç›®å½•ã€‚</li><li><code>use_temp_path</code>ï¼šæ˜¯å¦ä½¿ç”¨ä¸´æ—¶ç›®å½•ã€‚</li><li><code>keys_zone</code>ï¼šæŒ‡å®šä¸€ä¸ªå…±äº«å†…å­˜ç©ºé—´æ¥å­˜å‚¨çƒ­ç‚¹ Key(1M å¯å­˜å‚¨ 8000 ä¸ª Key)ã€‚</li><li><code>inactive</code>ï¼šè®¾ç½®ç¼“å­˜å¤šé•¿æ—¶é—´æœªè¢«è®¿é—®ååˆ é™¤ï¼ˆé»˜è®¤æ˜¯ååˆ†é’Ÿï¼‰ã€‚</li><li><code>max_size</code>ï¼šå…è®¸ç¼“å­˜çš„æœ€å¤§å­˜å‚¨ç©ºé—´ï¼Œè¶…å‡ºåä¼šåŸºäº LRU ç®—æ³•ç§»é™¤ç¼“å­˜ï¼ŒNginx ä¼šåˆ›å»ºä¸€ä¸ª Cache manager çš„è¿›ç¨‹ç§»é™¤æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ purge æ–¹å¼ã€‚</li><li><code>manager_files</code>ï¼šmanager è¿›ç¨‹æ¯æ¬¡ç§»é™¤ç¼“å­˜æ–‡ä»¶æ•°é‡çš„ä¸Šé™ã€‚</li><li><code>manager_sleep</code>ï¼šmanager è¿›ç¨‹æ¯æ¬¡ç§»é™¤ç¼“å­˜æ–‡ä»¶çš„æ—¶é—´ä¸Šé™ã€‚</li><li><code>manager_threshold</code>ï¼šmanager è¿›ç¨‹æ¯æ¬¡ç§»é™¤ç¼“å­˜åçš„é—´éš”æ—¶é—´ã€‚</li><li><code>loader_files</code>ï¼šé‡å¯ Nginx è½½å…¥ç¼“å­˜æ—¶ï¼Œæ¯æ¬¡åŠ è½½çš„ä¸ªæ•°ï¼Œé»˜è®¤ 100ã€‚</li><li><code>loader_sleep</code>ï¼šæ¯æ¬¡è½½å…¥æ—¶ï¼Œå…è®¸çš„æœ€å¤§æ—¶é—´ä¸Šé™ï¼Œé»˜è®¤ 200msã€‚</li><li><code>loader_threshold</code>ï¼šä¸€æ¬¡è½½å…¥åï¼Œåœé¡¿çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤ 50msã€‚</li><li><code>purger</code>ï¼šæ˜¯å¦å¼€å¯ purge æ–¹å¼ç§»é™¤æ•°æ®ã€‚</li><li><code>purger_files</code>ï¼šæ¯æ¬¡ç§»é™¤ç¼“å­˜æ–‡ä»¶æ—¶çš„æ•°é‡ã€‚</li><li><code>purger_sleep</code>ï¼šæ¯æ¬¡ç§»é™¤æ—¶ï¼Œå…è®¸æ¶ˆè€—çš„æœ€å¤§æ—¶é—´ã€‚</li><li><code>purger_threshold</code>ï¼šæ¯æ¬¡ç§»é™¤å®Œæˆåï¼Œåœé¡¿çš„é—´éš”æ—¶é—´ã€‚</li></ul><p><strong>ã€Œproxy_cacheã€</strong>ï¼šå¼€å¯æˆ–å…³é—­ä»£ç†ç¼“å­˜ï¼Œå¼€å¯æ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªå…±äº«å†…å­˜åŒºåŸŸã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache zone | off;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>zone ä¸ºå†…å­˜åŒºåŸŸçš„åç§°ï¼Œå³ä¸Šé¢ä¸­ keys_zone è®¾ç½®çš„åç§°ã€‚</p><p><strong>ã€Œproxy_cache_keyã€</strong>ï¼šå®šä¹‰å¦‚ä½•ç”Ÿæˆç¼“å­˜çš„é”®ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_key string;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>string ä¸ºç”Ÿæˆ Key çš„è§„åˆ™ï¼Œå¦‚<code>$scheme$proxy_host$request_uri</code>ã€‚</p><p><strong>ã€Œproxy_cache_validã€</strong>ï¼šç¼“å­˜ç”Ÿæ•ˆçš„çŠ¶æ€ç ä¸è¿‡æœŸæ—¶é—´ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_valid [code ...] time;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>code ä¸ºçŠ¶æ€ç ï¼Œtime ä¸ºæœ‰æ•ˆæ—¶é—´ï¼Œå¯ä»¥æ ¹æ®çŠ¶æ€ç è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ã€‚</p><p>ä¾‹å¦‚ï¼š<code>proxy_cache_valid 200 302 30m;</code></p><p><strong>ã€Œproxy_cache_min_usesã€</strong>ï¼šè®¾ç½®èµ„æºè¢«è¯·æ±‚å¤šå°‘æ¬¡åè¢«ç¼“å­˜ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_min_uses number;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>number ä¸ºæ¬¡æ•°ï¼Œé»˜è®¤ä¸º 1ã€‚</p><p><strong>ã€Œproxy_cache_use_staleã€</strong>ï¼šå½“åç«¯å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦å…è®¸ Nginx è¿”å›ç¼“å­˜ä½œä¸ºå“åº”ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_use_stale error;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>error ä¸ºé”™è¯¯ç±»å‹ï¼Œå¯é…ç½®<code>timeout|invalid_header|updating|http_500...</code>ã€‚</p><p><strong>ã€Œproxy_cache_lockã€</strong>ï¼šå¯¹äºç›¸åŒçš„è¯·æ±‚ï¼Œæ˜¯å¦å¼€å¯é”æœºåˆ¶ï¼Œåªå…è®¸ä¸€ä¸ªè¯·æ±‚å‘å¾€åç«¯ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_lock on | off;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ã€Œproxy_cache_lock_timeoutã€</strong>ï¼šé…ç½®é”è¶…æ—¶æœºåˆ¶ï¼Œè¶…å‡ºè§„å®šæ—¶é—´åä¼šé‡Šæ”¾è¯·æ±‚ã€‚</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_lock_timeout time;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ã€Œproxy_cache_methodsã€</strong>ï¼šè®¾ç½®å¯¹äºé‚£äº› HTTP æ–¹æ³•å¼€å¯ç¼“å­˜ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_methods method;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>method ä¸ºè¯·æ±‚æ–¹æ³•ç±»å‹ï¼Œå¦‚ GETã€HEAD ç­‰ã€‚</p><p><strong>ã€Œproxy_no_cacheã€</strong>ï¼šå®šä¹‰ä¸å­˜å‚¨ç¼“å­˜çš„æ¡ä»¶ï¼Œç¬¦åˆæ—¶ä¸ä¼šä¿å­˜ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_no_cache string...;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>string ä¸ºæ¡ä»¶ï¼Œä¾‹å¦‚<code>$cookie_nocache $arg_nocache $arg_comment;</code></p><p><strong>ã€Œproxy_cache_bypassã€</strong>ï¼šå®šä¹‰ä¸è¯»å–ç¼“å­˜çš„æ¡ä»¶ï¼Œç¬¦åˆæ—¶ä¸ä¼šä»ç¼“å­˜ä¸­è¯»å–ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>proxy_cache_bypass string...;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å’Œä¸Šé¢<code>proxy_no_cache</code>çš„é…ç½®æ–¹æ³•ç±»ä¼¼ã€‚</p><p><strong>ã€Œadd_headerã€</strong>ï¼šå¾€å“åº”å¤´ä¸­æ·»åŠ å­—æ®µä¿¡æ¯ã€‚</p><p>è¯­æ³•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>add_header fieldName fieldValue;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ã€Œ$upstream_cache_statusã€</strong>ï¼šè®°å½•äº†ç¼“å­˜æ˜¯å¦å‘½ä¸­çš„ä¿¡æ¯ï¼Œå­˜åœ¨å¤šç§æƒ…å†µï¼š</p><ul><li><code>MISS</code>ï¼šè¯·æ±‚æœªå‘½ä¸­ç¼“å­˜ã€‚</li><li><code>HIT</code>ï¼šè¯·æ±‚å‘½ä¸­ç¼“å­˜ã€‚</li><li><code>EXPIRED</code>ï¼šè¯·æ±‚å‘½ä¸­ç¼“å­˜ä½†ç¼“å­˜å·²è¿‡æœŸã€‚</li><li><code>STALE</code>ï¼šè¯·æ±‚å‘½ä¸­äº†é™ˆæ—§ç¼“å­˜ã€‚</li><li><code>REVALIDDATED</code>ï¼šNginx éªŒè¯é™ˆæ—§ç¼“å­˜ä¾ç„¶æœ‰æ•ˆã€‚</li><li><code>UPDATING</code>ï¼šå‘½ä¸­çš„ç¼“å­˜å†…å®¹é™ˆæ—§ï¼Œä½†æ­£åœ¨æ›´æ–°ç¼“å­˜ã€‚</li><li><code>BYPASS</code>ï¼šå“åº”ç»“æœæ˜¯ä»åŸå§‹æœåŠ¡å™¨è·å–çš„ã€‚</li></ul><blockquote><p>â</p><p>PSï¼šè¿™ä¸ªå’Œä¹‹å‰çš„ä¸åŒï¼Œä¹‹å‰çš„éƒ½æ˜¯å‚æ•°é¡¹ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ª Nginx å†…ç½®å˜é‡ã€‚</p><p>â</p></blockquote><p>OK~ï¼Œå¯¹äº<code>Nginx</code>ä¸­çš„ç¼“å­˜é…ç½®é¡¹å¤§æ¦‚äº†è§£åï¼Œæ¥ç€æ¥é…ç½®ä¸€ä¸‹<code>Nginx</code>ä»£ç†ç¼“å­˜ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>http{  
    # è®¾ç½®ç¼“å­˜çš„ç›®å½•ï¼Œå¹¶ä¸”å†…å­˜ä¸­ç¼“å­˜åŒºåä¸ºhot_cacheï¼Œå¤§å°ä¸º128mï¼Œ  
    # ä¸‰å¤©æœªè¢«è®¿é—®è¿‡çš„ç¼“å­˜è‡ªåŠ¨æ¸…æ¥šï¼Œç£ç›˜ä¸­ç¼“å­˜çš„æœ€å¤§å®¹é‡ä¸º2GBã€‚  
    proxy_cache_path /soft/nginx/cache levels=1:2 keys_zone=hot_cache:128m inactive=3d max_size=2g;  
      
    server{  
        location / {  
            # ä½¿ç”¨åä¸ºnginx_cacheçš„ç¼“å­˜ç©ºé—´  
            proxy_cache hot_cache;  
            # å¯¹äº200ã€206ã€304ã€301ã€302çŠ¶æ€ç çš„æ•°æ®ç¼“å­˜1å¤©  
            proxy_cache_valid 200 206 304 301 302 1d;  
            # å¯¹äºå…¶ä»–çŠ¶æ€çš„æ•°æ®ç¼“å­˜30åˆ†é’Ÿ  
            proxy_cache_valid any 30m;  
            # å®šä¹‰ç”Ÿæˆç¼“å­˜é”®çš„è§„åˆ™ï¼ˆè¯·æ±‚çš„url+å‚æ•°ä½œä¸ºkeyï¼‰  
            proxy_cache_key $host$uri$is_args$args;  
            # èµ„æºè‡³å°‘è¢«é‡å¤è®¿é—®ä¸‰æ¬¡åå†åŠ å…¥ç¼“å­˜  
            proxy_cache_min_uses 3;  
            # å‡ºç°é‡å¤è¯·æ±‚æ—¶ï¼Œåªè®©ä¸€ä¸ªå»åç«¯è¯»æ•°æ®ï¼Œå…¶ä»–çš„ä»ç¼“å­˜ä¸­è¯»å–  
            proxy_cache_lock on;  
            # ä¸Šé¢çš„é”è¶…æ—¶æ—¶é—´ä¸º3sï¼Œè¶…è¿‡3sæœªè·å–æ•°æ®ï¼Œå…¶ä»–è¯·æ±‚ç›´æ¥å»åç«¯  
            proxy_cache_lock_timeout 3s;  
            # å¯¹äºè¯·æ±‚å‚æ•°æˆ–cookieä¸­å£°æ˜äº†ä¸ç¼“å­˜çš„æ•°æ®ï¼Œä¸å†åŠ å…¥ç¼“å­˜  
            proxy_no_cache $cookie_nocache $arg_nocache $arg_comment;  
            # åœ¨å“åº”å¤´ä¸­æ·»åŠ ä¸€ä¸ªç¼“å­˜æ˜¯å¦å‘½ä¸­çš„çŠ¶æ€ï¼ˆä¾¿äºè°ƒè¯•ï¼‰  
            add_header Cache-status $upstream_cache_status;  
        }  
    }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-9.png" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå› ä¸ºè¿˜æ²¡æœ‰è¯·æ±‚è¿‡èµ„æºï¼Œæ‰€ä»¥ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå› æ­¤æ²¡æœ‰å‘½ä¸­ç¼“å­˜ã€‚ç¬¬äºŒã€ä¸‰æ¬¡ï¼Œä¾æ—§æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç›´è‡³ç¬¬å››æ¬¡æ—¶æ‰æ˜¾ç¤ºå‘½ä¸­ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨å‰é¢çš„ç¼“å­˜é…ç½®ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†åŠ å…¥ç¼“å­˜çš„æœ€ä½æ¡ä»¶ä¸ºï¼š <strong>ã€Œã€Œèµ„æºè‡³å°‘è¦è¢«è¯·æ±‚ä¸‰æ¬¡ä»¥ä¸Šæ‰ä¼šåŠ å…¥ç¼“å­˜ã€‚ã€ã€</strong> è¿™æ ·å¯ä»¥é¿å…å¾ˆå¤šæ— æ•ˆç¼“å­˜å ç”¨ç©ºé—´ã€‚</p><h4 id="ç¼“å­˜æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜æ¸…ç†"><span>ç¼“å­˜æ¸…ç†</span></a></h4><p>å½“ç¼“å­˜è¿‡å¤šæ—¶ï¼Œå¦‚æœä¸åŠæ—¶æ¸…ç†ä¼šå¯¼è‡´ç£ç›˜ç©ºé—´è¢«â€œåƒå…‰â€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€å¥—å®Œå–„çš„ç¼“å­˜æ¸…ç†æœºåˆ¶å»åˆ é™¤ç¼“å­˜ï¼Œåœ¨ä¹‹å‰çš„<code>proxy_cache_path</code> å‚æ•°ä¸­æœ‰<code>purger</code>ç›¸å…³çš„é€‰é¡¹ï¼Œå¼€å¯åå¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨æ¸…ç†ç¼“å­˜ï¼Œä½†é—æ†¾çš„æ˜¯ï¼š<strong><code>purger</code>ç³»åˆ—å‚æ•°åªæœ‰å•†ä¸šç‰ˆçš„<code>NginxPlus</code> æ‰èƒ½ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä»˜è´¹æ‰å¯ä½¿ç”¨ã€‚</strong></p><p>ä¸è¿‡å¤©æ— ç»äººä¹‹è·¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼ºå¤§çš„ç¬¬ä¸‰æ–¹æ¨¡å—<code>ngx_cache_purge</code>æ¥æ›¿ä»£ï¼Œå…ˆæ¥å®‰è£…ä¸€ä¸‹è¯¥æ’ä»¶ï¼šâ‘ é¦–å…ˆå»åˆ°<code>Nginx</code> çš„å®‰è£…ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª<code>cache_purge</code>ç›®å½•ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# mkdir cache_purge &amp;&amp; cd cache_purge  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â‘¡é€šè¿‡<code>wget</code>æŒ‡ä»¤ä»<code>github</code>ä¸Šæ‹‰å–å®‰è£…åŒ…çš„å‹ç¼©æ–‡ä»¶å¹¶è§£å‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# wget https://github.com/FRiCKLE/ngx_cache_purge/archive/2.3.tar.gz  
[root@localhost]# tar -xvzf 2.3.tar.gz  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¢å†æ¬¡å»åˆ°ä¹‹å‰<code>Nginx</code>çš„è§£å‹ç›®å½•ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# cd /soft/nginx/nginx1.21.6  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â‘£é‡æ–°æ„å»ºä¸€æ¬¡<code>Nginx</code>ï¼Œé€šè¿‡<code>--add-module</code>çš„æŒ‡ä»¤æ·»åŠ åˆšåˆšçš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# ./configure --prefix=/soft/nginx/ --add-module=/soft/nginx/cache_purge/ngx_cache_purge-2.3/  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â‘¤é‡æ–°æ ¹æ®åˆšåˆšæ„å»ºçš„<code>Nginx</code>ï¼Œå†æ¬¡ç¼–è¯‘ä¸€ä¸‹ï¼Œ<strong>ã€Œä½†åˆ‡è®°ä¸è¦<code>make install</code>ã€</strong> ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# make  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â‘¥åˆ é™¤ä¹‹å‰<code>Nginx</code>çš„å¯åŠ¨æ–‡ä»¶ï¼Œä¸æ”¾å¿ƒçš„ä¹Ÿå¯ä»¥ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# rm -rf /soft/nginx/sbin/nginx  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â‘¦ä»ç”Ÿæˆçš„<code>objs</code>ç›®å½•ä¸­ï¼Œé‡æ–°å¤åˆ¶ä¸€ä¸ª<code>Nginx</code>çš„å¯åŠ¨æ–‡ä»¶åˆ°åŸæ¥çš„ä½ç½®ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# cp objs/nginx /soft/nginx/sbin/nginx  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œç¬¬ä¸‰æ–¹ç¼“å­˜æ¸…é™¤æ¨¡å—<code>ngx_cache_purge</code>å°±å®‰è£…å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹<code>nginx.conf</code>é…ç½®ï¼Œå†æ·»åŠ ä¸€æ¡<code>location</code>è§„åˆ™ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>location ~ /purge(/.*) {  
  # é…ç½®å¯ä»¥æ‰§è¡Œæ¸…é™¤æ“ä½œçš„IPï¼ˆçº¿ä¸Šå¯ä»¥é…ç½®æˆå†…ç½‘æœºå™¨ï¼‰  
  # allow 127.0.0.1; # ä»£è¡¨æœ¬æœº  
  allow all; # ä»£è¡¨å…è®¸ä»»æ„IPæ¸…é™¤ç¼“å­˜  
  proxy_cache_purge $host$1$is_args$args;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå†é‡å¯<code>Nginx</code>ï¼Œæ¥ä¸‹æ¥å³å¯é€šè¿‡<code>http://xxx/purge/xx</code>çš„æ–¹å¼æ¸…é™¤ç¼“å­˜ã€‚</p><h2 id="å…«ã€nginx-å®ç°-ip-é»‘ç™½åå•" tabindex="-1"><a class="header-anchor" href="#å…«ã€nginx-å®ç°-ip-é»‘ç™½åå•"><span>å…«ã€Nginx å®ç° IP é»‘ç™½åå•</span></a></h2><p>æœ‰æ—¶å€™å¾€å¾€æœ‰äº›éœ€æ±‚ï¼Œå¯èƒ½æŸäº›æ¥å£åªèƒ½å¼€æ”¾ç»™å¯¹åº”çš„åˆä½œå•†ï¼Œæˆ–è€…è´­ä¹°/æ¥å…¥<code>API</code>çš„åˆä½œä¼™ä¼´ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦å®ç°ç±»ä¼¼äº<code>IP</code> ç™½åå•çš„åŠŸèƒ½ã€‚è€Œæœ‰æ—¶å€™æœ‰äº›æ¶æ„æ”»å‡»è€…æˆ–çˆ¬è™«ç¨‹åºï¼Œè¢«è¯†åˆ«åéœ€è¦ç¦æ­¢å…¶å†æ¬¡è®¿é—®ç½‘ç«™ï¼Œå› æ­¤ä¹Ÿéœ€è¦å®ç°<code>IP</code> é»‘åå•ã€‚é‚£ä¹ˆè¿™äº›åŠŸèƒ½æ— éœ€äº¤ç”±åç«¯å®ç°ï¼Œå¯ç›´æ¥åœ¨<code>Nginx</code>ä¸­å¤„ç†ã€‚</p><p><code>Nginx</code>åšé»‘ç™½åå•æœºåˆ¶ï¼Œä¸»è¦æ˜¯é€šè¿‡<code>allowã€deny</code>é…ç½®é¡¹æ¥å®ç°ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>allow xxx.xxx.xxx.xxx; # å…è®¸æŒ‡å®šçš„IPè®¿é—®ï¼Œå¯ä»¥ç”¨äºå®ç°ç™½åå•ã€‚  
deny xxx.xxx.xxx.xxx; # ç¦æ­¢æŒ‡å®šçš„IPè®¿é—®ï¼Œå¯ä»¥ç”¨äºå®ç°é»‘åå•ã€‚  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦åŒæ—¶å±è”½/å¼€æ”¾å¤šä¸ª<code>IP</code>è®¿é—®æ—¶ï¼Œå¦‚æœæ‰€æœ‰<code>IP</code>å…¨éƒ¨å†™åœ¨<code>nginx.conf</code> æ–‡ä»¶ä¸­å®šç„¶æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒå†—ä½™ï¼Œé‚£ä¹ˆå¯ä»¥æ–°å»ºä¸¤ä¸ªæ–‡ä»¶<code>BlocksIP.confã€WhiteIP.conf</code>ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code># --------é»‘åå•ï¼šBlocksIP.conf---------  
deny 192.177.12.222; # å±è”½192.177.12.222è®¿é—®  
deny 192.177.44.201; # å±è”½192.177.44.201è®¿é—®  
deny 127.0.0.0/8; # å±è”½127.0.0.1åˆ°127.255.255.254ç½‘æ®µä¸­çš„æ‰€æœ‰IPè®¿é—®  
  
# --------ç™½åå•ï¼šWhiteIP.conf---------  
allow 192.177.12.222; # å…è®¸192.177.12.222è®¿é—®  
allow 192.177.44.201; # å…è®¸192.177.44.201è®¿é—®  
allow 127.45.0.0/16; # å…è®¸127.45.0.1åˆ°127.45.255.254ç½‘æ®µä¸­çš„æ‰€æœ‰IPè®¿é—®  
deny all; # é™¤å¼€ä¸Šè¿°IPå¤–ï¼Œå…¶ä»–IPå…¨éƒ¨ç¦æ­¢è®¿é—®  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†åˆ«å°†è¦ç¦æ­¢/å¼€æ”¾çš„<code>IP</code>æ·»åŠ åˆ°å¯¹åº”çš„æ–‡ä»¶åï¼Œå¯ä»¥å†å°†è¿™ä¸¤ä¸ªæ–‡ä»¶åœ¨<code>nginx.conf</code>ä¸­å¯¼å…¥ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>http{  
    # å±è”½è¯¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰IP  
    include /soft/nginx/IP/BlocksIP.conf;   
 server{  
    location xxx {  
        # æŸä¸€ç³»åˆ—æ¥å£åªå¼€æ”¾ç»™ç™½åå•ä¸­çš„IP  
        include /soft/nginx/IP/blockip.conf;   
    }  
 }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºæ–‡ä»¶å…·ä½“åœ¨å“ªå„¿å¯¼å…¥ï¼Œè¿™ä¸ªä¹Ÿå¹¶ééšæ„çš„ï¼Œå¦‚æœè¦æ•´ç«™å±è”½/å¼€æ”¾å°±åœ¨<code>http</code>ä¸­å¯¼å…¥ï¼Œå¦‚æœåªéœ€è¦ä¸€ä¸ªåŸŸåä¸‹å±è”½/å¼€æ”¾å°±åœ¨<code>sever</code> ä¸­å¯¼å…¥ï¼Œå¦‚æœåªéœ€è¦é’ˆå¯¹äºæŸä¸€ç³»åˆ—æ¥å£å±è”½/å¼€æ”¾<code>IP</code>ï¼Œé‚£ä¹ˆå°±åœ¨<code>location</code>ä¸­å¯¼å…¥ã€‚</p><blockquote><p>â</p><p>å½“ç„¶ï¼Œä¸Šè¿°åªæ˜¯æœ€ç®€å•çš„<code>IP</code>é»‘/ç™½åå•å®ç°æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡<code>ngx_http_geo_moduleã€ngx_http_geo_module</code> ç¬¬ä¸‰æ–¹åº“å»å®ç°ï¼ˆè¿™ç§æ–¹å¼å¯ä»¥æŒ‰åœ°åŒºã€å›½å®¶è¿›è¡Œå±è”½ï¼Œå¹¶ä¸”æä¾›äº†<code>IP</code>åº“ï¼‰ã€‚</p><p>â</p></blockquote><h2 id="ä¹ã€nginx-è·¨åŸŸé…ç½®" tabindex="-1"><a class="header-anchor" href="#ä¹ã€nginx-è·¨åŸŸé…ç½®"><span>ä¹ã€Nginx è·¨åŸŸé…ç½®</span></a></h2><p>è·¨åŸŸé—®é¢˜åœ¨ä¹‹å‰çš„å•ä½“æ¶æ„å¼€å‘ä¸­ï¼Œå…¶å®æ˜¯æ¯”è¾ƒå°‘è§çš„é—®é¢˜ï¼Œé™¤éæ˜¯éœ€è¦æ¥å…¥ç¬¬ä¸‰æ–¹<code>SDK</code> æ—¶ï¼Œæ‰éœ€è¦å¤„ç†æ­¤é—®é¢˜ã€‚ä½†éšç€ç°åœ¨å‰åç«¯åˆ†ç¦»ã€åˆ†å¸ƒå¼æ¶æ„çš„æµè¡Œï¼Œè·¨åŸŸé—®é¢˜ä¹Ÿæˆä¸ºäº†æ¯ä¸ª Java å¼€å‘å¿…é¡»è¦æ‡‚å¾—è§£å†³çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><h4 id="è·¨åŸŸé—®é¢˜äº§ç”Ÿçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#è·¨åŸŸé—®é¢˜äº§ç”Ÿçš„åŸå› "><span>è·¨åŸŸé—®é¢˜äº§ç”Ÿçš„åŸå› </span></a></h4><p>äº§ç”Ÿè·¨åŸŸé—®é¢˜çš„ä¸»è¦åŸå› å°±åœ¨äº <strong>ã€ŒåŒæºç­–ç•¥ã€</strong> ï¼Œä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„ç½‘ç«™çªƒå–æ•°æ®ï¼ŒåŒæºç­–ç•¥æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™<code>cookie</code> å¯ä»¥å…±äº«ã€‚ç”±äº<code>http</code>æ— çŠ¶æ€åè®®é€šå¸¸ä¼šå€ŸåŠ©<code>cookie</code>æ¥å®ç°æœ‰çŠ¶æ€çš„ä¿¡æ¯è®°å½•ï¼Œä¾‹å¦‚ç”¨æˆ·çš„èº«ä»½/å¯†ç ç­‰ï¼Œå› æ­¤ä¸€æ—¦<code>cookie</code> è¢«å…±äº«ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯è¢«ç›—å–ã€‚</p><p>åŒæºç­–ç•¥ä¸»è¦æ˜¯æŒ‡ä¸‰ç‚¹ç›¸åŒï¼Œ<strong>ã€Œã€Œåè®®+åŸŸå+ç«¯å£ã€ã€</strong> ç›¸åŒçš„ä¸¤ä¸ªè¯·æ±‚ï¼Œåˆ™å¯ä»¥è¢«çœ‹åšæ˜¯åŒæºçš„ï¼Œä½†å¦‚æœå…¶ä¸­ä»»æ„ä¸€ç‚¹å­˜åœ¨ä¸åŒï¼Œåˆ™ä»£è¡¨æ˜¯ä¸¤ä¸ªä¸åŒæºçš„è¯·æ±‚ï¼ŒåŒæºç­–ç•¥ä¼šé™åˆ¶äº†ä¸åŒæºä¹‹é—´çš„èµ„æºäº¤äº’ã€‚</p><h4 id="nginx-è§£å†³è·¨åŸŸé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#nginx-è§£å†³è·¨åŸŸé—®é¢˜"><span>Nginx è§£å†³è·¨åŸŸé—®é¢˜</span></a></h4><p>å¼„æ˜ç™½äº†è·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹<code>Nginx</code>ä¸­åˆè¯¥å¦‚ä½•è§£å†³è·¨åŸŸå‘¢ï¼Ÿå…¶å®æ¯”è¾ƒç®€å•ï¼Œåœ¨<code>nginx.conf</code>ä¸­ç¨å¾®æ·»åŠ ä¸€ç‚¹é…ç½®å³å¯ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>location / {  
    # å…è®¸è·¨åŸŸçš„è¯·æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰å˜é‡$http_originï¼Œ*è¡¨ç¤ºæ‰€æœ‰  
    add_header &#39;Access-Control-Allow-Origin&#39; *;  
    # å…è®¸æºå¸¦cookieè¯·æ±‚  
    add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;;  
    # å…è®¸è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ï¼šGET,POST,OPTIONS,PUT  
    add_header &#39;Access-Control-Allow-Methods&#39; &#39;GET,POST,OPTIONS,PUT&#39;;  
    # å…è®¸è¯·æ±‚æ—¶æºå¸¦çš„å¤´éƒ¨ä¿¡æ¯ï¼Œ*è¡¨ç¤ºæ‰€æœ‰  
    add_header &#39;Access-Control-Allow-Headers&#39; *;  
    # å…è®¸å‘é€æŒ‰æ®µè·å–èµ„æºçš„è¯·æ±‚  
    add_header &#39;Access-Control-Expose-Headers&#39; &#39;Content-Length,Content-Range&#39;;  
    # ä¸€å®šè¦æœ‰ï¼ï¼ï¼å¦åˆ™Postè¯·æ±‚æ— æ³•è¿›è¡Œè·¨åŸŸï¼  
    # åœ¨å‘é€Postè·¨åŸŸè¯·æ±‚å‰ï¼Œä¼šä»¥Optionsæ–¹å¼å‘é€é¢„æ£€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—æ—¶æ‰ä¼šæ­£å¼è¯·æ±‚  
    if ($request_method = &#39;OPTIONS&#39;) {  
        add_header &#39;Access-Control-Max-Age&#39; 1728000;  
        add_header &#39;Content-Type&#39; &#39;text/plain; charset=utf-8&#39;;  
        add_header &#39;Content-Length&#39; 0;  
        # å¯¹äºOptionsæ–¹å¼çš„è¯·æ±‚è¿”å›204ï¼Œè¡¨ç¤ºæ¥å—è·¨åŸŸè¯·æ±‚  
        return 204;  
    }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>nginx.conf</code>æ–‡ä»¶åŠ ä¸Šå¦‚ä¸Šé…ç½®åï¼Œè·¨åŸŸè¯·æ±‚å³å¯ç”Ÿæ•ˆäº†ã€‚</p><blockquote><p>â</p></blockquote><p>ä½†å¦‚æœåç«¯æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„å¼€å‘çš„ï¼Œæœ‰æ—¶å€™ RPC è°ƒç”¨ä¹Ÿéœ€è¦è§£å†³è·¨åŸŸé—®é¢˜ï¼Œä¸ç„¶ä¹ŸåŒæ ·ä¼šå‡ºç°æ— æ³•è·¨åŸŸè¯·æ±‚çš„å¼‚å¸¸ï¼Œå› æ­¤å¯ä»¥åœ¨ä½ çš„åç«¯é¡¹ç›®ä¸­ï¼Œé€šè¿‡ç»§æ‰¿<code>HandlerInterceptorAdapter</code> ç±»ã€å®ç°<code>WebMvcConfigurer</code>æ¥å£ã€æ·»åŠ <code>@CrossOrgin</code>æ³¨è§£çš„æ–¹å¼å®ç°æ¥å£ä¹‹é—´çš„è·¨åŸŸé…ç½®ã€‚</p><blockquote><p>â</p></blockquote><h2 id="åã€nginx-é˜²ç›—é“¾è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#åã€nginx-é˜²ç›—é“¾è®¾è®¡"><span>åã€Nginx é˜²ç›—é“¾è®¾è®¡</span></a></h2><p>é¦–å…ˆäº†è§£ä¸€ä¸‹ä½•è°“ç›—é“¾ï¼š<strong>ã€Œã€Œç›—é“¾å³æ˜¯æŒ‡å¤–éƒ¨ç½‘ç«™å¼•å…¥å½“å‰ç½‘ç«™çš„èµ„æºå¯¹å¤–å±•ç¤ºã€ã€</strong> ï¼Œæ¥ä¸¾ä¸ªç®€å•çš„ä¾‹å­ç†è§£ï¼š</p><blockquote><p>â</p><p>å¥½æ¯”å£çº¸ç½‘ç«™<code>X</code>ç«™ã€<code>Y</code>ç«™ï¼Œ<code>X</code>ç«™æ˜¯ä¸€ç‚¹ç‚¹å»è´­ä¹°ç‰ˆæƒã€ç­¾çº¦ä½œè€…çš„æ–¹å¼ï¼Œä»è€Œç§¯ç´¯äº†æµ·é‡çš„å£çº¸ç´ æï¼Œä½†<code>Y</code> ç«™ç”±äºèµ„é‡‘ç­‰å„æ–¹é¢çš„åŸå› ï¼Œå°±ç›´æ¥é€šè¿‡<code>&lt;img src=&quot;Xç«™/xxx.jpg&quot; /&gt;</code>è¿™ç§æ–¹å¼ç…§æ¬äº†<code>X</code>ç«™çš„æ‰€æœ‰å£çº¸èµ„æºï¼Œç»§è€Œæä¾›ç»™ç”¨æˆ·ä¸‹è½½ã€‚</p><p>â</p></blockquote><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è‡ªå·±æ˜¯è¿™ä¸ª<code>X</code>ç«™çš„<code>Boss</code>ï¼Œå¿ƒä¸­å¿…ç„¶ä¸çˆ½ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆè¯¥å¦‚ä½•å±è”½è¿™ç±»é—®é¢˜å‘¢ï¼Ÿé‚£ä¹ˆæ¥ä¸‹æ¥è¦å™è¯´çš„**ã€Œã€Œé˜²ç›—é“¾ã€ã€** ç™»åœºäº†ï¼</p><p><code>Nginx</code>çš„é˜²ç›—é“¾æœºåˆ¶å®ç°ï¼Œè·Ÿä¸€ä¸ªå¤´éƒ¨å­—æ®µï¼š<code>Referer</code>æœ‰å…³ï¼Œè¯¥å­—æ®µä¸»è¦æè¿°äº†å½“å‰è¯·æ±‚æ˜¯ä»å“ªå„¿å‘å‡ºçš„ï¼Œé‚£ä¹ˆåœ¨<code>Nginx</code> ä¸­å°±å¯è·å–è¯¥å€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä¸ºæœ¬ç«™çš„èµ„æºå¼•ç”¨è¯·æ±‚ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¸å…è®¸è®¿é—®ã€‚<code>Nginx</code>ä¸­å­˜åœ¨ä¸€ä¸ªé…ç½®é¡¹ä¸º<code>valid_referers</code> ï¼Œæ­£å¥½å¯ä»¥æ»¡è¶³å‰é¢çš„éœ€æ±‚ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>valid_referers none | blocked | server_names | string ...;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>none</code>ï¼šè¡¨ç¤ºæ¥å—æ²¡æœ‰<code>Referer</code>å­—æ®µçš„<code>HTTP</code>è¯·æ±‚è®¿é—®ã€‚</li><li><code>blocked</code>ï¼šè¡¨ç¤ºå…è®¸<code>http://</code>æˆ–<code>https//</code>ä»¥å¤–çš„è¯·æ±‚è®¿é—®ã€‚</li><li><code>server_names</code>ï¼šèµ„æºçš„ç™½åå•ï¼Œè¿™é‡Œå¯ä»¥æŒ‡å®šå…è®¸è®¿é—®çš„åŸŸåã€‚</li><li><code>string</code>ï¼šå¯è‡ªå®šä¹‰å­—ç¬¦ä¸²ï¼Œæ”¯é…é€šé…ç¬¦ã€æ­£åˆ™è¡¨è¾¾å¼å†™æ³•ã€‚</li></ul><p>ç®€å•äº†è§£è¯­æ³•åï¼Œæ¥ä¸‹æ¥çš„å®ç°å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code># åœ¨åŠ¨é™åˆ†ç¦»çš„locationä¸­å¼€å¯é˜²ç›—é“¾æœºåˆ¶  
location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css){  
    # æœ€åé¢çš„å€¼åœ¨ä¸Šçº¿å‰å¯é…ç½®ä¸ºå…è®¸çš„åŸŸååœ°å€  
    valid_referers blocked 192.168.12.129;  
    if ($invalid_referer) {  
        # å¯ä»¥é…ç½®æˆè¿”å›ä¸€å¼ ç¦æ­¢ç›—å–çš„å›¾ç‰‡  
        # rewrite   ^/ http://xx.xx.com/NO.jpg;  
        # ä¹Ÿå¯ç›´æ¥è¿”å›403  
        return   403;  
    }  
      
    root   /soft/nginx/static_resources;  
    expires 7d;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®ä¸Šè¿°ä¸­çš„å†…å®¹é…ç½®åï¼Œå°±å·²ç»é€šè¿‡<code>Nginx</code> å®ç°äº†æœ€åŸºæœ¬çš„é˜²ç›—é“¾æœºåˆ¶ï¼Œæœ€ååªéœ€è¦é¢å¤–é‡å¯ä¸€ä¸‹å°±å¥½å•¦ï¼å½“ç„¶ï¼Œå¯¹äºé˜²ç›—é“¾æœºåˆ¶å®ç°è¿™å—ï¼Œä¹Ÿæœ‰ä¸“é—¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—<code>ngx_http_accesskey_module</code> å®ç°äº†æ›´ä¸ºå®Œå–„çš„è®¾è®¡ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå»çœ‹çœ‹ã€‚</p><blockquote><p>â</p><p>PSï¼šé˜²ç›—é“¾æœºåˆ¶ä¹Ÿæ— æ³•è§£å†³çˆ¬è™«ä¼ªé€ <code>referers</code>ä¿¡æ¯çš„è¿™ç§æ–¹å¼æŠ“å–æ•°æ®ã€‚</p><p>â</p></blockquote><h2 id="åä¸€ã€nginx-å¤§æ–‡ä»¶ä¼ è¾“é…ç½®" tabindex="-1"><a class="header-anchor" href="#åä¸€ã€nginx-å¤§æ–‡ä»¶ä¼ è¾“é…ç½®"><span>åä¸€ã€Nginx å¤§æ–‡ä»¶ä¼ è¾“é…ç½®</span></a></h2><p>åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸­éœ€è¦ä¼ è¾“ä¸€äº›å¤§æ–‡ä»¶ï¼Œä½†å¤§æ–‡ä»¶ä¼ è¾“æ—¶å¾€å¾€éƒ½ä¼šä¼šå‡ºç°ä¸€äº›<code>Bug</code> ï¼Œæ¯”å¦‚æ–‡ä»¶è¶…å‡ºé™åˆ¶ã€æ–‡ä»¶ä¼ è¾“è¿‡ç¨‹ä¸­è¯·æ±‚è¶…æ—¶ç­‰ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥åœ¨<code>Nginx</code>ç¨å¾®åšä¸€äº›é…ç½®ï¼Œå…ˆæ¥äº†è§£ä¸€äº›å…³äºå¤§æ–‡ä»¶ä¼ è¾“æ—¶å¯èƒ½ä¼šç”¨çš„é…ç½®é¡¹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>ç‰›é€¼å•Šï¼æ¥ç§æ´»å¿…å¤‡çš„ N ä¸ªå¼€æºé¡¹ç›®ï¼èµ¶å¿«æ”¶è—
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-10.png" alt="Nginx" tabindex="0" loading="lazy"><figcaption>Nginx</figcaption></figure><p>åœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œ<code>client_max_body_size</code>ã€<code>client_header_timeout</code>ã€<code>proxy_read_timeout</code>ã€<code>proxy_send_timeout</code> è¿™å››ä¸ªå‚æ•°å€¼éƒ½å¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®çš„å®é™…æƒ…å†µæ¥é…ç½®ã€‚</p><blockquote><p>â</p><p>ä¸Šè¿°é…ç½®ä»…æ˜¯ä½œä¸ºä»£ç†å±‚éœ€è¦é…ç½®çš„ï¼Œå› ä¸ºæœ€ç»ˆå®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶è¿˜æ˜¯ç›´æ¥ä¸åç«¯è¿›è¡Œäº¤äº’ï¼Œè¿™é‡Œåªæ˜¯æŠŠä½œä¸ºç½‘å…³å±‚çš„<code>Nginx</code> é…ç½®è°ƒé«˜ä¸€ç‚¹ï¼Œè°ƒåˆ°èƒ½å¤Ÿâ€œå®¹çº³å¤§æ–‡ä»¶â€ä¼ è¾“çš„ç¨‹åº¦ã€‚å½“ç„¶ï¼Œ<code>Nginx</code> ä¸­ä¹Ÿå¯ä»¥ä½œä¸ºæ–‡ä»¶æœåŠ¡å™¨ä½¿ç”¨ï¼Œä½†éœ€è¦ç”¨åˆ°ä¸€ä¸ªä¸“é—¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—<code>nginx-upload-module</code> ï¼Œå¦‚æœé¡¹ç›®ä¸­æ–‡ä»¶ä¸Šä¼ çš„ä½œç”¨å¤„ä¸å¤šï¼Œé‚£ä¹ˆå»ºè®®å¯ä»¥é€šè¿‡<code>Nginx</code> æ­å»ºï¼Œæ¯•ç«Ÿå¯ä»¥èŠ‚çœä¸€å°æ–‡ä»¶æœåŠ¡å™¨èµ„æºã€‚ä½†å¦‚è‹¥æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½è¾ƒä¸ºé¢‘ç¹ï¼Œé‚£ä¹ˆè¿˜æ˜¯å»ºè®®é¢å¤–æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å°†ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½äº¤ç”±åç«¯å¤„ç†ã€‚</p><p>â</p></blockquote><h2 id="åäºŒã€nginx-é…ç½®-sll-è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#åäºŒã€nginx-é…ç½®-sll-è¯ä¹¦"><span>åäºŒã€Nginx é…ç½® SLL è¯ä¹¦</span></a></h2><p>éšç€è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™æ¥å…¥<code>HTTPS</code>ï¼Œå› æ­¤<code>Nginx</code>ä¸­ä»…é…ç½®<code>HTTP</code>è¿˜ä¸å¤Ÿï¼Œå¾€å¾€è¿˜éœ€è¦ç›‘å¬<code>443</code>ç«¯å£çš„è¯·æ±‚ï¼Œ<code>HTTPS</code> ä¸ºäº†ç¡®ä¿é€šä¿¡å®‰å…¨ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€é…ç½®å¯¹åº”çš„æ•°å­—è¯ä¹¦ï¼Œå½“é¡¹ç›®ä½¿ç”¨<code>Nginx</code>ä½œä¸ºç½‘å…³æ—¶ï¼Œé‚£ä¹ˆè¯ä¹¦åœ¨<code>Nginx</code> ä¸­ä¹Ÿéœ€è¦é…ç½®ï¼Œæ¥ä¸‹æ¥ç®€å•èŠä¸€ä¸‹å…³äº<code>SSL</code>è¯ä¹¦é…ç½®è¿‡ç¨‹ï¼š</p><p>â‘ å…ˆå» CA æœºæ„æˆ–ä»äº‘æ§åˆ¶å°ä¸­ç”³è¯·å¯¹åº”çš„<code>SSL</code>è¯ä¹¦ï¼Œå®¡æ ¸é€šè¿‡åä¸‹è½½<code>Nginx</code>ç‰ˆæœ¬çš„è¯ä¹¦ã€‚</p><p>â‘¡ä¸‹è½½æ•°å­—è¯ä¹¦åï¼Œå®Œæ•´çš„æ–‡ä»¶æ€»å…±æœ‰ä¸‰ä¸ªï¼š<code>.crtã€.keyã€.pem</code>ï¼š</p><ul><li><code>.crt</code>ï¼šæ•°å­—è¯ä¹¦æ–‡ä»¶ï¼Œ<code>.crt</code>æ˜¯<code>.pem</code>çš„æ‹“å±•æ–‡ä»¶ï¼Œå› æ­¤æœ‰äº›äººä¸‹è½½åå¯èƒ½æ²¡æœ‰ã€‚</li><li><code>.key</code>ï¼šæœåŠ¡å™¨çš„ç§é’¥æ–‡ä»¶ï¼ŒåŠéå¯¹ç§°åŠ å¯†çš„ç§é’¥ï¼Œç”¨äºè§£å¯†å…¬é’¥ä¼ è¾“çš„æ•°æ®ã€‚</li><li><code>.pem</code>ï¼š<code>Base64-encoded</code>ç¼–ç æ ¼å¼çš„æºè¯ä¹¦æ–‡æœ¬æ–‡ä»¶ï¼Œå¯è‡ªè¡Œæ ¹éœ€æ±‚ä¿®æ”¹æ‹“å±•åã€‚</li></ul><p>â‘¢åœ¨<code>Nginx</code>ç›®å½•ä¸‹æ–°å»º<code>certificate</code>ç›®å½•ï¼Œå¹¶å°†ä¸‹è½½å¥½çš„è¯ä¹¦/ç§é’¥ç­‰æ–‡ä»¶ä¸Šä¼ è‡³è¯¥ç›®å½•ã€‚</p><p>â‘£æœ€åä¿®æ”¹ä¸€ä¸‹<code>nginx.conf</code>æ–‡ä»¶å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code># ----------HTTPSé…ç½®-----------  
server {  
    # ç›‘å¬HTTPSé»˜è®¤çš„443ç«¯å£  
    listen 443;  
    # é…ç½®è‡ªå·±é¡¹ç›®çš„åŸŸå  
    server_name www.xxx.com;  
    # æ‰“å¼€SSLåŠ å¯†ä¼ è¾“  
    ssl on;  
    # è¾“å…¥åŸŸååï¼Œé¦–é¡µæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•  
    root html;  
    # é…ç½®é¦–é¡µçš„æ–‡ä»¶å  
    index index.html index.htm index.jsp index.ftl;  
    # é…ç½®è‡ªå·±ä¸‹è½½çš„æ•°å­—è¯ä¹¦  
    ssl_certificate  certificate/xxx.pem;  
    # é…ç½®è‡ªå·±ä¸‹è½½çš„æœåŠ¡å™¨ç§é’¥  
    ssl_certificate_key certificate/xxx.key;  
    # åœæ­¢é€šä¿¡æ—¶ï¼ŒåŠ å¯†ä¼šè¯çš„æœ‰æ•ˆæœŸï¼Œåœ¨è¯¥æ—¶é—´æ®µå†…ä¸éœ€è¦é‡æ–°äº¤æ¢å¯†é’¥  
    ssl_session_timeout 5m;  
    # TLSæ¡æ‰‹æ—¶ï¼ŒæœåŠ¡å™¨é‡‡ç”¨çš„å¯†ç å¥—ä»¶  
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;  
    # æœåŠ¡å™¨æ”¯æŒçš„TLSç‰ˆæœ¬  
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;  
    # å¼€å¯ç”±æœåŠ¡å™¨å†³å®šé‡‡ç”¨çš„å¯†ç å¥—ä»¶  
    ssl_prefer_server_ciphers on;  
  
    location / {  
        ....  
    }  
}  
  
# ---------HTTPè¯·æ±‚è½¬HTTPS-------------  
server {  
    # ç›‘å¬HTTPé»˜è®¤çš„80ç«¯å£  
    listen 80;  
    # å¦‚æœ80ç«¯å£å‡ºç°è®¿é—®è¯¥åŸŸåçš„è¯·æ±‚  
    server_name www.xxx.com;  
    # å°†è¯·æ±‚æ”¹å†™ä¸ºHTTPSï¼ˆè¿™é‡Œå†™ä½ é…ç½®äº†HTTPSçš„åŸŸåï¼‰  
    rewrite ^(.*)$ https://www.xxx.com;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OK~ï¼Œæ ¹æ®å¦‚ä¸Šé…ç½®äº†<code>Nginx</code>åï¼Œä½ çš„ç½‘ç«™å³å¯é€šè¿‡<code>https://</code>çš„æ–¹å¼è®¿é—®ï¼Œå¹¶ä¸”å½“å®¢æˆ·ç«¯ä½¿ç”¨<code>http://</code> çš„æ–¹å¼è®¿é—®æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å…¶æ”¹å†™ä¸º<code>HTTPS</code>è¯·æ±‚ã€‚</p><h2 id="åä¸‰ã€nginx-çš„é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#åä¸‰ã€nginx-çš„é«˜å¯ç”¨"><span>åä¸‰ã€Nginx çš„é«˜å¯ç”¨</span></a></h2><p>çº¿ä¸Šå¦‚æœé‡‡ç”¨å•ä¸ªèŠ‚ç‚¹çš„æ–¹å¼éƒ¨ç½²<code>Nginx</code> ï¼Œéš¾å…ä¼šå‡ºç°å¤©ç¾äººç¥¸ï¼Œæ¯”å¦‚ç³»ç»Ÿå¼‚å¸¸ã€ç¨‹åºå®•æœºã€æœåŠ¡å™¨æ–­ç”µã€æœºæˆ¿çˆ†ç‚¸ã€åœ°çƒæ¯ç­â€¦â€¦å“ˆå“ˆå“ˆï¼Œå¤¸å¼ äº†ã€‚ä½†å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ç¡®å®å­˜åœ¨éšæ‚£é—®é¢˜ï¼Œç”±äº<code>Nginx</code> ä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç½‘å…³å±‚æ¥å…¥å¤–éƒ¨æµé‡ï¼Œæ‰€ä»¥ä¸€æ—¦<code>Nginx</code> å®•æœºï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ï¼Œè¿™æ— ç–‘å¯¹äºç”¨æˆ·çš„ä½“éªŒæ„Ÿæ˜¯æå·®çš„ï¼Œå› æ­¤ä¹Ÿå¾—ä¿éšœ<code>Nginx</code>é«˜å¯ç”¨çš„ç‰¹æ€§ã€‚</p><blockquote><p>â</p><p>æ¥ä¸‹æ¥åˆ™ä¼šé€šè¿‡<code>keepalived</code>çš„<code>VIP</code>æœºåˆ¶ï¼Œå®ç°<code>Nginx</code>çš„é«˜å¯ç”¨ã€‚<code>VIP</code>å¹¶ä¸æ˜¯åªä¼šå‘˜çš„æ„æ€ï¼Œè€Œæ˜¯æŒ‡<code>Virtual IP</code>ï¼Œå³è™šæ‹Ÿ<code>IP</code>ã€‚</p><p>â</p></blockquote><p><code>keepalived</code>åœ¨ä¹‹å‰å•ä½“æ¶æ„å¼€å‘æ—¶ï¼Œæ˜¯ä¸€ä¸ªç”¨çš„è¾ƒä¸ºé¢‘ç¹çš„é«˜å¯ç”¨æŠ€æœ¯ï¼Œæ¯”å¦‚<code>MySQLã€Redisã€MQã€Proxyã€Tomcat</code> ç­‰å„å¤„éƒ½ä¼šé€šè¿‡<code>keepalived</code>æä¾›çš„<code>VIP</code>æœºåˆ¶ï¼Œå®ç°å•èŠ‚ç‚¹åº”ç”¨çš„é«˜å¯ç”¨ã€‚</p><h4 id="keepalived-é‡å¯è„šæœ¬-åŒæœºçƒ­å¤‡æ­å»º" tabindex="-1"><a class="header-anchor" href="#keepalived-é‡å¯è„šæœ¬-åŒæœºçƒ­å¤‡æ­å»º"><span>Keepalived+é‡å¯è„šæœ¬+åŒæœºçƒ­å¤‡æ­å»º</span></a></h4><p>â‘ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ç›®å½•å¹¶ä¸‹è½½<code>keepalived</code>åˆ°<code>Linux</code>ä¸­å¹¶è§£å‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# mkdir /soft/keepalived &amp;&amp; cd /soft/keepalived  
[root@localhost]# wget https://www.keepalived.org/software/keepalived-2.2.4.tar.gz  
[root@localhost]# tar -zxvf keepalived-2.2.4.tar.gz  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¡è¿›å…¥è§£å‹åçš„<code>keepalived</code>ç›®å½•å¹¶æ„å»ºå®‰è£…ç¯å¢ƒï¼Œç„¶åç¼–è¯‘å¹¶å®‰è£…ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# cd keepalived-2.2.4  
[root@localhost]# ./configure --prefix=/soft/keepalived/  
[root@localhost]# make &amp;&amp; make install  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¢è¿›å…¥å®‰è£…ç›®å½•çš„<code>/soft/keepalived/etc/keepalived/</code>å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# cd /soft/keepalived/etc/keepalived/  
[root@localhost]# vi keepalived.conf  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘£ç¼–è¾‘ä¸»æœºçš„<code>keepalived.conf</code>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>global_defs {  
    # è‡ªå¸¦çš„é‚®ä»¶æé†’æœåŠ¡ï¼Œå»ºè®®ç”¨ç‹¬ç«‹çš„ç›‘æ§æˆ–ç¬¬ä¸‰æ–¹SMTPï¼Œä¹Ÿå¯é€‰æ‹©é…ç½®é‚®ä»¶å‘é€ã€‚  
    notification_email {  
        root@localhost  
    }  
    notification_email_from root@localhost  
    smtp_server localhost  
    smtp_connect_timeout 30  
    # é«˜å¯ç”¨é›†ç¾¤ä¸»æœºèº«ä»½æ ‡è¯†(é›†ç¾¤ä¸­ä¸»æœºèº«ä»½æ ‡è¯†åç§°ä¸èƒ½é‡å¤ï¼Œå»ºè®®é…ç½®æˆæœ¬æœºIP)  
 router_id 192.168.12.129   
}  
  
# å®šæ—¶è¿è¡Œçš„è„šæœ¬æ–‡ä»¶é…ç½®  
vrrp_script check_nginx_pid_restart {  
    # ä¹‹å‰ç¼–å†™çš„nginxé‡å¯è„šæœ¬çš„æ‰€åœ¨ä½ç½®  
 script &quot;/soft/scripts/keepalived/check_nginx_pid_restart.sh&quot;   
    # æ¯é—´éš”3ç§’æ‰§è¡Œä¸€æ¬¡  
 interval 3  
    # å¦‚æœè„šæœ¬ä¸­çš„æ¡ä»¶æˆç«‹ï¼Œé‡å¯ä¸€æ¬¡åˆ™æƒé‡-20  
 weight -20  
}  
  
# å®šä¹‰è™šæ‹Ÿè·¯ç”±ï¼ŒVI_1ä¸ºè™šæ‹Ÿè·¯ç”±çš„æ ‡ç¤ºç¬¦ï¼ˆå¯è‡ªå®šä¹‰åç§°ï¼‰  
vrrp_instance VI_1 {  
    # å½“å‰èŠ‚ç‚¹çš„èº«ä»½æ ‡è¯†ï¼šç”¨æ¥å†³å®šä¸»ä»ï¼ˆMASTERä¸ºä¸»æœºï¼ŒBACKUPä¸ºä»æœºï¼‰  
 state MASTER  
    # ç»‘å®šè™šæ‹ŸIPçš„ç½‘ç»œæ¥å£ï¼Œæ ¹æ®è‡ªå·±çš„æœºå™¨çš„ç½‘å¡é…ç½®  
 interface ens33   
    # è™šæ‹Ÿè·¯ç”±çš„IDå·ï¼Œä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·  
 virtual_router_id 121  
    # å¡«å†™æœ¬æœºIP  
 mcast_src_ip 192.168.12.129  
    # èŠ‚ç‚¹æƒé‡ä¼˜å…ˆçº§ï¼Œä¸»èŠ‚ç‚¹è¦æ¯”ä»èŠ‚ç‚¹ä¼˜å…ˆçº§é«˜  
 priority 100  
    # ä¼˜å…ˆçº§é«˜çš„è®¾ç½®nopreemptï¼Œè§£å†³å¼‚å¸¸æ¢å¤åå†æ¬¡æŠ¢å é€ æˆçš„è„‘è£‚é—®é¢˜  
 nopreempt  
    # ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·ï¼Œé»˜è®¤1sï¼ˆç±»ä¼¼äºå¿ƒè·³æ£€æµ‹ï¼‰  
 advert_int 1  
    authentication {  
        auth_type PASS  
        auth_pass 1111  
    }  
    # å°†track_scriptå—åŠ å…¥instanceé…ç½®å—  
    track_script {  
        # æ‰§è¡ŒNginxç›‘æ§çš„è„šæœ¬  
  check_nginx_pid_restart  
    }  
  
    virtual_ipaddress {  
        # è™šæ‹ŸIP(VIP)ï¼Œä¹Ÿå¯æ‰©å±•ï¼Œå¯é…ç½®å¤šä¸ªã€‚  
  192.168.12.111  
    }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¤å…‹éš†ä¸€å°ä¹‹å‰çš„è™šæ‹Ÿæœºä½œä¸ºä»ï¼ˆå¤‡ï¼‰æœºï¼Œç¼–è¾‘ä»æœºçš„<code>keepalived.conf</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>global_defs {  
    # è‡ªå¸¦çš„é‚®ä»¶æé†’æœåŠ¡ï¼Œå»ºè®®ç”¨ç‹¬ç«‹çš„ç›‘æ§æˆ–ç¬¬ä¸‰æ–¹SMTPï¼Œä¹Ÿå¯é€‰æ‹©é…ç½®é‚®ä»¶å‘é€ã€‚  
    notification_email {  
        root@localhost  
    }  
    notification_email_from root@localhost  
    smtp_server localhost  
    smtp_connect_timeout 30  
    # é«˜å¯ç”¨é›†ç¾¤ä¸»æœºèº«ä»½æ ‡è¯†(é›†ç¾¤ä¸­ä¸»æœºèº«ä»½æ ‡è¯†åç§°ä¸èƒ½é‡å¤ï¼Œå»ºè®®é…ç½®æˆæœ¬æœºIP)  
 router_id 192.168.12.130   
}  
  
# å®šæ—¶è¿è¡Œçš„è„šæœ¬æ–‡ä»¶é…ç½®  
vrrp_script check_nginx_pid_restart {  
    # ä¹‹å‰ç¼–å†™çš„nginxé‡å¯è„šæœ¬çš„æ‰€åœ¨ä½ç½®  
 script &quot;/soft/scripts/keepalived/check_nginx_pid_restart.sh&quot;   
    # æ¯é—´éš”3ç§’æ‰§è¡Œä¸€æ¬¡  
 interval 3  
    # å¦‚æœè„šæœ¬ä¸­çš„æ¡ä»¶æˆç«‹ï¼Œé‡å¯ä¸€æ¬¡åˆ™æƒé‡-20  
 weight -20  
}  
  
# å®šä¹‰è™šæ‹Ÿè·¯ç”±ï¼ŒVI_1ä¸ºè™šæ‹Ÿè·¯ç”±çš„æ ‡ç¤ºç¬¦ï¼ˆå¯è‡ªå®šä¹‰åç§°ï¼‰  
vrrp_instance VI_1 {  
    # å½“å‰èŠ‚ç‚¹çš„èº«ä»½æ ‡è¯†ï¼šç”¨æ¥å†³å®šä¸»ä»ï¼ˆMASTERä¸ºä¸»æœºï¼ŒBACKUPä¸ºä»æœºï¼‰  
 state BACKUP  
    # ç»‘å®šè™šæ‹ŸIPçš„ç½‘ç»œæ¥å£ï¼Œæ ¹æ®è‡ªå·±çš„æœºå™¨çš„ç½‘å¡é…ç½®  
 interface ens33   
    # è™šæ‹Ÿè·¯ç”±çš„IDå·ï¼Œä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·  
 virtual_router_id 121  
    # å¡«å†™æœ¬æœºIP  
 mcast_src_ip 192.168.12.130  
    # èŠ‚ç‚¹æƒé‡ä¼˜å…ˆçº§ï¼Œä¸»èŠ‚ç‚¹è¦æ¯”ä»èŠ‚ç‚¹ä¼˜å…ˆçº§é«˜  
 priority 90  
    # ä¼˜å…ˆçº§é«˜çš„è®¾ç½®nopreemptï¼Œè§£å†³å¼‚å¸¸æ¢å¤åå†æ¬¡æŠ¢å é€ æˆçš„è„‘è£‚é—®é¢˜  
 nopreempt  
    # ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·ï¼Œé»˜è®¤1sï¼ˆç±»ä¼¼äºå¿ƒè·³æ£€æµ‹ï¼‰  
 advert_int 1  
    authentication {  
        auth_type PASS  
        auth_pass 1111  
    }  
    # å°†track_scriptå—åŠ å…¥instanceé…ç½®å—  
    track_script {  
        # æ‰§è¡ŒNginxç›‘æ§çš„è„šæœ¬  
  check_nginx_pid_restart  
    }  
  
    virtual_ipaddress {  
        # è™šæ‹ŸIP(VIP)ï¼Œä¹Ÿå¯æ‰©å±•ï¼Œå¯é…ç½®å¤šä¸ªã€‚  
  192.168.12.111  
    }  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¥æ–°å»º<code>scripts</code>ç›®å½•å¹¶ç¼–å†™<code>Nginx</code>çš„é‡å¯è„šæœ¬ï¼Œ<code>check_nginx_pid_restart.sh</code>ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# mkdir /soft/scripts /soft/scripts/keepalived  
[root@localhost]# touch /soft/scripts/keepalived/check_nginx_pid_restart.sh  
[root@localhost]# vi /soft/scripts/keepalived/check_nginx_pid_restart.sh  
  
#!/bin/sh  
# é€šè¿‡psæŒ‡ä»¤æŸ¥è¯¢åå°çš„nginxè¿›ç¨‹æ•°ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨å˜é‡nginx_numberä¸­  
nginx_number=`ps -C nginx --no-header | wc -l`  
# åˆ¤æ–­åå°æ˜¯å¦è¿˜æœ‰Nginxè¿›ç¨‹åœ¨è¿è¡Œ  
if [ $nginx_number -eq 0 ];then  
    # å¦‚æœåå°æŸ¥è¯¢ä¸åˆ°`Nginx`è¿›ç¨‹å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œé‡å¯æŒ‡ä»¤  
    /soft/nginx/sbin/nginx -c /soft/nginx/conf/nginx.conf  
    # é‡å¯åç­‰å¾…1såï¼Œå†æ¬¡æŸ¥è¯¢åå°è¿›ç¨‹æ•°  
    sleep 1  
    # å¦‚æœé‡å¯åä¾æ—§æ— æ³•æŸ¥è¯¢åˆ°nginxè¿›ç¨‹  
    if [ `ps -C nginx --no-header | wc -l` -eq 0 ];then  
        # å°†keepalivedä¸»æœºä¸‹çº¿ï¼Œå°†è™šæ‹ŸIPæ¼‚ç§»ç»™ä»æœºï¼Œä»æœºä¸Šçº¿æ¥ç®¡NginxæœåŠ¡  
        systemctl stop keepalived.service  
    fi  
fi  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¦ç¼–å†™çš„è„šæœ¬æ–‡ä»¶éœ€è¦æ›´æ”¹ç¼–ç æ ¼å¼ï¼Œå¹¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå¦åˆ™å¯èƒ½æ‰§è¡Œå¤±è´¥ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# vi /soft/scripts/keepalived/check_nginx_pid_restart.sh  
  
:set fileformat=unix # åœ¨viå‘½ä»¤é‡Œé¢æ‰§è¡Œï¼Œä¿®æ”¹ç¼–ç æ ¼å¼  
:set ff # æŸ¥çœ‹ä¿®æ”¹åçš„ç¼–ç æ ¼å¼  
  
[root@localhost]# chmod +x /soft/scripts/keepalived/check_nginx_pid_restart.sh  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘§ç”±äºå®‰è£…<code>keepalived</code>æ—¶ï¼Œæ˜¯è‡ªå®šä¹‰çš„å®‰è£…ä½ç½®ï¼Œå› æ­¤éœ€è¦æ‹·è´ä¸€äº›æ–‡ä»¶åˆ°ç³»ç»Ÿç›®å½•ä¸­ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# mkdir /etc/keepalived/  
[root@localhost]# cp /soft/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/  
[root@localhost]# cp /soft/keepalived/keepalived-2.2.4/keepalived/etc/init.d/keepalived /etc/init.d/  
[root@localhost]# cp /soft/keepalived/etc/sysconfig/keepalived /etc/sysconfig/  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¨å°†<code>keepalived</code>åŠ å…¥ç³»ç»ŸæœåŠ¡å¹¶è®¾ç½®å¼€å¯è‡ªå¯åŠ¨ï¼Œç„¶åæµ‹è¯•å¯åŠ¨æ˜¯å¦æ­£å¸¸ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# chkconfig keepalived on  
[root@localhost]# systemctl daemon-reload  
[root@localhost]# systemctl enable keepalived.service  
[root@localhost]# systemctl start keepalived.service  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä»–å‘½ä»¤ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>systemctl disable keepalived.service # ç¦æ­¢å¼€æœºè‡ªåŠ¨å¯åŠ¨  
systemctl restart keepalived.service # é‡å¯keepalived  
systemctl stop keepalived.service # åœæ­¢keepalived  
tail -f /var/log/messages # æŸ¥çœ‹keepalivedè¿è¡Œæ—¶æ—¥å¿—  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘©æœ€åæµ‹è¯•ä¸€ä¸‹<code>VIP</code>æ˜¯å¦ç”Ÿæ•ˆï¼Œé€šè¿‡æŸ¥çœ‹æœ¬æœºæ˜¯å¦æˆåŠŸæŒ‚è½½è™šæ‹Ÿ<code>IP</code>ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>[root@localhost]# ip addr  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-11.jpeg" alt="Nginx" loading="lazy">è™šæ‹Ÿ IP-VIP</p><blockquote><p>â</p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥æ˜æ˜¾çœ‹è§è™šæ‹Ÿ<code>IP</code>å·²ç»æˆåŠŸæŒ‚è½½ï¼Œä½†å¦å¤–ä¸€å°æœºå™¨<code>192.168.12.130</code>å¹¶ä¸ä¼šæŒ‚è½½è¿™ä¸ªè™šæ‹Ÿ<code>IP</code> ï¼Œåªæœ‰å½“ä¸»æœºä¸‹çº¿åï¼Œä½œä¸ºä»æœºçš„<code>192.168.12.130</code>æ‰ä¼šä¸Šçº¿ï¼Œæ¥æ›¿<code>VIP</code>ã€‚æœ€åæµ‹è¯•ä¸€ä¸‹å¤–ç½‘æ˜¯å¦å¯ä»¥æ­£å¸¸ä¸<code>VIP</code>é€šä¿¡ï¼Œå³åœ¨<code>Windows</code> ä¸­ç›´æ¥<code>ping VIP</code>ï¼š</p><p>â</p></blockquote><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-12.png" alt="Nginx" loading="lazy">Ping-VIP</p><p>å¤–éƒ¨é€šè¿‡<code>VIP</code>é€šä¿¡æ—¶ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸<code>Ping</code>é€šï¼Œä»£è¡¨è™šæ‹Ÿ<code>IP</code>é…ç½®æˆåŠŸã€‚</p><h4 id="nginx-é«˜å¯ç”¨æ€§æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#nginx-é«˜å¯ç”¨æ€§æµ‹è¯•"><span>Nginx é«˜å¯ç”¨æ€§æµ‹è¯•</span></a></h4><p>ç»è¿‡ä¸Šè¿°æ­¥éª¤åï¼Œ<code>keepalived</code>çš„<code>VIP</code>æœºåˆ¶å·²ç»æ­å»ºæˆåŠŸï¼Œåœ¨ä¸Šä¸ªé˜¶æ®µä¸­ä¸»è¦åšäº†å‡ ä»¶äº‹ï¼š</p><ul><li>ä¸€ã€ä¸ºéƒ¨ç½²<code>Nginx</code>çš„æœºå™¨æŒ‚è½½äº†<code>VIP</code>ã€‚</li><li>äºŒã€é€šè¿‡<code>keepalived</code>æ­å»ºäº†ä¸»ä»åŒæœºçƒ­å¤‡ã€‚</li><li>ä¸‰ã€é€šè¿‡<code>keepalived</code>å®ç°äº†<code>Nginx</code>å®•æœºé‡å¯ã€‚</li></ul><p>ç”±äºå‰é¢æ²¡æœ‰åŸŸåçš„åŸå› ï¼Œå› æ­¤æœ€åˆ<code>server_name</code>é…ç½®çš„æ˜¯å½“å‰æœºå™¨çš„<code>IP</code>ï¼Œæ‰€ä»¥éœ€ç¨å¾®æ›´æ”¹ä¸€ä¸‹<code>nginx.conf</code>çš„é…ç½®ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>sever{  
    listen    80;  
    # è¿™é‡Œä»æœºå™¨çš„æœ¬åœ°IPæ”¹ä¸ºè™šæ‹ŸIP  
 server_name 192.168.12.111;  
 # å¦‚æœè¿™é‡Œé…ç½®çš„æ˜¯åŸŸåï¼Œé‚£ä¹ˆåˆ™å°†åŸŸåçš„æ˜ å°„é…ç½®æ”¹ä¸ºè™šæ‹ŸIP  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åæ¥å®éªŒä¸€ä¸‹æ•ˆæœï¼š</p><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-13.png" alt="Nginx" loading="lazy">Nginx å®•æœº</p><blockquote><p>â</p><p>åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆåˆ†åˆ«å¯åŠ¨äº†<code>keepalivedã€nginx</code>æœåŠ¡ï¼Œç„¶åé€šè¿‡æ‰‹åŠ¨åœæ­¢<code>nginx</code>çš„æ–¹å¼æ¨¡æ‹Ÿäº†<code>Nginx</code> å®•æœºæƒ…å†µï¼Œè¿‡äº†ç‰‡åˆ»åå†æ¬¡æŸ¥è¯¢åå°è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°<code>nginx</code>ä¾æ—§å­˜æ´»ã€‚</p><p>â</p></blockquote><p>ä»è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸éš¾å‘ç°ï¼Œ<code>keepalived</code>å·²ç»ä¸ºæˆ‘ä»¬å®ç°äº†<code>Nginx</code>å®•æœºåè‡ªåŠ¨é‡å¯çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæ¥ç€å†æ¨¡æ‹Ÿä¸€ä¸‹æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶çš„æƒ…å†µï¼š</p><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-14.png" alt="Nginx" loading="lazy">æœåŠ¡å™¨æ•…éšœ</p><blockquote><p>â</p><p>åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨å…³é—­<code>keepalived</code>æœåŠ¡æ¨¡æ‹Ÿäº†æœºå™¨æ–­ç”µã€ç¡¬ä»¶æŸåç­‰æƒ…å†µï¼ˆå› ä¸ºæœºå™¨æ–­ç”µç­‰æƒ…å†µ=ä¸»æœºä¸­çš„<code>keepalived</code> è¿›ç¨‹æ¶ˆå¤±ï¼‰ï¼Œç„¶åå†æ¬¡æŸ¥è¯¢äº†ä¸€ä¸‹æœ¬æœºçš„<code>IP</code>ä¿¡æ¯ï¼Œå¾ˆæ˜æ˜¾ä¼šçœ‹åˆ°<code>VIP</code>æ¶ˆå¤±äº†ï¼</p><p>â</p></blockquote><p>ç°åœ¨å†åˆ‡æ¢åˆ°å¦å¤–ä¸€å°æœºå™¨ï¼š<code>192.168.12.130</code>æ¥çœ‹çœ‹æƒ…å†µï¼š</p><p><img src="https://bitbucket.org/xlc520/blogasset/raw/main/images3/640-1674181929662-15.png" alt="Nginx" loading="lazy">130 çš„ IP æƒ…å†µ</p><blockquote><p>â</p><p>æ­¤åˆ»æˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨ä¸»æœº<code>192.168.12.129</code>å®•æœºåï¼ŒVIP è‡ªåŠ¨ä»ä¸»æœºé£˜ç§»åˆ°äº†ä»æœº<code>192.168.12.130</code> ä¸Šï¼Œè€Œæ­¤æ—¶å®¢æˆ·ç«¯çš„è¯·æ±‚å°±æœ€ç»ˆä¼šæ¥åˆ°<code>130</code>è¿™å°æœºå™¨çš„<code>Nginx</code>ä¸Šã€‚</p><p>â</p></blockquote><p><strong>ã€Œã€Œæœ€ç»ˆï¼Œåˆ©ç”¨<code>Keepalived</code>å¯¹<code>Nginx</code> åšäº†ä¸»ä»çƒ­å¤‡ä¹‹åï¼Œæ— è®ºæ˜¯é‡åˆ°çº¿ä¸Šå®•æœºè¿˜æ˜¯æœºæˆ¿æ–­ç”µç­‰å„ç±»æ•…éšœæ—¶ï¼Œéƒ½èƒ½å¤Ÿç¡®ä¿åº”ç”¨ç³»ç»Ÿèƒ½å¤Ÿä¸ºç”¨æˆ·æä¾›<code>7x24</code>å°æ—¶æœåŠ¡ã€‚ã€ã€</strong></p><h2 id="åå››ã€nginx-æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#åå››ã€nginx-æ€§èƒ½ä¼˜åŒ–"><span>åå››ã€Nginx æ€§èƒ½ä¼˜åŒ–</span></a></h2><p>åˆ°è¿™é‡Œæ–‡ç« çš„ç¯‡å¹…è¾ƒé•¿äº†ï¼Œæœ€åå†æ¥èŠä¸€ä¸‹å…³äº<code>Nginx</code> çš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¸»è¦å°±ç®€å•è¯´è¯´æ”¶ç›Šæœ€é«˜çš„å‡ ä¸ªä¼˜åŒ–é¡¹ï¼Œåœ¨è¿™å—å°±ä¸å†å±•å¼€å™è¿°äº†ï¼Œæ¯•ç«Ÿå½±å“æ€§èƒ½éƒ½æœ‰å¤šæ–¹é¢åŸå› å¯¼è‡´çš„ï¼Œæ¯”å¦‚ç½‘ç»œã€æœåŠ¡å™¨ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿã€åç«¯æœåŠ¡ã€ç¨‹åºè‡ªèº«ã€æ•°æ®åº“æœåŠ¡ç­‰ã€‚</p><h4 id="ä¼˜åŒ–ä¸€-æ‰“å¼€é•¿è¿æ¥é…ç½®" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–ä¸€-æ‰“å¼€é•¿è¿æ¥é…ç½®"><span>ä¼˜åŒ–ä¸€ï¼šæ‰“å¼€é•¿è¿æ¥é…ç½®</span></a></h4><p>é€šå¸¸ Nginx ä½œä¸ºä»£ç†æœåŠ¡ï¼Œè´Ÿè´£åˆ†å‘å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå»ºè®®å¼€å¯<code>HTTP</code>é•¿è¿æ¥ï¼Œç”¨æˆ·å‡å°‘æ¡æ‰‹çš„æ¬¡æ•°ï¼Œé™ä½æœåŠ¡å™¨æŸè€—ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>upstream xxx {  
    # é•¿è¿æ¥æ•°  
    keepalive 32;  
    # æ¯ä¸ªé•¿è¿æ¥æä¾›çš„æœ€å¤§è¯·æ±‚æ•°  
    keepalived_requests 100;  
    # æ¯ä¸ªé•¿è¿æ¥æ²¡æœ‰æ–°çš„è¯·æ±‚æ—¶ï¼Œä¿æŒçš„æœ€é•¿æ—¶é—´  
    keepalive_timeout 60s;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¼˜åŒ–äºŒã€å¼€å¯é›¶æ‹·è´æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–äºŒã€å¼€å¯é›¶æ‹·è´æŠ€æœ¯"><span>ä¼˜åŒ–äºŒã€å¼€å¯é›¶æ‹·è´æŠ€æœ¯</span></a></h4><p>é›¶æ‹·è´è¿™ä¸ªæ¦‚å¿µï¼Œåœ¨å¤§å¤šæ•°æ€§èƒ½è¾ƒä¸ºä¸é”™çš„ä¸­é—´ä»¶ä¸­éƒ½æœ‰å‡ºç°ï¼Œä¾‹å¦‚<code>Kafkaã€Netty</code>ç­‰ï¼Œè€Œ<code>Nginx</code>ä¸­ä¹Ÿå¯ä»¥é…ç½®æ•°æ®é›¶æ‹·è´æŠ€æœ¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>sendfile on; # å¼€å¯é›¶æ‹·è´æœºåˆ¶  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é›¶æ‹·è´è¯»å–æœºåˆ¶ä¸ä¼ ç»Ÿèµ„æºè¯»å–æœºåˆ¶çš„åŒºåˆ«ï¼š</p><ul><li><strong>ã€Œä¼ ç»Ÿæ–¹å¼ï¼šã€</strong> ç¡¬ä»¶--&gt;å†…æ ¸--&gt;ç”¨æˆ·ç©ºé—´--&gt;ç¨‹åºç©ºé—´--&gt;ç¨‹åºå†…æ ¸ç©ºé—´--&gt;ç½‘ç»œå¥—æ¥å­—</li><li><strong>ã€Œé›¶æ‹·è´æ–¹å¼ï¼šã€</strong> ç¡¬ä»¶--&gt;å†…æ ¸--&gt;ç¨‹åºå†…æ ¸ç©ºé—´--&gt;ç½‘ç»œå¥—æ¥å­—</li></ul><p>ä»ä¸Šè¿°è¿™ä¸ªè¿‡ç¨‹å¯¹æ¯”ï¼Œå¾ˆè½»æ˜“å°±èƒ½çœ‹å‡ºä¸¤è€…ä¹‹é—´çš„æ€§èƒ½åŒºåˆ«ã€‚</p><h4 id="ä¼˜åŒ–ä¸‰ã€å¼€å¯æ— å»¶è¿Ÿæˆ–å¤šåŒ…å…±å‘æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–ä¸‰ã€å¼€å¯æ— å»¶è¿Ÿæˆ–å¤šåŒ…å…±å‘æœºåˆ¶"><span>ä¼˜åŒ–ä¸‰ã€å¼€å¯æ— å»¶è¿Ÿæˆ–å¤šåŒ…å…±å‘æœºåˆ¶</span></a></h4><p>åœ¨<code>Nginx</code>ä¸­æœ‰ä¸¤ä¸ªè¾ƒä¸ºå…³é”®çš„æ€§èƒ½å‚æ•°ï¼Œå³<code>tcp_nodelayã€tcp_nopush</code>ï¼Œå¼€å¯æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>tcp_nodelay on;  
tcp_nopush on;  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>TCP/IP</code>åè®®ä¸­é»˜è®¤æ˜¯é‡‡ç”¨äº† Nagle ç®—æ³•çš„ï¼Œå³åœ¨ç½‘ç»œæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªæ•°æ®æŠ¥æ–‡å¹¶ä¸ä¼šç«‹é©¬å‘é€å‡ºå»ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå°†åé¢çš„å‡ ä¸ªæ•°æ®åŒ…ä¸€èµ·ç»„åˆæˆä¸€ä¸ªæ•°æ®æŠ¥æ–‡å‘é€ï¼Œä½†è¿™ä¸ªç®—æ³•è™½ç„¶æé«˜äº†ç½‘ç»œååé‡ï¼Œä½†æ˜¯å®æ—¶æ€§å´é™ä½äº†ã€‚</p><blockquote><p>â</p><p>å› æ­¤ä½ çš„é¡¹ç›®å±äºäº¤äº’æ€§å¾ˆå¼ºçš„åº”ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨å¼€å¯<code>tcp_nodelay</code> é…ç½®ï¼Œè®©åº”ç”¨ç¨‹åºå‘å†…æ ¸é€’äº¤çš„æ¯ä¸ªæ•°æ®åŒ…éƒ½ä¼šç«‹å³å‘é€å‡ºå»ã€‚ä½†è¿™æ ·ä¼šäº§ç”Ÿå¤§é‡çš„<code>TCP</code>æŠ¥æ–‡å¤´ï¼Œå¢åŠ å¾ˆå¤§çš„ç½‘ç»œå¼€é”€ã€‚</p><p>â</p></blockquote><p>ç›¸åï¼Œæœ‰äº›é¡¹ç›®çš„ä¸šåŠ¡å¯¹æ•°æ®çš„å®æ—¶æ€§è¦æ±‚å¹¶ä¸é«˜ï¼Œè¿½æ±‚çš„åˆ™æ˜¯æ›´é«˜çš„ååï¼Œé‚£ä¹ˆåˆ™å¯ä»¥å¼€å¯<code>tcp_nopush</code> é…ç½®é¡¹ï¼Œè¿™ä¸ªé…ç½®å°±ç±»ä¼¼äºâ€œå¡å­â€çš„æ„æ€ï¼Œé¦–å…ˆå°†è¿æ¥å¡ä½ï¼Œä½¿å¾—æ•°æ®å…ˆä¸å‘å‡ºå»ï¼Œç­‰åˆ°æ‹”å»å¡å­åå†å‘å‡ºå»ã€‚è®¾ç½®è¯¥é€‰é¡¹åï¼Œå†…æ ¸ä¼šå°½é‡æŠŠå°æ•°æ®åŒ…æ‹¼æ¥æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼ˆä¸€ä¸ª<code>MTU</code> ï¼‰å†å‘é€å‡ºå».</p><blockquote><p>â</p><p>å½“ç„¶è‹¥ä¸€å®šæ—¶é—´åï¼ˆä¸€èˆ¬ä¸º<code>200ms</code>ï¼‰ï¼Œå†…æ ¸ä»ç„¶æ²¡æœ‰ç§¯ç´¯åˆ°ä¸€ä¸ª<code>MTU</code>çš„é‡æ—¶ï¼Œä¹Ÿå¿…é¡»å‘é€ç°æœ‰çš„æ•°æ®ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ã€‚</p><p>â</p></blockquote><p><code>tcp_nodelayã€tcp_nopush</code>ä¸¤ä¸ªå‚æ•°æ˜¯â€œäº’æ–¥â€çš„ï¼Œå¦‚æœè¿½æ±‚å“åº”é€Ÿåº¦çš„åº”ç”¨æ¨èå¼€å¯<code>tcp_nodelay</code>å‚æ•°ï¼Œå¦‚<code>IM</code> ã€é‡‘èç­‰ç±»å‹çš„é¡¹ç›®ã€‚å¦‚æœè¿½æ±‚ååé‡çš„åº”ç”¨åˆ™å»ºè®®å¼€å¯<code>tcp_nopush</code>å‚æ•°ï¼Œå¦‚è°ƒåº¦ç³»ç»Ÿã€æŠ¥è¡¨ç³»ç»Ÿç­‰ã€‚</p><blockquote><p>â</p><p>æ³¨æ„ï¼šâ‘ <code>tcp_nodelay</code>ä¸€èˆ¬è¦å»ºç«‹åœ¨å¼€å¯äº†é•¿è¿æ¥æ¨¡å¼çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚â‘¡<code>tcp_nopush</code>å‚æ•°æ˜¯å¿…é¡»è¦å¼€å¯<code>sendfile</code>å‚æ•°æ‰å¯ä½¿ç”¨çš„ã€‚</p><p>â</p></blockquote><h4 id="ä¼˜åŒ–å››ã€è°ƒæ•´-worker-å·¥ä½œè¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–å››ã€è°ƒæ•´-worker-å·¥ä½œè¿›ç¨‹"><span>ä¼˜åŒ–å››ã€è°ƒæ•´ Worker å·¥ä½œè¿›ç¨‹</span></a></h4><p><code>Nginx</code>å¯åŠ¨åé»˜è®¤åªä¼šå¼€å¯ä¸€ä¸ª<code>Worker</code>å·¥ä½œè¿›ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æœºå™¨çš„ CPU æ ¸æ•°å¼€å¯å¯¹åº”æ•°é‡çš„å·¥ä½œè¿›ç¨‹ï¼Œä»¥æ­¤æ¥æå‡æ•´ä½“çš„å¹¶å‘é‡æ”¯æŒï¼Œå¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code># è‡ªåŠ¨æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´Workerè¿›ç¨‹æ•°é‡  
worker_processes auto;  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>â</p><p>å·¥ä½œè¿›ç¨‹çš„æ•°é‡æœ€é«˜å¼€åˆ°<code>8</code>ä¸ªå°± OK äº†ï¼Œ<code>8</code>ä¸ªä¹‹åå°±ä¸ä¼šæœ‰å†å¤§çš„æ€§èƒ½æå‡ã€‚</p><p>â</p></blockquote><p>åŒæ—¶ä¹Ÿå¯ä»¥ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ¯ä¸ªå·¥ä½œè¿›ç¨‹èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code># æ¯ä¸ªWorkerèƒ½æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæœ€å°‘è°ƒæ•´è‡³1Wä»¥ä¸Šï¼Œè´Ÿè·è¾ƒé«˜å»ºè®®2-3W  
worker_rlimit_nofile 20000;  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>â</p><p>æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆ<code>kernel</code></p></blockquote><p>ï¼‰éƒ½æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®æ–‡ä»¶ï¼Œæ— è®ºæ˜¯æ‰“å¼€ã€æ–°å»ºã€è¯»å–ã€å†™å…¥æ–‡ä»¶æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æŒ‡å®šå¾…æ“ä½œçš„æ–‡ä»¶ï¼Œå› æ­¤è¯¥å€¼è¶Šå¤§ï¼Œä»£è¡¨ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿæ“ä½œçš„æ–‡ä»¶è¶Šå¤šï¼ˆä½†ä¸èƒ½è¶…å‡ºå†…æ ¸é™åˆ¶ï¼Œæœ€å¤šå»ºè®®<code>3.8W</code></p><blockquote><p>å·¦å³ä¸ºä¸Šé™ï¼‰ã€‚</p><p>â</p></blockquote><h4 id="ä¼˜åŒ–äº”ã€å¼€å¯-cpu-äº²å’Œæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–äº”ã€å¼€å¯-cpu-äº²å’Œæœºåˆ¶"><span>ä¼˜åŒ–äº”ã€å¼€å¯ CPU äº²å’Œæœºåˆ¶</span></a></h4><p>å¯¹äºå¹¶å‘ç¼–ç¨‹è¾ƒä¸ºç†Ÿæ‚‰çš„ä¼™ä¼´éƒ½çŸ¥é“ï¼Œå› ä¸ºè¿›ç¨‹/çº¿ç¨‹æ•°å¾€å¾€éƒ½ä¼šè¿œè¶…å‡ºç³»ç»Ÿ CPU çš„æ ¸å¿ƒæ•°ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿæ‰§è¡Œçš„åŸç†æœ¬è´¨ä¸Šæ˜¯é‡‡ç”¨æ—¶é—´ç‰‡åˆ‡æ¢æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª CPU æ ¸å¿ƒä¼šåœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´ä¸æ–­é¢‘ç¹åˆ‡æ¢ï¼Œé€ æˆå¾ˆå¤§çš„æ€§èƒ½æŸè€—ã€‚</p><p>è€Œ CPU äº²å’Œæœºåˆ¶åˆ™æ˜¯æŒ‡å°†æ¯ä¸ª<code>Nginx</code>çš„å·¥ä½œè¿›ç¨‹ï¼Œç»‘å®šåœ¨å›ºå®šçš„ CPU æ ¸å¿ƒä¸Šï¼Œä»è€Œå‡å° CPU åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å¼€é”€å’Œèµ„æºæŸè€—ï¼Œå¼€å¯æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>worker_cpu_affinity auto;  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ä¼˜åŒ–å…­ã€å¼€å¯-epoll-æ¨¡å‹åŠè°ƒæ•´å¹¶å‘è¿æ¥æ•°" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–å…­ã€å¼€å¯-epoll-æ¨¡å‹åŠè°ƒæ•´å¹¶å‘è¿æ¥æ•°"><span>ä¼˜åŒ–å…­ã€å¼€å¯ epoll æ¨¡å‹åŠè°ƒæ•´å¹¶å‘è¿æ¥æ•°</span></a></h4><p>åœ¨æœ€å¼€å§‹å°±æåˆ°è¿‡ï¼š<code>Nginxã€Redis</code>éƒ½æ˜¯åŸºäºå¤šè·¯å¤ç”¨æ¨¡å‹å»å®ç°çš„ç¨‹åºï¼Œä½†æœ€åˆç‰ˆçš„å¤šè·¯å¤ç”¨æ¨¡å‹<code>select/poll</code>æœ€å¤§åªèƒ½ç›‘å¬<code>1024</code> ä¸ªè¿æ¥ï¼Œè€Œ<code>epoll</code>åˆ™å±äº<code>select/poll</code>æ¥å£çš„å¢å¼ºç‰ˆï¼Œå› æ­¤é‡‡ç”¨è¯¥æ¨¡å‹èƒ½å¤Ÿå¤§ç¨‹åº¦ä¸Šæå‡å•ä¸ª<code>Worker</code>çš„æ€§èƒ½ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain" data-title="plain"><pre class="language-plain"><code>events {  
    # ä½¿ç”¨epollç½‘ç»œæ¨¡å‹  
    use epoll;  
    # è°ƒæ•´æ¯ä¸ªWorkerèƒ½å¤Ÿå¤„ç†çš„è¿æ¥æ•°ä¸Šé™  
    worker_connections  10240;  
}  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>â</p><p>è¿™é‡Œå¯¹äº<code>select/poll/epoll</code>æ¨¡å‹å°±ä¸å±•å¼€ç»†è¯´äº†ï¼Œåé¢çš„ IO æ¨¡å‹æ–‡ç« ä¸­ä¼šè¯¦ç»†å‰–æã€‚</p><p>â</p></blockquote><h2 id="åäº”ã€æ”¾åœ¨æœ€åçš„ç»“å°¾" tabindex="-1"><a class="header-anchor" href="#åäº”ã€æ”¾åœ¨æœ€åçš„ç»“å°¾"><span>åäº”ã€æ”¾åœ¨æœ€åçš„ç»“å°¾</span></a></h2><p>è‡³æ­¤ï¼Œ<code>Nginx</code>çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½å·²é˜è¿°å®Œæ¯•ï¼Œå…³äºæœ€åä¸€å°èŠ‚çš„æ€§èƒ½ä¼˜åŒ–å†…å®¹ï¼Œå…¶å®åœ¨å‰é¢å°±è°ˆåˆ°çš„åŠ¨é™åˆ†ç¦»ã€åˆ†é…ç¼“å†²åŒºã€èµ„æºç¼“å­˜ã€é˜²ç›—é“¾ã€èµ„æºå‹ç¼©ç­‰å†…å®¹ï¼Œä¹Ÿéƒ½å¯å½’çº³ä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ–¹æ¡ˆã€‚</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/xlc520/xlc520.github.io/edit/main/src/linux/Nginxä¸€ç½‘æ‰“å°½.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2215400217@qq.com">xlc520</span>,<!--]--><!--[--><span class="vp-meta-info" title="email: 2215400217@qq.com">xlc</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/linux/Nginx-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA.html" aria-label="Nginx-å®‰å…¨åŠ å›º"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="linux" width="1em" height="1em"></iconify-icon>Nginx-å®‰å…¨åŠ å›º</div></a><a class="route-link nav-link next" href="/linux/Nginx%E4%B8%87%E5%AD%97%E6%80%BB%E7%BB%93.html" aria-label="Nginxä¸‡å­—æ€»ç»“"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Nginxä¸‡å­—æ€»ç»“<iconify-icon class="font-icon icon" style="" mode="style" inline icon="type" width="1em" height="1em"></iconify-icon></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">ä¸¤æƒ…è‹¥æ˜¯ä¹…é•¿æ—¶ï¼Œåˆå²‚åœ¨æœæœæš®æš®</div><div class="vp-copyright">Copyright Â© 2024 xlc520 </div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CXNU22eb.js" defer></script>
  </body>
</html>
