---
author: xlc520
title: E5 调用API续订程序：Microsoft 365 E5 Renew Plus
excerpt: 
description: 
date: 2022-06-12
category: other
tag: 
 - other
 - E5
 - office
article: true
timeline: true
icon: others
---

# E5 调用 API 续订程序：Microsoft 365 E5 Renew Plus

## Microsoft 365 E5 Renew Plus 的由来

Microsoft 365 E5 Renew Plus 为 Microsoft 365 E5 Renew 的升级版，其功能性，易用性，美观程度上都要强于旧版。

## 主要功能

- **支持开机自启动后台调用**：使用简单方便，无需购买服务器部署，本地应用程序即开即用
- **两种可选的调用权限**：用户未登录作为守护程序调用(需要客户端密码)、程序以登录用户身份直接调用(需要账户密码)
- **自动配置 API 权限**：登录调用的 API 权限支持由程序自动配置
- **API 种类齐全**：43 个可选的 Microsoft Graph REST API Beta 中的 API(未来可能会继续添加)
- **完全随机的 API 选用模式**：从已选定的 API 序列中随机抽取一个或几个进行调用（个数和 API 随机）
- **完全随机的 API 调用顺序**：每轮 API 的调用先后顺序随机
- **完全随机的 API 内容(仅部分 API 支持)**：POST 写类型的 API 的上传内容随机
- **完全随机的 API 调用时间间隔**：随机区段 500s-86400s 自定义
- **每日工作时间自定义**：在日常工作时间进行调用，适用于从不关机重启的服务器设备
- **每周工作日自定义**：在每周的工作日进行调用，适用于从不关机重启的服务器设备
- **运行智能暂停**：防止因持续在错误配置下运行而导致的账户封禁
- **运行配置自动保存**：可保存运行配置，无需反复设置
- **无限制账号个数**：理论上允许无限制个数账号后台自动调用
- **支持自定义客户端密钥**：允许非登录调用使用自定义密钥
- **自定义美化界面**：支持自定义背景图片（半透明度以及毛玻璃效果）、亚克力背景

## 主界面

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/b23cb7e4945747fca6e88b5c36e80e08.png)

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/185cfc81a55746eb8d915e6f0923d1ca.png)

## 运行结果查看

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210323150719810.png)

# **入群须知**

- **使用本系列产品只是增加 E5 续订概率，并不能保证 100%续订成功**
- **续订操作有些许技术门槛，且需要具备一定的自学能力**
- **每个人的时间都是宝贵的，遇到问题先查阅[帮助文档](https://sundayrx.coding.net/s/78f69c8a-8620-4d53-bad2-c4b365fed1a0)
  ，实在无法解决时再发起提问([提问的艺术](https://sundayrx.coding.net/s/78f69c8a-8620-4d53-bad2-c4b365fed1a0/4))**

#### **QQ 交流群：254058945**

#### **TG 交流群：<https://t.me/MS365E5Renew>**

# 软件下载

### 受支持的操作系统及运行环境安装

| 操作系统              | 版本                                                                                                                                        | CPU 架构    | .NET 6.0 （必选）                                                                  | WebView 2（可选）                                                     | 补丁（必选）                                       |
|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------|-----------|--------------------------------------------------------------------------------|-------------------------------------------------------------------|----------------------------------------------|
| Windows Client    | 7 SP1([ESU](https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/windows-7-eos-faq/windows-7-extended-security-updates-faq)) 、8.1 | x64       | [下载.Net 6.0 Desktop](https://dotnet.microsoft.com/download/dotnet/6.0/runtime) | [下载 WebView 2](https://go.microsoft.com/fwlink/p/?LinkId=2124703) | [下载 ESU](https://blog.simplix.info/update7/) |
| Windows 10 Client | Version 1607+                                                                                                                             | Arm64、x64 | [下载.Net 6.0 Desktop](https://dotnet.microsoft.com/download/dotnet/6.0/runtime) | [下载 WebView 2](https://go.microsoft.com/fwlink/p/?LinkId=2124703) | 不需要                                          |
| Windows 11 Client | 无限制                                                                                                                                       | Arm64、x64 | [下载.Net 6.0 Desktop](https://dotnet.microsoft.com/download/dotnet/6.0/runtime) | 不需要                                                               | 不需要                                          |
| Windows Server    | Version 2012+                                                                                                                             | x64       | [下载.Net 6.0 Desktop](https://dotnet.microsoft.com/download/dotnet/6.0/runtime) | [下载 WebView 2](https://go.microsoft.com/fwlink/p/?LinkId=2124703) | 不需要                                          |

### 各版本下载地址（建议添加白名单运行）

| 软件版本         | 文件说明                            | LanZou                                              | OneDrive                                                                                                                                      | 杀软报告                                                                                                               |
|--------------|---------------------------------|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| **包含框架(推荐)** | 无需额外安装运行环境，可直接运行                | [**下载**](https://sundayrx.lanzouq.com/2R2AByh83333) | [下载](https://sundayrx-my.sharepoint.com/:u:/g/personal/api1_sundayrx_onmicrosoft_com/EbjsV4mOxBlBoE39mBxFpqsBk51BF4y_T4Cs0OB4hV7OsQ?e=HGIlhE) | [VirusTotal](https://www.virustotal.com/gui/file/80e435ef79dbd3869e00d5515c4240237d40c598cd50519fd97184a78889512f) |
| 普通版本         | 需要安装 .NET 6 Desktop Runtime x64 | [下载](https://sundayrx.lanzoui.com/vqTrXlR5LrWjP3F)  | [下载](https://sundayrx-my.sharepoint.com/:u:/g/personal/api1_sundayrx_onmicrosoft_com/EbI_I-ohJ4BCuK821xnIoz0BTUBFHPZs3whXbVW06YLPfQ?e=vPozqH) | [VirusTotal](https://www.virustotal.com/gui/file/80e435ef79dbd3869e00d5515c4240237d40c598cd50519fd97184a78889512f) |
| 历史版本(弃用)     | 更兼容 Windows 7，已停止更新             | [下载](https://sundayrx.lanzouq.com/2R2AByh8333)      | [下载](https://sundayrx-my.sharepoint.com/:u:/g/personal/api1_sundayrx_onmicrosoft_com/EayqKNMm9IFMgSVVcNtTWJABAnZrViM3cHrthqP6VG6c2w?e=v9Zetz) | [VirusTotal](https://www.virustotal.com/gui/file/80e435ef79dbd3869e00d5515c4240237d40c598cd50519fd97184a78889512f) |

# 使用教程**(请勿开启账号的双重验证功能)

## 0 如何导入旧版本程序中的账号信息？（老用户升级用 新用户请无视）

### 0.1 复制旧版本程序账户信息

打开旧版本程序根目录下的 Account.txt 文件，依照每行复制一个账号信息（不支持多行识别）。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210323143621396.png)

### 0.2 导入账户信息到新版本程序中

打开新版本程序点击“开始运行”-“添加账号”，在弹出的“添加账号”窗口中找到右上角的剪切板图标，点击后程序会自动识别复制的账号信息，如果复制的内容没有错误程序会自动识别调用类型并填充所有空白项，检查无误后单击“确定”按钮完成一个账号信息的导入。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210323143246326.png)

## 1 注册 Azure 应用程序

### 1.1 应用注册

1. [点击登录 Azure](https://portal.azure.com/#home)
   或[点击直接进入 Azure 应用注册](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)
   ，登录账号使用申请到的 Microsoft 365 E5 的**管理员账户**（账户名类似<XXXX@YYYY.onmicrosoft.com>格式）。
   2.登录完成后点击右上角的“门户”按钮进入 Azure
   管理中心，在搜索栏内输入“应用注册”，点击进入[（若应用注册搜索不到请点击此处直接进入）](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)。
   ![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618170032256.png)
   3.单击“新注册”按钮
   ![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/2020061817051341.png)
   4.配置应用 应用名称随意写、注意可访问性选项选择最后一项、重定向 URL 暂时不填 、完成后点击注册
   ![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618170801323.png)

### 1.2 配置应用重定向 URL（身份验证）

1.先点击“概述”，然后点击“添加重定向 URL”，进入重定向 URL 配置界面，**下图中的应用程序(客户端)ID 即为"客户端 ID"**。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/2020061817121972.png)
2.点击“添加平台”，再点击“移动和桌面应用程序”，
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618171501396.png)
3.继续勾选中第一个 URL，最后点击底部的“配置”，该 URL
为“<https://login.microsoftonline.com/common/oauth2/nativeclient”也可手动添加。>
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618171651338.png)
4.配置默认客户端类型将应用程序视为公共客户端 点击切换按钮为“是” ，最后点击“保存”按钮保存。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618171850779.png)

## 2 配置应用程序的 API 权限（重要）

**小白提示：建议选择“委托的权限(用户登录)”该权限类型，调用 API 较多，操作步骤较少简单粗暴，调用成功几率高**

注册的应用程序 API 权限类型有两种，其主要区别如下表所示：

| 权限类型     | **委托的权限(用户登录)**       | **应用程序权限(非用户登录)**           |
|----------|-----------------------|-----------------------------|
| 官方释义     | 应用程序必须以登录用户身份访问 API   | 应用程序在用户未登录的情况下作为后台服务或守护程序运行 |
| 需要的信息    | 账户名称+账户密码+应用程序(客户端)ID | 账户名称+客户端机密+应用程序(客户端)ID      |
| 功能影响     | 程序中所有 API 均可调用        | 部分 API 权限受限无法调用(官方限制)       |
| API 权限配置 | 可由程序自动配置添加 API 权限     | 必须手动配置 API 权限               |
| 程序颜色标识   | 蓝色                    | 深青色                         |

根据所选的 API 权限类型在：**2.1 选择“委托的权限(用户登录)”类型的 API**或者**2.2 选择“应用程序权限(非用户登录)”类型的 API
**
中选择性阅读。

### 2.1 选择“委托的权限(用户登录)”类型的 API

#### 2.1.1 使用程序自动请求配置 API 权限

1.点击“添加账号”，API 调用方式选择“登陆调用”，正确填写“MS365 E5 账号”和“应用程序（客户端）ID”后点击“启动自动授权”。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210308150608437.png)

2.在弹出的登陆页面中输入你的管理员账户名和密码登录（**该账户必须为全局管理员账户且拥有该客户端 ID 的控制权限**
），登录成功时弹出“请求征得许可界面”，滚动到页面最底部勾选“代表组织同意”，最后点击“接受”。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200628135742984.png)
3.判断是否添加 API 权限成功：首先程序提示授权成功，其次用管理员账户登录 Azure 查看应用的 API
权限，发现所有需求的权限全部添加或可以成功调用均视为已添加成功。
ng)
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210323142238814.png)

#### 2.1.2 手动配置 API 权限

1.点击“API 权限”-“添加权限”-“Microsoft Graph”
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/2020061819283823.png)
2.选择“委托的权限”![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618172538991.png)
3.根据下方列出的 API 权限需求表来勾选所对应的 API 权限，全部选择完成后点击"添加权限"。

**BookingsAppointment.ReadWrite.All; Calendars.Read; Contacts.Read; Directory.Read.All;
Files.Read.All; Files.ReadWrite.All; Group.Read.All; Mail.Read; Mail.Send; MailboxSettings.Read;
Notes.Read.All; People.Read.All; Presence.Read.All; Sites.Read.All; Tasks.ReadWrite; User.Read.All;**

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618172627969.png)
添加完成的效果如图
**如果没有“代表 XXX 授予管理员同意”按钮 说明该账号不是管理员账号 换登管理员账号创建应用**
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20201112111140479.png)
4.最后点击代表 XXX 授予管理员同意,对话框选择“是”（该图包含了当前程序“委托的权限(用户登录)”全部 API 所需要的权限)。

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20201112110505347.png)

### 2.2 选择“应用程序权限(非用户登录)”类型的 API

#### 2.2.1 手动配置 API 权限

1.点击“API 权限”-“添加权限”-“Microsoft Graph”
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/2020061819283823-165380581365141.png)
2.选择“应用程序权限”
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200801120027971.png)
3.根据程序中列出的 API 权限需求表来勾选所对应的 API 权限，全部选择完成后点击"添加权限"。
**Calendars.Read; Contacts.Read; Directory.Read.All; Files.Read.All; Files.ReadWrite.All; Mail.Read;
Mail.Send; MailboxSettings.Read; Notes.Read.All; Sites.Read.All; User.Read.All;**
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200618172627969-165380581693146.png)
添加完成的效果如图
**如果没有“代表 XXX 授予管理员同意”按钮 说明该账号不是管理员账号 换登管理员账号创建应用**
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200801120623311.png)
4.最后点击代表 XXX 授予管理员同意,对话框选择“是”（该图包含了当前程序“应用程序权限(非用户登录)”全部 API 所需要的权限）。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200801120818260.png)

#### 2.2.2 创建客户端密码

1.点击“证书密码”-“新客户端密码”-“24 个月”-“添加”
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210609101116972.png)

2.点击“值”该列中的“复制”（不要复制"ID"列中的值），并立即将该密码保存至电脑，**保存的值即为“客户端密码”**，
注：该值必须立即保存，退出该页面后将永远无法查看。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/2020120711360840.jpeg)

## 3 使用程序进行 API 调用

##### 创建一个新的 E5 子账户(可选步骤)

登入 E5 管理员账户进入管理员界面，创建一个新的子账户，使用这个子账户登录程序调用 API。
为什么建议这样做：Microsoft 365 E5 Renew
Plus 中的部分 API 包含了写操作，例如 Onedrive 的 API，这些 API
在随机模式下会生成大量垃圾邮件和文件（虽然单独为此设立了一个文件夹），部分人可能会对此行为非常介意，而且程序频繁的读写可能会对您正常使用账户造成影响，因此不建议使用管理员账户登录。

### 3.1 添加一个账户

点击“开始运行”-“添加账号”
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/a4451a28afdb4b01b18f566feaf07759.png)

这里可以切换 API 调用方式但也需要更改对应的填写内容

登录调用方式填写
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210307154000125.png)
非登录调用方式填写
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210307154255163.png)

最后点击确定
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/202103071542145.png)

### 3.2 开始运行

点击“开始运行”
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/60b549fee8464ba08722d38b4cb999c0.png)

# 写在最后面

## 关闭 E5 账户登录双重验证

[点击进入 Office 365 E5 账户多重身份验证管理](https://account.activedirectory.windowsazure.com/UserManagement/MultifactorVerification.aspx)
，按照下图配置即可关闭 E5 账户登录的双重验证。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210519091511446.png)
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210519091736252.png)

## 关闭 Azure 中 API 调用的双重验证

[点击进入 Azure Active Directory 管理中心](https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)
，按照下图配置即可关闭 Azure 中 API 调用的双重验证。
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20201010153543698.png)

## 查询续订剩余天数

[点击查询续订剩余天数(使用申请 E5 账号的账户登录)](https://developer.microsoft.com/zh-cn/microsoft-365/profile)

## 关于续订

E5 续订执行是微软统一的具有一定时间周期的续订，如果你的 E5 订阅剩余天数少于等于 30
天、并收到了未检测到开发活动的警告邮件且仪表盘显示标红文字“此订阅处于非活动状态且即将过期”，请不要慌张。根据微软客服官方说法是：“订阅只有在剩余最后
1 天才给续期”，然而根据众多 E5 账号的续订情况来统计，大部分账号是在少于 30 天续期的，极少欧洲人是在大于 30 天的时候续期。

本人 E5 账户收到过两次未活跃警告，微软客服解释说：这种警告邮件属于系统自动发送的(邮件会在剩余第 30 天的时候发送)
，无需理会它，至于出现文字标红文字“此订阅处于非活动状态且即将过期”，也为系统自动提示，只要保证仪表盘上的文字标注为“**可续订
** E5 的订阅”就可以了，即便是真的过期了没有续上也是可以从仪表盘申诉的。

### 仪表盘变化

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/2020082317495235.png)
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20210129090340925.png)

### 续订邮件

第一次续订
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200820125542472.jpeg)
第二次续订
![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20201031134336350.png)

### 警告邮件

![图片](https://bitbucket.org/xlc520/blogasset/raw/main/images3/20200820125531157.jpeg)
